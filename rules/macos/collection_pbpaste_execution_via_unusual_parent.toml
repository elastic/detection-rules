[metadata]
creation_date = "2026/01/30"
integration = ["endpoint"]
maturity = "production"
updated_date = "2026/01/30"

[rule]
author = ["Elastic"]
description = """
Detects when an unusual parent process like Node.js, Python, or osascript executes the pbpaste binary to 
access clipboard data. This technique has been used by malware like OtterCookie to steal passwords and 
seed phrases from the clipboard.
"""
from = "now-9m"
index = ["logs-endpoint.events.process-*"]
language = "eql"
license = "Elastic License v2"
name = "Pbpaste Execution via Unusual Parent Process"
references = [
    "https://jp.security.ntt/tech_blog/contagious-interview-ottercookie"
]
risk_score = 73
rule_id = "d7182e12-df8f-4ecf-b8f8-7cc0adcec425"
severity = "high"
tags = [
    "Domain: Endpoint",
    "OS: macOS",
    "Use Case: Threat Detection",
    "Tactic: Collection",
    "Data Source: Elastic Defend"
]
type = "eql"
note = """## Triage and analysis

> **Disclaimer**:
> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.

### Investigating Pbpaste Execution via Unusual Parent Process

This rule detects when scripting interpreters like Node.js, Python, or osascript execute pbpaste to access clipboard data. This technique is used by malware such as OtterCookie to steal sensitive information like passwords and cryptocurrency seed phrases.

### Possible investigation steps

- Review the parent process that spawned pbpaste to determine if it is expected behavior for that application.
- Check for any network connections made by the parent process around the same time.
- Examine the clipboard contents if available and determine if sensitive data was present.
- Review user activity to determine if this was user-initiated or automated.

### False positive analysis

- Legitimate automation tools may use pbpaste for clipboard operations.
- Development environments may trigger this during normal testing.

### Response and remediation

- Isolate the affected host if malicious activity is confirmed.
- Terminate the suspicious process and investigate the parent application.
- Reset any credentials that may have been exposed.
- Scan the system for additional malware indicators.
"""
query = '''
sequence with maxspan=15s
  [process where host.os.type == "macos" and event.type == "start" and event.action == "exec" and
    (process.name in ("node", "osascript") or process.name like "python*")] by process.entity_id
  [process where host.os.type == "macos" and event.type == "start" and event.action == "exec" and
    process.name == "pbpaste" and process.args_count == 1 and
    not process.parent.executable like "/Users/*/.pyenv/versions/*/bin/python3*"] by process.parent.entity_id
'''

[[rule.threat]]
framework = "MITRE ATT&CK"

  [rule.threat.tactic]
  name = "Collection"
  id = "TA0009"
  reference = "https://attack.mitre.org/tactics/TA0009/"

  [[rule.threat.technique]]
  name = "Clipboard Data"
  id = "T1115"
  reference = "https://attack.mitre.org/techniques/T1115/"
