[metadata]
creation_date = "2026/01/30"
integration = ["endpoint"]
maturity = "production"
updated_date = "2026/01/30"

[rule]
author = ["Elastic"]
description = """
Detects when a scripting interpreter makes an outbound network connection to an Ethereum blockchain endpoint 
for command and control purposes. Adversaries may leverage Ethereum blockchain infrastructure as a covert C2 
channel to receive commands and exfiltrate data, as observed in campaigns like SleepyDuck malware.
"""
from = "now-9m"
index = ["logs-endpoint.events.network-*", "logs-endpoint.events.file-*"]
language = "eql"
license = "Elastic License v2"
name = "Potential Etherhiding C2 via Blockchain Connection"
references = [
    "https://secureannex.com/blog/sleepyduck-malware/"
]
risk_score = 73
rule_id = "bba8c7d1-172b-435d-9034-02ed9289c628"
severity = "high"
tags = [
    "Domain: Endpoint",
    "OS: macOS",
    "Use Case: Threat Detection",
    "Tactic: Command and Control",
    "Tactic: Execution",
    "Data Source: Elastic Defend"
]
type = "eql"
query = '''
sequence by process.entity_id with maxspan=15s
  [network where host.os.type == "macos" and event.type == "start" and
    process.name in ("bash", "sh", "zsh", "osascript", "node", "perl", "ruby", "Cursor") or
    process.name like "python*" or process.name like "tclsh*" and
    destination.domain like ("eth-mainnet*", "ethereum*", "eth.*.com")]
  [file where host.os.type == "macos" and event.action == "modification"]
'''

[[rule.threat]]
framework = "MITRE ATT&CK"

  [rule.threat.tactic]
  name = "Command and Control"
  id = "TA0011"
  reference = "https://attack.mitre.org/tactics/TA0011/"

  [[rule.threat.technique]]
  name = "Web Service"
  id = "T1102"
  reference = "https://attack.mitre.org/techniques/T1102/"

    [[rule.threat.technique.subtechnique]]
    name = "Bidirectional Communication"
    id = "T1102.002"
    reference = "https://attack.mitre.org/techniques/T1102/002/"

[[rule.threat]]
framework = "MITRE ATT&CK"

  [rule.threat.tactic]
  name = "Execution"
  id = "TA0002"
  reference = "https://attack.mitre.org/tactics/TA0002/"

  [[rule.threat.technique]]
  name = "Command and Scripting Interpreter"
  id = "T1059"
  reference = "https://attack.mitre.org/techniques/T1059/"

    [[rule.threat.technique.subtechnique]]
    name = "Unix Shell"
    id = "T1059.004"
    reference = "https://attack.mitre.org/techniques/T1059/004/"

    [[rule.threat.technique.subtechnique]]
    name = "Python"
    id = "T1059.006"
    reference = "https://attack.mitre.org/techniques/T1059/006/"

    [[rule.threat.technique.subtechnique]]
    name = "JavaScript"
    id = "T1059.007"
    reference = "https://attack.mitre.org/techniques/T1059/007/"
