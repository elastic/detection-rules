!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).vegaLite={})}(this,(function(e){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function u(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&s(e,n)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,n){return(s=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function d(e,n,t){return(d=f()?Reflect.construct:function(e,n,t){var r=[null];r.push.apply(r,n);var i=new(Function.bind.apply(e,r));return t&&s(i,t.prototype),i}).apply(null,arguments)}function v(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?p(e):n}function m(e){var n=f();return function(){var t,r=c(e);if(n){var i=c(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return h(this,t)}}function g(e,n,t){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,t){var r=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=c(e)););return e}(e,n);if(r){var i=Object.getOwnPropertyDescriptor(r,n);return i.get?i.get.call(t):i.value}})(e,n,t||e)}function y(e,n){return x(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],r=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(t.push(o.value),!n||t.length!==n);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw a}}return t}(e,n)||w(e,n)||D()}function b(e){return function(e){if(Array.isArray(e))return A(e)}(e)||k(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e){if(Array.isArray(e))return e}function k(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function w(e,n){if(e){if("string"==typeof e)return A(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?A(e,n):void 0}}function A(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function D(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function F(e,n){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=w(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==t.return||t.return()}finally{if(u)throw a}}}}function C(e){var n=function(e,n){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:String(n)}function S(e,n,t){var r=n.get(e);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(e,t);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=t}return t}function E(e,n,t){return e.fields=n||[],e.fname=t,e}function B(e){return 1===e.length?O(e[0]):_(e)}var O=function(e){return function(n){return n[e]}},_=function(e){var n=e.length;return function(t){for(var r=0;r<n;++r)t=t[e[r]];return t}};function z(e){throw Error(e)}function j(e){var n,t,r,i=[],a=e.length,o=null,u=0,l="";function c(){i.push(l+e.substring(n,t)),l="",n=t+1}for(e+="",n=t=0;t<a;++t)if("\\"===(r=e[t]))l+=e.substring(n,t),l+=e.substring(++t,++t),n=t;else if(r===o)c(),o=null,u=-1;else{if(o)continue;n===u&&'"'===r||n===u&&"'"===r?(n=t+1,o=r):"."!==r||u?"["===r?(t>n&&c(),u=n=t+1):"]"===r&&(u||z("Access path missing open bracket: "+e),u>0&&c(),u=0,n=t+1):t>n?c():n=t+1}return u&&z("Access path missing closing bracket: "+e),o&&z("Access path missing closing quote: "+e),t>n&&(t++,c()),i}!function(e,n,t){var r=j(e);e=1===r.length?r[0]:e,E((t&&t.get||B)(r),[e],n||e)}("id");var P=E((function(e){return e}),[],"identity");E((function(){return 0}),[],"zero"),E((function(){return 1}),[],"one"),E((function(){return!0}),[],"true"),E((function(){return!1}),[],"false");function N(e,n,t){var r=[n].concat([].slice.call(t));console[e].apply(console,r)}var M=Array.isArray;function T(e){return e===Object(e)}var L=function(e){return"__proto__"!==e};function q(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.reduce((function(e,n){for(var t in n)if("signals"===t)e.signals=W(e.signals,n.signals);else{var r="legend"===t?{layout:1}:"style"===t||null;R(e,t,n[t],r)}return e}),{})}function R(e,n,t,r){var i,a;if(L(n))if(T(t)&&!M(t))for(i in a=T(e[n])?e[n]:e[n]={},t)r&&(!0===r||r[i])?R(a,i,t[i]):L(i)&&(a[i]=t[i]);else e[n]=t}function W(e,n){if(null==e)return n;var t={},r=[];function i(e){t[e.name]||(t[e.name]=1,r.push(e))}return n.forEach(i),e.forEach(i),r}function U(e){return null!=e?M(e)?e:[e]:[]}var I=Object.prototype.hasOwnProperty;function H(e,n){return I.call(e,n)}function G(e){return"boolean"==typeof e}function V(e){return"number"==typeof e}function Y(e){return"string"==typeof e}function J(e){return M(e)?"["+e.map(J)+"]":T(e)||Y(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function X(e){for(var n={},t=e.length,r=0;r<t;++r)n[e[r]]=!0;return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var n=isNaN(arguments[0])?1:Number(arguments[0]);return n?Array.prototype.reduce.call(this,(function(t,r){return Array.isArray(r)?t.push.apply(t,e.call(r,n-1)):t.push(r),t}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var Q=function(e,n,t){return e(t={path:n,exports:{},require:function(e,n){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==n&&t.path)}},t.exports),t.exports}((function(e){var t=function(){function e(e,n){return null!=n&&e instanceof n}var t,r,i;try{t=Map}catch(e){t=function(){}}try{r=Set}catch(e){r=function(){}}try{i=Promise}catch(e){i=function(){}}function a(o,l,c,s,f){"object"===n(l)&&(c=l.depth,s=l.prototype,f=l.includeNonEnumerable,l=l.circular);var d=[],v=[],p="undefined"!=typeof Buffer;return void 0===l&&(l=!0),void 0===c&&(c=1/0),function o(c,h){if(null===c)return null;if(0===h)return c;var m,g;if("object"!=n(c))return c;if(e(c,t))m=new t;else if(e(c,r))m=new r;else if(e(c,i))m=new i((function(e,n){c.then((function(n){e(o(n,h-1))}),(function(e){n(o(e,h-1))}))}));else if(a.__isArray(c))m=[];else if(a.__isRegExp(c))m=new RegExp(c.source,u(c)),c.lastIndex&&(m.lastIndex=c.lastIndex);else if(a.__isDate(c))m=new Date(c.getTime());else{if(p&&Buffer.isBuffer(c))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(c.length):new Buffer(c.length),c.copy(m),m;e(c,Error)?m=Object.create(c):void 0===s?(g=Object.getPrototypeOf(c),m=Object.create(g)):(m=Object.create(s),g=s)}if(l){var y=d.indexOf(c);if(-1!=y)return v[y];d.push(c),v.push(m)}for(var b in e(c,t)&&c.forEach((function(e,n){var t=o(n,h-1),r=o(e,h-1);m.set(t,r)})),e(c,r)&&c.forEach((function(e){var n=o(e,h-1);m.add(n)})),c){var x;g&&(x=Object.getOwnPropertyDescriptor(g,b)),x&&null==x.set||(m[b]=o(c[b],h-1))}if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(c);for(b=0;b<k.length;b++){var w=k[b];(!(D=Object.getOwnPropertyDescriptor(c,w))||D.enumerable||f)&&(m[w]=o(c[w],h-1),D.enumerable||Object.defineProperty(m,w,{enumerable:!1}))}}if(f){var A=Object.getOwnPropertyNames(c);for(b=0;b<A.length;b++){var D,F=A[b];(D=Object.getOwnPropertyDescriptor(c,F))&&D.enumerable||(m[F]=o(c[F],h-1),Object.defineProperty(m,F,{enumerable:!1}))}}return m}(o,c)}function o(e){return Object.prototype.toString.call(e)}function u(e){var n="";return e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),n}return a.clonePrototype=function(e){if(null===e)return null;var n=function(){};return n.prototype=e,new n},a.__objToStr=o,a.__isDate=function(e){return"object"===n(e)&&"[object Date]"===o(e)},a.__isArray=function(e){return"object"===n(e)&&"[object Array]"===o(e)},a.__isRegExp=function(e){return"object"===n(e)&&"[object RegExp]"===o(e)},a.__getRegExpFlags=u,a}();e.exports&&(e.exports=t)})),$=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r,i="boolean"==typeof t.cycles&&t.cycles,a=t.cmp&&(r=t.cmp,function(e){return function(n,t){var i={key:n,value:e[n]},a={key:t,value:e[t]};return r(i,a)}}),o=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!==n(t))return JSON.stringify(t);var r,u;if(Array.isArray(t)){for(u="[",r=0;r<t.length;r++)r&&(u+=","),u+=e(t[r])||"null";return u+"]"}if(null===t)return"null";if(-1!==o.indexOf(t)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=o.push(t)-1,c=Object.keys(t).sort(a&&a(t));for(u="",r=0;r<c.length;r++){var s=c[r],f=e(t[s]);f&&(u&&(u+=","),u+=JSON.stringify(s)+":"+f)}return o.splice(l,1),"{"+u+"}"}}(e)};function K(e){return!!e.or}function Z(e){return!!e.and}function ee(e){return!!e.not}function ne(e,n){if(ee(e))ne(e.not,n);else if(Z(e)){var t,r=F(e.and);try{for(r.s();!(t=r.n()).done;){ne(t.value,n)}}catch(e){r.e(e)}finally{r.f()}}else if(K(e)){var i,a=F(e.or);try{for(a.s();!(i=a.n()).done;){ne(i.value,n)}}catch(e){a.e(e)}finally{a.f()}}else n(e)}function te(e,n){return ee(e)?{not:te(e.not,n)}:Z(e)?{and:e.and.map((function(e){return te(e,n)}))}:K(e)?{or:e.or.map((function(e){return te(e,n)}))}:n(e)}var re=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==n(t)&&"object"==n(r)){if(t.constructor!==r.constructor)return!1;var i,a,o;if(Array.isArray(t)){if((i=t.length)!=r.length)return!1;for(a=i;0!=a--;)if(!e(t[a],r[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((i=(o=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(a=i;0!=a--;)if(!Object.prototype.hasOwnProperty.call(r,o[a]))return!1;for(a=i;0!=a--;){var u=o[a];if(!e(t[u],r[u]))return!1}return!0}return t!=t&&r!=r},ie=Q;function ae(e,n){var t,r={},i=F(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;H(e,a)&&(r[a]=e[a])}}catch(e){i.e(e)}finally{i.f()}return r}function oe(e,n){var t,r=u({},e),i=F(n);try{for(i.s();!(t=i.n()).done;){delete r[t.value]}}catch(e){i.e(e)}finally{i.f()}return r}Set.prototype.toJSON=function(){return"Set(".concat(b(this).map((function(e){return $(e)})).join(","),")")};var ue=$;function le(e){if(V(e))return e;var n=Y(e)?e:$(e);if(n.length<250)return n;for(var t=0,r=0;r<n.length;r++){t=(t<<5)-t+n.charCodeAt(r),t&=t}return t}function ce(e){return!1===e||null===e}function se(e,n){return e.indexOf(n)>-1}function fe(e,n){var t,r=0,i=F(e.entries());try{for(i.s();!(t=i.n()).done;){var a=y(t.value,2),o=a[0];if(n(a[1],o,r++))return!0}}catch(e){i.e(e)}finally{i.f()}return!1}function de(e,n){var t,r=0,i=F(e.entries());try{for(i.s();!(t=i.n()).done;){var a=y(t.value,2),o=a[0];if(!n(a[1],o,r++))return!1}}catch(e){i.e(e)}finally{i.f()}return!0}function ve(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];for(var i=0,a=t;i<a.length;i++){var o=a[i];pe(e,null!=o?o:{})}return e}function pe(e,n){var t,r=F(ke(n));try{for(r.s();!(t=r.n()).done;){var i=t.value;R(e,i,n[i],!0)}}catch(e){r.e(e)}finally{r.f()}}function he(e,n){var t,r,i=[],a={},o=F(e);try{for(o.s();!(r=o.n()).done;){var u=r.value;(t=n(u))in a||(a[t]=1,i.push(u))}}catch(e){o.e(e)}finally{o.f()}return i}function me(e,n){if(e.size!==n.size)return!1;var t,r=F(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(!n.has(i))return!1}}catch(e){r.e(e)}finally{r.f()}return!0}function ge(e,n){var t,r=F(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(n.has(i))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}function ye(e){var n,t=new Set,r=F(e);try{var i=function(){var e,r=j(n.value).map((function(e,n){return 0===n?e:"[".concat(e,"]")})),i=F(r.map((function(e,n){return r.slice(0,n+1).join("")})));try{for(i.s();!(e=i.n()).done;){var a=e.value;t.add(a)}}catch(e){i.e(e)}finally{i.f()}};for(r.s();!(n=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}return t}function be(e,n){return void 0===e||void 0===n||ge(ye(e),ye(n))}function xe(e){return 0===ke(e).length}var ke=Object.keys,we=Object.values,Ae=Object.entries;function De(e){return!0===e||!1===e}function Fe(e){var n=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+n}function Ce(e,n){return ee(e)?"!("+Ce(e.not,n)+")":Z(e)?"("+e.and.map((function(e){return Ce(e,n)})).join(") && (")+")":K(e)?"("+e.or.map((function(e){return Ce(e,n)})).join(") || (")+")":n(e)}function Se(e,n){if(0===n.length)return!0;var t=n.shift();return t in e&&Se(e[t],n)&&delete e[t],xe(e)}function Ee(e){return e.charAt(0).toUpperCase()+e.substr(1)}function Be(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"datum",t=j(e),r=[],i=1;i<=t.length;i++){var a="[".concat(t.slice(0,i).map(J).join("]["),"]");r.push("".concat(n).concat(a))}return r.join(" && ")}function Oe(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"datum";return"".concat(n,"[").concat(J(j(e).join(".")),"]")}function _e(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function ze(e){return"".concat(j(e).map(_e).join("\\."))}function je(e,n,t){return e.replace(new RegExp(n.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),t)}function Pe(e){return"".concat(j(e).join("."))}function Ne(e){return e?j(e).length:0}function Me(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];for(var r=0,i=n;r<i.length;r++){var a=i[r];if(void 0!==a)return a}}var Te=42;function Le(e){var n=++Te;return e?String(e)+n:n}function qe(e){return Re(e)?e:"__".concat(e)}function Re(e){return 0===e.indexOf("__")}function We(e){if(void 0!==e)return(e%360+360)%360}function Ue(e){return!!V(e)||!isNaN(e)&&!isNaN(parseFloat(e))}var Ie={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function He(e){return e&&e.condition}var Ge=["domain","grid","labels","ticks","title"],Ve={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Ye={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},Je=u(u({},Ye),{},{style:1,labelExpr:1,encoding:1});function Xe(e){return!!Je[e]}var Qe=ke({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1}),$e={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Ke={count:1,min:1,max:1};function Ze(e){return!!e&&!!e.argmin}function en(e){return!!e&&!!e.argmax}function nn(e){return Y(e)&&!!$e[e]}var tn=["count","valid","missing","distinct"];function rn(e){return Y(e)&&se(tn,e)}var an=["count","sum","distinct","valid","missing"],on=X(["mean","average","median","q1","q3","min","max"]),un="row",ln="column",cn="facet",sn="x",fn="y",dn="x2",vn="y2",pn="radius",hn="radius2",mn="theta",gn="theta2",yn="latitude",bn="longitude",xn="latitude2",kn="longitude2",wn="color",An="fill",Dn="stroke",Fn="shape",Cn="size",Sn="angle",En="opacity",Bn="fillOpacity",On="strokeOpacity",_n="strokeWidth",zn="strokeDash",jn="text",Pn="order",Nn="detail",Mn="key",Tn="tooltip",Ln="href",qn="url",Rn="description",Wn={theta:1,theta2:1,radius:1,radius2:1};function Un(e){return e in Wn}var In={longitude:1,longitude2:1,latitude:1,latitude2:1};var Hn=ke(In),Gn=u(u(u(u({},{x:1,y:1,x2:1,y2:1}),Wn),In),{},{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Vn(e){return e===wn||e===An||e===Dn}var Yn={row:1,column:1,facet:1},Jn=ke(Yn),Xn=u(u({},Gn),Yn),Qn=ke(Xn),$n=(Xn.order,Xn.detail,Xn.tooltip,v(Xn,["order","detail","tooltip"])),Kn=($n.row,$n.column,$n.facet,v($n,["row","column","facet"]));function Zn(e){return!!Xn[e]}var et=[dn,vn,xn,kn,gn,hn];function nt(e){return tt(e)!==e}function tt(e){switch(e){case dn:return sn;case vn:return fn;case xn:return yn;case kn:return bn;case gn:return mn;case hn:return pn}return e}function rt(e){if(Un(e))switch(e){case mn:return"startAngle";case gn:return"endAngle";case pn:return"outerRadius";case hn:return"innerRadius"}return e}function it(e){switch(e){case sn:return dn;case fn:return vn;case yn:return xn;case bn:return kn;case mn:return gn;case pn:return hn}}function at(e){switch(e){case sn:case dn:return"width";case fn:case vn:return"height"}}Gn.x,Gn.y,Gn.x2,Gn.y2,Gn.latitude,Gn.longitude,Gn.latitude2,Gn.longitude2,Gn.theta,Gn.theta2,Gn.radius,Gn.radius2;var ot=v(Gn,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),ut=ke(ot),lt={x:1,y:1},ct=ke(lt);function st(e){return e in lt}var ft={theta:1,radius:1},dt=ke(ft);function vt(e){return"width"===e?sn:fn}ot.text,ot.tooltip,ot.href,ot.url,ot.description,ot.detail,ot.key,ot.order;var pt=v(ot,["text","tooltip","href","url","description","detail","key","order"]),ht=ke(pt);var mt=u(u(u({},lt),ft),pt),gt=ke(mt);function yt(e){return!!mt[e]}function bt(e,n){return function(e){switch(e){case wn:case An:case Dn:case Rn:case Nn:case Mn:case Tn:case Ln:case Pn:case En:case Bn:case On:case _n:case cn:case un:case ln:return xt;case sn:case fn:case yn:case bn:return kt;case dn:case vn:case xn:case kn:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Cn:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case zn:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Fn:return{point:"always",geoshape:"always"};case jn:return{text:"always"};case Sn:return{point:"always",square:"always",text:"always"};case qn:return{image:"always"};case mn:case pn:return{text:"always",arc:"always"};case gn:case hn:return{arc:"always"}}}(e)[n]}var xt={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},kt=v(xt,["geoshape"]);function wt(e){switch(e){case sn:case fn:case mn:case pn:case Cn:case Sn:case _n:case En:case Bn:case On:case dn:case vn:case gn:case hn:return;case cn:case un:case ln:case Fn:case zn:case jn:case Tn:case Ln:case qn:case Rn:return"discrete";case wn:case An:case Dn:return"flexible";case yn:case bn:case xn:case kn:case Nn:case Mn:case Pn:return}}function At(e){return G(e)&&(e=So(e,void 0)),"bin"+ke(e).map((function(n){return St(e[n])?Fe("_".concat(n,"_").concat(Ae(e[n]))):Fe("_".concat(n,"_").concat(e[n]))})).join("")}function Dt(e){return!0===e||Ct(e)&&!e.binned}function Ft(e){return"binned"===e||Ct(e)&&!0===e.binned}function Ct(e){return T(e)}function St(e){return null==e?void 0:e.selection}function Et(e){switch(e){case un:case ln:case Cn:case wn:case An:case Dn:case _n:case En:case Bn:case On:case Fn:return 6;case zn:return 4;default:return 10}}function Bt(e){return"Invalid specification ".concat(JSON.stringify(e),'. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".')}var Ot='Autosize "fit" only works for single views and layered views.';function _t(e){return"".concat("width"==e?"Width":"Height",' "container" only works for single views and layered views.')}function zt(e){var n="width"==e?"x":"y";return"".concat("width"==e?"Width":"Height",' "container" only works well with autosize "fit" or "fit-').concat(n,'".')}function jt(e){return e?'Dropping "fit-'.concat(e,'" because spec has discrete ').concat(at(e),"."):'Dropping "fit" because spec has discrete size.'}function Pt(e){return"Unknown field for ".concat(e,". Cannot calculate view size.")}function Nt(e){return'Cannot project a selection on encoding channel "'.concat(e,'", which has no field.')}function Mt(e,n){return'Cannot project a selection on encoding channel "'.concat(e,'" as it uses an aggregate function ("').concat(n,'").')}function Tt(e){return"Selection not supported for ".concat(e," yet.")}var Lt="The same selection must be used to override scale domains in a layered view.";function qt(e){return'The "columns" property cannot be used when "'.concat(e,'" has nested row/column.')}function Rt(e,n,t){return'An ancestor parsed field "'.concat(e,'" as ').concat(t," but a child wants to parse the field as ").concat(n,".")}function Wt(e){return"Config.customFormatTypes is not true, thus custom format type and format for channel ".concat(e," are dropped.")}function Ut(e,n,t){return"Channel ".concat(e," is a ").concat(n,". Converted to {value: ").concat(ue(t),"}.")}function It(e){return'Invalid field type "'.concat(e,'".')}function Ht(e,n){return'Invalid field type "'.concat(e,'" for aggregate: "').concat(n,'", using "quantitative" instead.')}function Gt(e){return'Invalid aggregation operator "'.concat(e,'".')}function Vt(e,n){var t=n.fill,r=n.stroke;return"Dropping color ".concat(e," as the plot also has ").concat(t&&r?"fill and stroke":t?"fill":"stroke",".")}function Yt(e,n){return"Dropping ".concat(ue(e),' from channel "').concat(n,'" since it does not contain any data field, datum, value, or signal.')}function Jt(e,n,t){return"".concat(e,' dropped as it is incompatible with "').concat(n,'"').concat(t?" when ".concat(t):"",".")}function Xt(e){return"".concat(e," encoding should be discrete (ordinal / nominal / binned).")}function Qt(e,n){return'Using discrete channel "'.concat(e,'" to encode "').concat(n,'" field can be misleading as it does not encode ').concat("ordinal"===n?"order":"magnitude",".")}function $t(e){return"The ".concat(e," for range marks cannot be an expression")}function Kt(e){return"Using unaggregated domain with raw field has no effect (".concat(ue(e),").")}function Zt(e){return'Unaggregated domain not applicable for "'.concat(e,'" since it produces values outside the origin domain of the source data.')}function er(e){return"Unaggregated domain is currently unsupported for log scale (".concat(ue(e),").")}function nr(e,n,t){return"".concat(t,"-scale's \"").concat(n,'" is dropped as it does not work with ').concat(e," scale.")}function tr(e){return'The step for "'.concat(e,'" is dropped because the ').concat("width"===e?"x":"y"," is continuous.")}var rr="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function ir(e){return'Cannot stack "'.concat(e,'" if there is already "').concat(e,'2".')}function ar(e){return"Cannot stack non-linear scale (".concat(e,").")}function or(e){return'Stacking is applied even though the aggregate function is non-summative ("'.concat(e,'").')}function ur(e,n){return"Invalid ".concat(e,": ").concat(ue(n),".")}function lr(e){return"1D error band does not support ".concat(e,".")}function cr(e){return"Channel ".concat(e,' is required for "binned" bin.')}function sr(e){return"Channel ".concat(e,' should not be used with "binned" bin.')}var fr,dr,vr=(dr=2||0,{level:function(e){return arguments.length?(dr=+e,this):dr},error:function(){return dr>=1&&N(fr||"error","ERROR",arguments),this},warn:function(){return dr>=2&&N(fr||"warn","WARN",arguments),this},info:function(){return dr>=3&&N(fr||"log","INFO",arguments),this},debug:function(){return dr>=4&&N(fr||"log","DEBUG",arguments),this}}),pr=vr;function hr(e){return pr=e}function mr(){return pr=vr}function gr(){var e;(e=pr).warn.apply(e,arguments)}function yr(e){if(e&&T(e)){var n,t=F(Er);try{for(t.s();!(n=t.n()).done;){if(n.value in e)return!0}}catch(e){t.e(e)}finally{t.f()}}return!1}var br=["january","february","march","april","may","june","july","august","september","october","november","december"],xr=br.map((function(e){return e.substr(0,3)})),kr=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],wr=kr.map((function(e){return e.substr(0,3)}));function Ar(e,n){var t=[];if(n&&void 0!==e.day&&ke(e).length>1&&(gr(function(e){return"Dropping day from datetime ".concat(ue(e)," as day cannot be combined with other units.")}(e)),delete(e=ie(e)).day),void 0!==e.year?t.push(e.year):t.push(2012),void 0!==e.month){var r=n?function(e){if(Ue(e)&&(e=+e),V(e))return e-1;var n=e.toLowerCase(),t=br.indexOf(n);if(-1!==t)return t;var r=n.substr(0,3),i=xr.indexOf(r);if(-1!==i)return i;throw new Error(ur("month",e))}(e.month):e.month;t.push(r)}else if(void 0!==e.quarter){var i=n?function(e){if(Ue(e)&&(e=+e),V(e))return e>4&&gr(ur("quarter",e)),e-1;throw new Error(ur("quarter",e))}(e.quarter):e.quarter;t.push(V(i)?3*i:i+"*3")}else t.push(0);if(void 0!==e.date)t.push(e.date);else if(void 0!==e.day){var a=n?function(e){if(Ue(e)&&(e=+e),V(e))return e%7;var n=e.toLowerCase(),t=kr.indexOf(n);if(-1!==t)return t;var r=n.substr(0,3),i=wr.indexOf(r);if(-1!==i)return i;throw new Error(ur("day",e))}(e.day):e.day;t.push(V(a)?a+1:a+"+1")}else t.push(1);var o,u=F(["hours","minutes","seconds","milliseconds"]);try{for(u.s();!(o=u.n()).done;){var l=e[o.value];t.push(void 0===l?0:l)}}catch(e){u.e(e)}finally{u.f()}return t}function Dr(e){var n=Ar(e,!0).join(", ");return e.utc?"utc(".concat(n,")"):"datetime(".concat(n,")")}function Fr(e){var n=Ar(e,!1).join(", ");return e.utc?"utc(".concat(n,")"):"datetime(".concat(n,")")}function Cr(e){var n=Ar(e,!0);return e.utc?+new Date(Date.UTC.apply(Date,b(n))):+d(Date,b(n))}var Sr={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Er=ke(Sr);function Br(e){return e.startsWith("utc")}var Or={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function _r(e){var n,t=[],r=F(Er);try{for(r.s();!(n=r.n()).done;){var i=n.value;zr(e,i)&&t.push(i)}}catch(e){r.e(e)}finally{r.f()}return t}function zr(e,n){var t=e.indexOf(n);return!(t<0)&&(!(t>0&&"seconds"===n&&"i"===e.charAt(t-1))&&(!(e.length>t+3&&"day"===n&&"o"===e.charAt(t+3))&&!(t>0&&"year"===n&&"f"===e.charAt(t-1))))}function jr(e,n){var t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{end:!1},i=r.end,a=Be(n),o=Br(e)?"utc":"";function u(e){return"quarter"===e?"(".concat(o,"quarter(").concat(a,")-1)"):"".concat(o).concat(e,"(").concat(a,")")}var l,c={},s=F(Er);try{for(s.s();!(l=s.n()).done;){var f=l.value;zr(e,f)&&(c[f]=u(f),t=f)}}catch(e){s.e(e)}finally{s.f()}return i&&(c[t]+="+1"),Fr(c)}function Pr(e){if(e){var n=_r(e);return"timeUnitSpecifier(".concat($(n),", ").concat($(Or),")")}}function Nr(e){var n;if(e)return Y(e)?n={unit:e}:T(e)&&(n=u(u({},e),e.unit?{unit:e.unit}:{})),Br(n.unit)&&(n.utc=!0,n.unit=n.unit.substr(3)),n}function Mr(e){var n=Nr(e),t=n.utc,r=v(n,["utc"]);return r.unit?(t?"utc":"")+ke(r).map((function(e){return Fe("".concat("unit"===e?"":"_".concat(e,"_")).concat(r[e]))})).join(""):(t?"utc":"")+"timeunit"+ke(r).map((function(e){return Fe("_".concat(e,"_").concat(r[e]))})).join("")}function Tr(e){return e&&!!e.signal}function Lr(e){return!!e.step}function qr(e){return!M(e)&&("field"in e&&"data"in e)}var Rr=ke({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),Wr={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Ur=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function Ir(e){return e&&!!e.field&&void 0!==e.equal}function Hr(e){return e&&!!e.field&&void 0!==e.lt}function Gr(e){return e&&!!e.field&&void 0!==e.lte}function Vr(e){return e&&!!e.field&&void 0!==e.gt}function Yr(e){return e&&!!e.field&&void 0!==e.gte}function Jr(e){if(e&&e.field){if(M(e.range)&&2===e.range.length)return!0;if(Tr(e.range))return!0}return!1}function Xr(e){return e&&!!e.field&&(M(e.oneOf)||M(e.in))}function Qr(e){return e&&!!e.field&&void 0!==e.valid}function $r(e){return Xr(e)||Ir(e)||Jr(e)||Hr(e)||Vr(e)||Gr(e)||Yr(e)}function Kr(e,n){return _o(e,{timeUnit:n,wrapTime:!0})}function Zr(e,n){return e.map((function(e){return Kr(e,n)}))}function ei(e){var n,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.field,i=null===(n=Nr(e.timeUnit))||void 0===n?void 0:n.unit,a=i?"time("+jr(i,r)+")":lo(e,{expr:"datum"});if(Ir(e))return a+"==="+Kr(e.equal,i);if(Hr(e)){var o=e.lt;return"".concat(a,"<").concat(Kr(o,i))}if(Vr(e)){var u=e.gt;return"".concat(a,">").concat(Kr(u,i))}if(Gr(e)){var l=e.lte;return"".concat(a,"<=").concat(Kr(l,i))}if(Yr(e)){var c=e.gte;return"".concat(a,">=").concat(Kr(c,i))}if(Xr(e))return"indexof([".concat(Zr(e.oneOf,i).join(","),"], ").concat(a,") !== -1");if(Qr(e))return ni(a,e.valid);if(Jr(e)){var s=e.range,f=Tr(s)?{signal:"".concat(s.signal,"[0]")}:s[0],d=Tr(s)?{signal:"".concat(s.signal,"[1]")}:s[1];if(null!==f&&null!==d&&t)return"inrange("+a+", ["+Kr(f,i)+", "+Kr(d,i)+"])";var v=[];return null!==f&&v.push("".concat(a," >= ").concat(Kr(f,i))),null!==d&&v.push("".concat(a," <= ").concat(Kr(d,i))),v.length>0?v.join(" && "):"true"}throw new Error("Invalid field predicate: ".concat(JSON.stringify(e)))}function ni(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return n?"isValid(".concat(e,") && isFinite(+").concat(e,")"):"!isValid(".concat(e,") || !isFinite(+").concat(e,")")}function ti(e){var n;return $r(e)&&e.timeUnit?u(u({},e),{},{timeUnit:null===(n=Nr(e.timeUnit))||void 0===n?void 0:n.unit}):e}var ri="quantitative",ii="ordinal",ai="temporal",oi="nominal",ui="geojson";function li(e){if(e)switch(e=e.toLowerCase()){case"q":case ri:return"quantitative";case"t":case ai:return"temporal";case"o":case ii:return"ordinal";case"n":case oi:return"nominal";case ui:return"geojson"}}var ci="linear",si="log",fi="pow",di="sqrt",vi="symlog",pi="time",hi="utc",mi="quantile",gi="quantize",yi="threshold",bi="point",xi="band",ki={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function wi(e,n){var t=ki[e],r=ki[n];return t===r||"ordinal-position"===t&&"time"===r||"ordinal-position"===r&&"time"===t}var Ai={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Di(e){return Ai[e]}var Fi=["linear","log","pow","sqrt","symlog","time","utc"],Ci=X(Fi),Si=X(["linear","log","pow","sqrt","symlog"]);var Ei=X(["quantile","quantize","threshold"]),Bi=X(Fi.concat(["quantile","quantize","threshold","sequential","identity"])),Oi=X(["ordinal","bin-ordinal","point","band"]);function _i(e){return e in Oi}function zi(e){return e in Bi}function ji(e){return e in Ci}function Pi(e){return e in Ei}function Ni(e){return null==e?void 0:e.selection}var Mi=v({type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},["type","domain","range","rangeMax","rangeMin","scheme"]),Ti=ke(Mi);function Li(e,n){switch(n){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!se(["point","band","identity"],e);case"bins":return!se(["point","band","identity","ordinal"],e);case"round":return ji(e)||"band"===e||"point"===e;case"padding":case"rangeMin":case"rangeMax":return ji(e)||se(["point","band"],e);case"paddingOuter":case"align":return se(["point","band"],e);case"paddingInner":return"band"===e;case"domainMax":case"domainMid":case"domainMin":case"clamp":return ji(e);case"nice":return ji(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return zi(e)&&!se(["log","time","utc","threshold","quantile"],e)}}function qi(e,n){switch(n){case"interpolate":case"scheme":case"domainMid":return Vn(e)?void 0:'Cannot use the scale property "'.concat(e,'" with non-color channel.');case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function Ri(e){return e&&!!e.expr}function Wi(e){var n,t={},r=F(ke(e||{}));try{for(r.s();!(n=r.n()).done;){var i=n.value;t[i]=To(e[i])}}catch(e){r.e(e)}finally{r.f()}return t}var Ui={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},Ii=Ui.arc,Hi=Ui.area,Gi=Ui.bar,Vi=Ui.image,Yi=Ui.line,Ji=Ui.point,Xi=Ui.rect,Qi=Ui.rule,$i=Ui.text,Ki=Ui.tick,Zi=Ui.trail,ea=Ui.circle,na=Ui.square,ta=Ui.geoshape;function ra(e){return se(["line","area","trail"],e)}function ia(e){return se(["rect","bar","image","arc"],e)}var aa=ke(Ui);function oa(e){return e.type}X(aa);var ua=[].concat(["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],["fill","fillOpacity"]),la=ke({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),ca=ke({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1}),sa={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},fa={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},da={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function va(e){var n=e.channel,t=e.channelDef,r=e.markDef,i=e.scale,a=e.config,o=ba(e);return Ja(t)&&!rn(t.aggregate)&&i&&ji(i.get("type"))&&!1===i.get("zero")?pa({fieldDef:t,channel:n,markDef:r,ref:o,config:a}):o}function pa(e){var n=e.fieldDef,t=e.channel,r=e.markDef,i=e.ref,a=e.config;return ra(r.type)||null===Io("invalid",r,a)?i:[ha(n,t),i]}function ha(e,n){return u({test:ma(e,!0)},"y"===tt(n)?{field:{group:"height"}}:{value:0})}function ma(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ni(Y(e)?e:lo(e,{expr:"datum"}),!n)}function ga(e,n,t,r){var i={};if(n&&(i.scale=n),Qa(e)){var a=e.datum;yr(a)?i.signal=Dr(a):Tr(a)?i.signal=a.signal:Ri(a)?i.signal=a.expr:i.value=a}else i.field=lo(e,t);if(r){var o=r.offset,u=r.band;o&&(i.offset=o),u&&(i.band=u)}return i}function ya(e){var n=e.scaleName,t=e.fieldOrDatumDef,r=e.fieldOrDatumDef2,i=e.offset,a=e.startSuffix,o=e.band,u=void 0===o?.5:o,l=0<u&&u<1?"datum":void 0,c=lo(t,{expr:l,suffix:a}),s=void 0!==r?lo(r,{expr:l}):lo(t,{suffix:"end",expr:l}),f={};if(0===u||1===u){f.scale=n;var d=0===u?c:s;f.field=d}else{var v="".concat(u," * ").concat(c," + ").concat(1-u," * ").concat(s);f.signal='scale("'.concat(n,'", ').concat(v,")")}return i&&(f.offset=i),f}function ba(e){var n=e.channel,t=e.channelDef,r=e.channel2Def,i=e.markDef,a=e.config,o=e.scaleName,l=e.scale,c=e.stack,s=e.offset,f=e.defaultRef,d=e.band;if(t){if(Za(t)){var v,p;if(eo(t)){var h;d=null!==(h=d)&&void 0!==h?h:Ia({channel:n,fieldDef:t,fieldDef2:r,markDef:i,stack:c,config:a,isMidPoint:!0});var m=t.bin,g=t.timeUnit,y=t.type;if(Dt(m)||d&&g&&y===ai)return c&&c.impute?ga(t,o,{binSuffix:"mid"},{offset:s}):d?ya({scaleName:o,fieldOrDatumDef:t,band:d,offset:s}):ga(t,o,jo(t,n)?{binSuffix:"range"}:{},{offset:s});if(Ft(m)){if(Ja(r))return ya({scaleName:o,fieldOrDatumDef:t,fieldOrDatumDef2:r,band:d,offset:s});gr(cr(n===sn?dn:vn))}}var b=null==l?void 0:l.get("type");return ga(t,o,_i(b)?{binSuffix:"range"}:{},{offset:s,band:"band"===b?null!==(v=null!==(p=d)&&void 0!==p?p:t.band)&&void 0!==v?v:.5:void 0})}if(no(t)){var x=s?{offset:s}:{};return u(u({},xa(n,t.value)),x)}}return function(e){return"function"==typeof e}(f)&&(f=f()),f?u(u({},f),s?{offset:s}:{}):f}function xa(e,n){return se(["x","x2"],e)&&"width"===n?{field:{group:"width"}}:se(["y","y2"],e)&&"height"===n?{field:{group:"height"}}:qo(n)}function ka(e){return e&&"number"!==e&&"time"!==e}function wa(e,n,t){return"".concat(e,"(").concat(n).concat(t?", ".concat(JSON.stringify(t)):"",")")}function Aa(e){var n=e.fieldOrDatumDef,t=e.format,r=e.formatType,i=e.expr,a=e.normalizeStack,o=e.config;if(ka(r))return Fa({fieldOrDatumDef:n,format:t,formatType:r,expr:i,config:o});var u=Da(n,i,a);if(Oo(n)){var l,c,s=function(e,n,t,r,i){return!n||t?(t=Y(t)?t:r,"".concat(i?"utc":"time","Format(").concat(e,", '").concat(t,"')")):function(e,n,t){if(e){var r=Pr(e),i=t||Br(e);return"".concat(i?"utc":"time","Format(").concat(n,", ").concat(r,")")}}(n,e,i)}(u,Ja(n)?null===(l=Nr(n.timeUnit))||void 0===l?void 0:l.unit:void 0,t,o.timeFormat,to(n)&&(null===(c=n.scale)||void 0===c?void 0:c.type)===hi);return s?{signal:s}:void 0}return t=Ea(Xa(n),t,o),Ja(n)&&Dt(n.bin)?{signal:_a(u,lo(n,{expr:i,binSuffix:"end"}),t,r,o)}:t||"quantitative"===Xa(n)?{signal:"".concat(Ba(u,t))}:{signal:"isValid(".concat(u,") ? ").concat(u,' : ""+').concat(u)}}function Da(e,n,t){return Ja(e)?t?"".concat(lo(e,{expr:n,suffix:"end"}),"-").concat(lo(e,{expr:n,suffix:"start"})):lo(e,{expr:n}):yr(r=e.datum)?Dr(r):"".concat(JSON.stringify(r));var r}function Fa(e){var n,t=e.fieldOrDatumDef,r=e.format,i=e.formatType,a=e.expr,o=e.normalizeStack,u=e.config,l=e.field;return l=null!==(n=l)&&void 0!==n?n:Da(t,a,o),Ja(t)&&Dt(t.bin)?{signal:_a(l,lo(t,{expr:a,binSuffix:"end"}),r,i,u)}:{signal:wa(i,l,r)}}function Ca(e,n,t,r,i,a){var o;if(!ka(r))return Oo(e)?function(e,n,t,r){if(e)return e;if(n)return{signal:Pr(n)};return r?void 0:t.timeFormat}(t,Ja(e)?null===(o=Nr(e.timeUnit))||void 0===o?void 0:o.unit:void 0,i,a):Ea(n,t,i)}function Sa(e,n,t){return e&&(Tr(e)||"number"===e||"time"===e)?e:Oo(n)&&"time"!==t&&"utc"!==t?"time":void 0}function Ea(e,n,t){return Y(n)?n:e===ri?t.numberFormat:void 0}function Ba(e,n){return"format(".concat(e,', "').concat(n||"",'")')}function Oa(e,n,t,r){var i;return ka(t)?wa(t,e,n):Ba(e,null!==(i=Y(n)?n:void 0)&&void 0!==i?i:r.numberFormat)}function _a(e,n,t,r,i){var a=Oa(e,t,r,i),o=Oa(n,t,r,i);return"".concat(ni(e,!1),' ? "null" : ').concat(a,' + "').concat(" – ",'" + ').concat(o)}var za="min",ja={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function Pa(e){return e in ja}function Na(e){return!!e&&!!e.encoding}function Ma(e){return!(!e||"count"!==e.op&&!e.field)}function Ta(e){return!!e&&M(e)}function La(e){return"row"in e||"column"in e}function qa(e){return!!e&&"header"in e}function Ra(e){return"facet"in e}function Wa(e){var n=e.field,t=e.timeUnit,r=e.bin,i=e.aggregate;return u(u(u(u({},t?{timeUnit:t}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{},{field:n})}function Ua(e){return"sort"in e}function Ia(e){var n=e.channel,t=e.fieldDef,r=e.fieldDef2,i=e.markDef,a=e.stack,o=e.config,u=e.isMidPoint;if(Za(t)&&void 0!==t.band)return t.band;if(Ja(t)){var l=t.timeUnit,c=t.bin;if(l&&!r)return u?Ho("timeUnitBandPosition",i,o):ia(i.type)?Ho("timeUnitBand",i,o):0;if(Dt(c))return ia(i.type)&&!u?1:.5}return(null==a?void 0:a.fieldChannel)===n&&u?.5:void 0}function Ha(e,n,t,r,i,a){return!!(Dt(n.bin)||n.timeUnit&&eo(n)&&"temporal"===n.type)&&!!Ia({channel:e,fieldDef:n,fieldDef2:t,stack:r,markDef:i,config:a})}function Ga(e){return!!e&&"condition"in e}function Va(e){var n=e&&e.condition;return!!n&&!M(n)&&Ja(n)}function Ya(e){var n=e&&e.condition;return!!n&&!M(n)&&Za(n)}function Ja(e){return!(!e||!e.field&&"count"!==e.aggregate)}function Xa(e){return e&&e.type}function Qa(e){return!!e&&"datum"in e}function $a(e){return eo(e)&&so(e)||Ka(e)}function Ka(e){return Qa(e)&&V(e.datum)}function Za(e){return Ja(e)||Qa(e)}function eo(e){return!!e&&("field"in e||"count"===e.aggregate)&&"type"in e}function no(e){return e&&"value"in e&&"value"in e}function to(e){return!!e&&("scale"in e||"sort"in e)}function ro(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function io(e){return!!e&&"legend"in e}function ao(e){return!!e&&("format"in e||"formatType"in e)}function oo(e){return oe(e,["legend","axis","header","scale"])}function uo(e){return"op"in e}function lo(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=e.field,r=n.prefix,i=n.suffix,a="";if(fo(e))t=qe("count");else{var o;if(!n.nofn)if(uo(e))o=e.op;else{var u,l,c=e.bin,s=e.aggregate,f=e.timeUnit;if(Dt(c))o=At(c),i=(null!==(u=n.binSuffix)&&void 0!==u?u:"")+(null!==(l=n.suffix)&&void 0!==l?l:"");else if(s)en(s)?(a='["'.concat(t,'"]'),t="argmax_".concat(s.argmax)):Ze(s)?(a='["'.concat(t,'"]'),t="argmin_".concat(s.argmin)):o=String(s);else if(f){var d;o=Mr(f),i=(!se(["range","mid"],n.binSuffix)&&n.binSuffix||"")+(null!==(d=n.suffix)&&void 0!==d?d:"")}}o&&(t=t?"".concat(o,"_").concat(t):o)}return i&&(t="".concat(t,"_").concat(i)),r&&(t="".concat(r,"_").concat(t)),n.forAs?Pe(t):n.expr?Oe(t,n.expr)+a:ze(t)+a}function co(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return Ja(e)&&!!e.bin;case"temporal":return!1}throw new Error(It(e.type))}function so(e){return!co(e)}function fo(e){return"count"===e.aggregate}var vo=function(e,n){switch(n.fieldTitle){case"plain":return e.field;case"functional":return function(e){var n=e.aggregate,t=e.bin,r=e.timeUnit,i=e.field;if(en(n))return"".concat(i," for argmax(").concat(n.argmax,")");if(Ze(n))return"".concat(i," for argmin(").concat(n.argmin,")");var a=Nr(r),o=n||(null==a?void 0:a.unit)||(null==a?void 0:a.maxbins)&&"timeunit"||Dt(t)&&"bin";return o?o.toUpperCase()+"("+i+")":i}(e);default:return function(e,n){var t=e.field,r=e.bin,i=e.timeUnit,a=e.aggregate;if("count"===a)return n.countTitle;if(Dt(r))return"".concat(t," (binned)");if(i){var o,u=null===(o=Nr(i))||void 0===o?void 0:o.unit;if(u)return"".concat(t," (").concat(_r(u).join("-"),")")}else if(a)return en(a)?"".concat(t," for max ").concat(a.argmax):Ze(a)?"".concat(t," for min ").concat(a.argmin):"".concat(Ee(a)," of ").concat(t);return t}(e,n)}},po=vo;function ho(e){po=e}function mo(){ho(vo)}function go(e,n,t){var r,i=t.allowDisabling,a=t.includeDefault,o=void 0===a||a,u=null===(r=yo(e))||void 0===r?void 0:r.title;if(!Ja(e))return u;var l,c=e,s=o?bo(c,n):void 0;return i?Me(u,c.title,s):null!==(l=null!=u?u:c.title)&&void 0!==l?l:s}function yo(e){return ro(e)&&e.axis?e.axis:io(e)&&e.legend?e.legend:qa(e)&&e.header?e.header:void 0}function bo(e,n){return po(e,n)}function xo(e){if(ao(e))return{format:e.format,formatType:e.formatType};var n,t=null!==(n=yo(e))&&void 0!==n?n:{};return{format:t.format,formatType:t.formatType}}function ko(e,n){var t;switch(n){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(Ua(e)&&M(e.sort))return"ordinal";var r=e.aggregate,i=e.bin;if(e.timeUnit)return"temporal";if(i||r&&!en(r)&&!Ze(r))return"quantitative";if(to(e)&&(null===(t=e.scale)||void 0===t?void 0:t.type))switch(ki[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function wo(e){return Ja(e)?e:Va(e)?e.condition:void 0}function Ao(e){return Za(e)?e:Ya(e)?e.condition:void 0}function Do(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(Y(e)||V(e)||G(e)){var i=Y(e)?"string":V(e)?"number":"boolean";return gr(Ut(n,i,e)),{value:e}}return Za(e)?Fo(e,n,t,r):Ya(e)?u(u({},e),{},{condition:Fo(e.condition,n,t,r)}):e}function Fo(e,n,t,r){if(ao(e)){e.format;var i=e.formatType,o=v(e,["format","formatType"]);if(ka(i)&&!t.customFormatTypes)return gr(Wt(n)),Fo(o,n,t,r)}else{var l=ro(e)?"axis":io(e)?"legend":qa(e)?"header":null;if(l&&e[l]){var c=e[l],s=(c.format,c.formatType),f=v(c,["format","formatType"]);if(ka(s)&&!t.customFormatTypes)return gr(Wt(n)),Fo(u(u({},e),{},a({},l,f)),n,t,r)}}return Ja(e)?Co(e,n,r):function(e){var n=e.type;if(n)return e;var t=e.datum;return n=V(t)?"quantitative":Y(t)?"nominal":yr(t)?"temporal":void 0,u(u({},e),{},{type:n})}(e)}function Co(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.compositeMark,i=void 0!==r&&r,a=e.aggregate,o=e.timeUnit,l=e.bin,c=e.field,s=u({},e);if(i||!a||nn(a)||en(a)||Ze(a)||(gr(Gt(a)),delete s.aggregate),o&&(s.timeUnit=Nr(o)),c&&(s.field="".concat(c)),Dt(l)&&(s.bin=So(l,n)),Ft(l)&&!st(n)&&gr(sr(n)),eo(s)){var f=s.type,d=li(f);f!==d&&(s.type=d),"quantitative"!==f&&rn(a)&&(gr(Ht(f,a)),s.type="quantitative")}else if(!nt(n)){var p=ko(s,n);s.type=p}if(eo(s)){var h=Bo(s,n)||{},m=h.compatible,g=h.warning;!1===m&&gr(g)}if(Ua(s)&&Y(s.sort)){var y=s.sort;if(Pa(y))return u(u({},s),{},{sort:{encoding:y}});var b=y.substr(1);if("-"===y.charAt(0)&&Pa(b))return u(u({},s),{},{sort:{encoding:b,order:"descending"}})}if(qa(s)){var x=s.header,k=x.orient,w=v(x,["orient"]);if(k)return u(u({},s),{},{header:u(u({},w),{},{labelOrient:x.labelOrient||k,titleOrient:x.titleOrient||k})})}return s}function So(e,n){return G(e)?{maxbins:Et(n)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:u(u({},e),{},{maxbins:Et(n)})}var Eo={compatible:!0};function Bo(e,n){var t=e.type;if("geojson"===t&&"shape"!==n)return{compatible:!1,warning:"Channel ".concat(n," should not be used with a geojson data.")};switch(n){case un:case ln:case cn:return so(e)?{compatible:!1,warning:Xt(n)}:Eo;case sn:case fn:case wn:case An:case Dn:case jn:case Nn:case Mn:case Tn:case Ln:case qn:case Sn:case mn:case pn:case Rn:return Eo;case bn:case kn:case yn:case xn:return t!==ri?{compatible:!1,warning:"Channel ".concat(n," should be used with a quantitative field only, not ").concat(e.type," field.")}:Eo;case En:case Bn:case On:case _n:case Cn:case gn:case hn:case dn:case vn:return"nominal"!==t||e.sort?Eo:{compatible:!1,warning:"Channel ".concat(n," should not be used with an unsorted discrete field.")};case zn:return se(["ordinal","nominal"],e.type)?Eo:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Fn:return se(["ordinal","nominal","geojson"],e.type)?Eo:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case Pn:return"nominal"!==e.type||"sort"in e?Eo:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}function Oo(e){var n,t=xo(e).formatType;return"time"===t||!t&&((n=e)&&("temporal"===n.type||Ja(n)&&!!n.timeUnit))}function _o(e,n){var t,r,i=n.timeUnit,o=n.type,u=n.wrapTime,l=n.undefinedIfExprNotRequired,c=i&&(null===(t=Nr(i))||void 0===t?void 0:t.unit),s=c||"temporal"===o;return Ri(e)?r=e.expr:Tr(e)?r=e.signal:yr(e)?(s=!0,r=Dr(e)):(Y(e)||V(e))&&s&&(r="datetime(".concat(JSON.stringify(e),")"),function(e){return!!Sr[e]}(c)&&(V(e)&&e<1e4||Y(e)&&isNaN(Date.parse(e)))&&(r=Dr(a({},c,e)))),r?u&&s?"time(".concat(r,")"):r:l?void 0:JSON.stringify(e)}function zo(e,n){var t=e.type;return n.map((function(n){var r=_o(n,{timeUnit:Ja(e)?e.timeUnit:void 0,type:t,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:n}))}function jo(e,n){return Dt(e.bin)?yt(n)&&se(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function Po(e){var n=e.anchor,t=e.frame,r=e.offset,i=e.orient,a=e.color,o=e.subtitleColor,l=e.subtitleFont,c=e.subtitleFontSize,s=e.subtitleFontStyle,f=e.subtitleFontWeight,d=e.subtitleLineHeight,p=e.subtitlePadding,h=u(u({},v(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"])),a?{fill:a}:{}),m=u(u(u(u({},n?{anchor:n}:{}),t?{frame:t}:{}),r?{offset:r}:{}),i?{orient:i}:{}),g=u(u(u(u(u(u(u({},o?{subtitleColor:o}:{}),l?{subtitleFont:l}:{}),c?{subtitleFontSize:c}:{}),s?{subtitleFontStyle:s}:{}),f?{subtitleFontWeight:f}:{}),d?{subtitleLineHeight:d}:{}),p?{subtitlePadding:p}:{});return{titleMarkConfig:h,subtitleMarkConfig:ae(h,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:g}}function No(e){return Y(e)||M(e)&&Y(e[0])}function Mo(e){var n=M(e.condition)?e.condition.map(Lo):Lo(e.condition);return u(u({},To(e)),{},{condition:n})}function To(e){return Ri(e)?u({signal:e.expr},v(e,["expr"])):e}function Lo(e){return Ri(e)?u({signal:e.expr},v(e,["expr"])):e}function qo(e){return Ri(e)?u({signal:e.expr},v(e,["expr"])):Tr(e)?e:void 0!==e?{value:e}:void 0}function Ro(e){return Tr(e)?e.signal:J(e.value)}function Wo(e){return Tr(e)?e.signal:null==e?null:J(e)}function Uo(e){var n;return[].concat(e.type,null!==(n=e.style)&&void 0!==n?n:[])}function Io(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.vgChannel,a=r.ignoreVgConfig;return i&&void 0!==n[i]?n[i]:void 0!==n[e]?n[e]:!a||i&&i!==e?Ho(e,n,t,r):void 0}function Ho(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.vgChannel;return Me(i?Go(e,n,t.style):void 0,Go(e,n,t.style),i?t[n.type][i]:void 0,t[n.type][e],i?t.mark[i]:t.mark[e])}function Go(e,n,t){return Vo(e,Uo(n),t)}function Vo(e,n,t){var r,i,a=F(n=U(n));try{for(a.s();!(i=a.n()).done;){var o=t[i.value];o&&void 0!==o[e]&&(r=o[e])}}catch(e){a.e(e)}finally{a.f()}return r}function Yo(e,n){return U(e).reduce((function(e,t){var r;return e.field.push(lo(t,n)),e.order.push(null!==(r=t.sort)&&void 0!==r?r:"ascending"),e}),{field:[],order:[]})}function Jo(e,n){var t=b(e);return n.forEach((function(e){var n,r=F(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(re(i,e))return}}catch(e){r.e(e)}finally{r.f()}t.push(e)})),t}function Xo(e,n){return re(e,n)||!n?e:e?[].concat(b(U(e)),b(U(n))).join(", "):n}function Qo(e,n){var t=e.value,r=n.value;if(null==t||null===r)return{explicit:e.explicit,value:null};if((No(t)||Tr(t))&&(No(r)||Tr(r)))return{explicit:e.explicit,value:Xo(t,r)};if(No(t)||Tr(t))return{explicit:e.explicit,value:t};if(No(r)||Tr(r))return{explicit:e.explicit,value:r};if(!(No(t)||Tr(t)||No(r)||Tr(r)))return{explicit:e.explicit,value:Jo(t,r)};throw new Error("It should never reach here")}function $o(e){return"mark"in e}var Ko=function(){function e(n,r){t(this,e),this.name=n,this.run=r}return i(e,[{key:"hasMatchingType",value:function(e){return!!$o(e)&&(oa(n=e.mark)?n.type:n)===this.name;var n}}]),e}();function Zo(e,n){var t=e&&e[n];return!!t&&(M(t)?fe(t,(function(e){return!!e.field})):Ja(t)||Va(t))}function eu(e){return fe(Qn,(function(n){if(Zo(e,n)){var t=e[n];if(M(t))return fe(t,(function(e){return!!e.aggregate}));var r=wo(t);return r&&!!r.aggregate}return!1}))}function nu(e,n){var t=[],r=[],i=[],a=[],o={};return au(e,(function(l,c){if(Ja(l)){var s=l.field,f=l.aggregate,d=l.bin,p=l.timeUnit,h=v(l,["field","aggregate","bin","timeUnit"]);if(f||p||d){var m,g=yo(l),y=g&&g.title,b=lo(l,{forAs:!0}),x=u(u(u({},y?[]:{title:go(l,n,{allowDisabling:!0})}),h),{},{field:b});if(f){if(en(f)?(m="argmax",b=lo({op:"argmax",field:f.argmax},{forAs:!0}),x.field="".concat(b,".").concat(s)):Ze(f)?(m="argmin",b=lo({op:"argmin",field:f.argmin},{forAs:!0}),x.field="".concat(b,".").concat(s)):"boxplot"!==f&&"errorbar"!==f&&"errorband"!==f&&(m=f),m){var k={op:m,as:b};s&&(k.field=s),a.push(k)}}else if(t.push(b),eo(l)&&Dt(d)){if(r.push({bin:d,field:s,as:b}),t.push(lo(l,{binSuffix:"end"})),jo(l,c)&&t.push(lo(l,{binSuffix:"range"})),st(c)){var w={field:b+"_end"};o[c+"2"]=w}x.bin="binned",nt(c)||(x.type=ri)}else if(p){i.push({timeUnit:p,field:s,as:b});var A=eo(l)&&l.type!==ai&&"time";A&&(c===jn||c===Tn?x.formatType=A:!function(e){return!!ot[e]}(c)?st(c)&&(x.axis=u({formatType:A},x.axis)):x.legend=u({formatType:A},x.legend))}o[c]=x}else t.push(s),o[c]=e[c]}else o[c]=e[c]})),{bins:r,timeUnits:i,aggregate:a,groupby:t,encoding:o}}function tu(e,n,t,r){return ke(e).reduce((function(i,a){if(!Zn(a))return gr(function(e){return"".concat(e,"-encoding is dropped as ").concat(e," is not a valid encoding channel.")}(a)),i;var o=e[a];if("angle"!==a||"arc"!==n||e.theta||(gr("Arc marks uses theta channel rather than angle, replacing angle with theta."),a=mn),!function(e,n,t){var r=bt(n,t);if(!r)return!1;if("binned"===r){var i=e[n===dn?sn:fn];return!!(Ja(i)&&Ja(e[n])&&Ft(i.bin))}return!0}(e,a,n))return gr(Jt(a,n)),i;if(a===Cn&&"line"===n){var u=wo(e[a]);if(null==u?void 0:u.aggregate)return gr("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),i}if(a===wn&&(t?"fill"in e:"stroke"in e))return gr(Vt("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(a===Nn||a===Pn&&!M(o)&&!no(o)||a===Tn&&M(o))o&&(i[a]=U(o).reduce((function(e,n){return Ja(n)?e.push(Co(n,a)):gr(Yt(n,a)),e}),[]));else{if(a===Tn&&null===o)i[a]=null;else if(!(Ja(o)||Qa(o)||no(o)||Ga(o)||Tr(o)))return gr(Yt(o,a)),i;i[a]=Do(o,a,r)}return i}),{})}function ru(e,n){var t,r={},i=F(ke(e));try{for(i.s();!(t=i.n()).done;){var a=t.value,o=Do(e[a],a,n,{compositeMark:!0});r[a]=o}}catch(e){i.e(e)}finally{i.f()}return r}function iu(e){var n,t=[],r=F(ke(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(Zo(e,i)){var a,o=F(U(e[i]));try{for(o.s();!(a=o.n()).done;){var u=a.value;Ja(u)?t.push(u):Va(u)&&t.push(u.condition)}}catch(e){o.e(e)}finally{o.f()}}}}catch(e){r.e(e)}finally{r.f()}return t}function au(e,n,t){if(e){var r,i=F(ke(e));try{for(i.s();!(r=i.n()).done;){var a=r.value,o=e[a];if(M(o)){var u,l=F(o);try{for(l.s();!(u=l.n()).done;){var c=u.value;n.call(t,c,a)}}catch(e){l.e(e)}finally{l.f()}}else n.call(t,o,a)}}catch(e){i.e(e)}finally{i.f()}}}function ou(e,n){return ke(n).reduce((function(t,r){switch(r){case sn:case fn:case Ln:case Rn:case qn:case dn:case vn:case mn:case gn:case pn:case hn:case yn:case bn:case xn:case kn:case jn:case Fn:case Sn:case Tn:return t;case Pn:if("line"===e||"trail"===e)return t;case Nn:case Mn:var i=n[r];if(M(i)||Ja(i)){var a,o=F(U(i));try{for(o.s();!(a=o.n()).done;){var u=a.value;u.aggregate||t.push(lo(u,{}))}}catch(e){o.e(e)}finally{o.f()}}return t;case Cn:if("trail"===e)return t;case wn:case An:case Dn:case En:case Bn:case On:case zn:case _n:var l=wo(n[r]);return l&&!l.aggregate&&t.push(lo(l,{})),t}}),[])}function uu(e,n,t){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if("tooltip"in t)return{tooltip:t.tooltip};var i=e.map((function(e){var t=e.fieldPrefix,i=e.titlePrefix,a=r?" of ".concat(lu(n)):"";return{field:t+n.field,type:n.type,title:Tr(i)?{signal:i+'"'.concat(escape(a),'"')}:i+a}})),a=iu(t).map(oo);return{tooltip:[].concat(b(i),b(he(a,le)))}}function lu(e){return Me(e.title,e.field)}function cu(e,n,t,r,i){var o=t.scale,l=t.axis;return function(c){var s=c.partName,f=c.mark,d=c.positionPrefix,v=c.endPositionPrefix,p=void 0===v?void 0:v,h=c.extraEncoding,m=void 0===h?{}:h,g=lu(t);return su(e,s,i,{mark:f,encoding:u(u(u(a({},n,u(u(u({field:d+"_"+t.field,type:t.type},void 0!==g?{title:g}:{}),void 0!==o?{scale:o}:{}),void 0!==l?{axis:l}:{})),Y(p)?a({},n+"2",{field:p+"_"+t.field}):{}),r),m)})}}function su(e,n,t,r){var i=e.clip,a=e.color,o=e.opacity,l=e.type;return e[n]||void 0===e[n]&&t[n]?[u(u({},r),{},{mark:u(u(u(u(u(u({},t[n]),i?{clip:i}:{}),a?{color:a}:{}),o?{opacity:o}:{}),oa(r.mark)?r.mark:{type:r.mark}),{},{style:"".concat(l,"-").concat(n)},G(e[n])?{}:e[n])})]:[]}function fu(e,n,t){var r=e.encoding,i="vertical"===n?"y":"x",a=r[i],o=r[i+"2"],u=r[i+"Error"],l=r[i+"Error2"];return{continuousAxisChannelDef:du(a,t),continuousAxisChannelDef2:du(o,t),continuousAxisChannelDefError:du(u,t),continuousAxisChannelDefError2:du(l,t),continuousAxis:i}}function du(e,n){if(e&&e.aggregate){var t=e.aggregate,r=v(e,["aggregate"]);return t!==n&&gr(function(e,n){return"Continuous axis should not have customized aggregation function ".concat(e,"; ").concat(n," already agregates the axis.")}(t,n)),r}return e}function vu(e,n){var t=e.mark,r=e.encoding,i=r.x,a=r.y;if(oa(t)&&t.orient)return t.orient;if($a(i)){if($a(a)){var o=Ja(i)&&i.aggregate,u=Ja(a)&&a.aggregate;if(o||u!==n){if(u||o!==n){if(o===n&&u===n)throw new Error("Both x and y cannot have aggregate");return Oo(a)&&!Oo(i)?"horizontal":"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if($a(a))return"vertical";throw new Error("Need a valid continuous axis for ".concat(n,"s"))}var pu="boxplot",hu=new Ko(pu,gu);function mu(e){return V(e)?"tukey":e}function gu(e,n){var t,r=n.config,i=e=u(u({},e),{},{encoding:ru(e.encoding,r)}),o=i.mark,l=(i.encoding,i.selection),c=(i.projection,v(i,["mark","encoding","selection","projection"])),s=oa(o)?o:{type:o};l&&gr(Tt("boxplot"));var f,d=null!==(t=s.extent)&&void 0!==t?t:r.boxplot.extent,p=Io("size",s,r),h=mu(d),m=function(e,n,t){var r=vu(e,pu),i=fu(e,r,pu),a=i.continuousAxisChannelDef,o=i.continuousAxis,u=a.field,l=mu(n),c=[].concat(b(yu(u)),[{op:"median",field:u,as:"mid_box_"+u},{op:"min",field:u,as:("min-max"===l?"lower_whisker_":"min_")+u},{op:"max",field:u,as:("min-max"===l?"upper_whisker_":"max_")+u}]),s="min-max"===l||"tukey"===l?[]:[{calculate:'datum["upper_box_'.concat(u,'"] - datum["lower_box_').concat(u,'"]'),as:"iqr_"+u},{calculate:'min(datum["upper_box_'.concat(u,'"] + datum["iqr_').concat(u,'"] * ').concat(n,', datum["max_').concat(u,'"])'),as:"upper_whisker_"+u},{calculate:'max(datum["lower_box_'.concat(u,'"] - datum["iqr_').concat(u,'"] * ').concat(n,', datum["min_').concat(u,'"])'),as:"lower_whisker_"+u}],f=e.encoding,d=(f[o],function(e){var n,t,r=e.tooltip,i=v(e,["tooltip"]);if(!r)return{filteredEncoding:i};if(M(r)){var a,o=F(r);try{for(o.s();!(a=o.n()).done;){var u=a.value;u.aggregate?(n||(n=[]),n.push(u)):(t||(t=[]),t.push(u))}}catch(e){o.e(e)}finally{o.f()}n&&(i.tooltip=n)}else r.aggregate?i.tooltip=r:t=r;return M(t)&&1===t.length&&(t=t[0]),{customTooltipWithoutAggregatedField:t,filteredEncoding:i}}(v(f,[o].map(C)))),p=d.customTooltipWithoutAggregatedField,h=nu(d.filteredEncoding,t),m=h.bins,g=h.timeUnits,y=h.aggregate,x=h.groupby,k=h.encoding,w="vertical"===r?"horizontal":"vertical",A=r,D=[].concat(b(m),b(g),[{aggregate:[].concat(b(y),b(c)),groupby:x}],s);return{bins:m,timeUnits:g,transform:D,groupby:x,aggregate:y,continuousAxisChannelDef:a,continuousAxis:o,encodingWithoutContinuousAxis:k,ticksOrient:w,boxOrient:A,customTooltipWithoutAggregatedField:p}}(e,d,r),g=m.bins,y=m.timeUnits,x=m.transform,k=m.continuousAxisChannelDef,w=m.continuousAxis,A=m.groupby,D=m.aggregate,S=m.encodingWithoutContinuousAxis,E=m.ticksOrient,B=m.boxOrient,O=m.customTooltipWithoutAggregatedField,_=S.color,z=S.size,j=v(S,["color","size"]),P=function(e){return cu(s,w,k,e,r.boxplot)},N=P(j),L=P(S),q=P(u(u({},j),z?{size:z}:{})),R=uu([{fieldPrefix:"min-max"===h?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===h?"lower_whisker_":"min_",titlePrefix:"Min"}],k,S),W={type:"tick",color:"black",opacity:1,orient:E,invalid:null,aria:!1},U="min-max"===h?R:uu([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],k,S),I=[].concat(b(N({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:U})),b(N({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:U})),b(N({partName:"ticks",mark:W,positionPrefix:"lower_whisker",extraEncoding:U})),b(N({partName:"ticks",mark:W,positionPrefix:"upper_whisker",extraEncoding:U}))),H=[].concat(b("tukey"!==h?I:[]),b(L({partName:"box",mark:u(u({type:"bar"},p?{size:p}:{}),{},{orient:B,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:R})),b(q({partName:"median",mark:u(u(u({type:"tick",invalid:null},T(r.boxplot.median)&&r.boxplot.median.color?{color:r.boxplot.median.color}:{}),p?{size:p}:{}),{},{orient:E,aria:!1}),positionPrefix:"mid_box",extraEncoding:R})));if("min-max"===h)return u(u({},c),{},{transform:(null!==(f=c.transform)&&void 0!==f?f:[]).concat(x),layer:H});var G,V,Y='datum["lower_box_'.concat(k.field,'"]'),J='datum["upper_box_'.concat(k.field,'"]'),X="(".concat(J," - ").concat(Y,")"),Q="".concat(Y," - ").concat(d," * ").concat(X),$="".concat(J," + ").concat(d," * ").concat(X),K='datum["'.concat(k.field,'"]'),Z={joinaggregate:yu(k.field),groupby:A},ee={transform:[{filter:"(".concat(Q," <= ").concat(K,") && (").concat(K," <= ").concat($,")")},{aggregate:[{op:"min",field:k.field,as:"lower_whisker_"+k.field},{op:"max",field:k.field,as:"upper_whisker_"+k.field},{op:"min",field:"lower_box_"+k.field,as:"lower_box_"+k.field},{op:"max",field:"upper_box_"+k.field,as:"upper_box_"+k.field}].concat(b(D)),groupby:A}],layer:I},ne=(j.tooltip,v(j,["tooltip"])),te=k.scale,re=k.axis,ie=lu(k),ae=oe(re,["title"]),ue=su(s,"outliers",r.boxplot,{transform:[{filter:"(".concat(K," < ").concat(Q,") || (").concat(K," > ").concat($,")")}],mark:"point",encoding:u(u(u(a({},w,u(u(u({field:k.field,type:k.type},void 0!==ie?{title:ie}:{}),void 0!==te?{scale:te}:{}),xe(ae)?{}:{axis:ae})),ne),_?{color:_}:{}),O?{tooltip:O}:{})})[0],le=[].concat(b(g),b(y),[Z]);ue?G={transform:le,layer:[ue,ee]}:(V=(G=ee).transform).unshift.apply(V,b(le));return u(u({},c),{},{layer:[G,{transform:x,layer:H}]})}function yu(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}var bu="errorbar",xu=new Ko(bu,ku);function ku(e,n){var t=n.config,r=Au(e=u(u({},e),{},{encoding:ru(e.encoding,t)}),bu,t),i=r.transform,a=r.continuousAxisChannelDef,o=r.continuousAxis,l=r.encodingWithoutContinuousAxis,c=r.ticksOrient,s=r.markDef,f=r.outerSpec,d=r.tooltipEncoding;delete l.size;var v=cu(s,o,a,l,t.errorbar),p=s.thickness,h=s.size,m=u(u({type:"tick",orient:c,aria:!1},void 0!==p?{thickness:p}:{}),void 0!==h?{size:h}:{}),g=[].concat(b(v({partName:"ticks",mark:m,positionPrefix:"lower",extraEncoding:d})),b(v({partName:"ticks",mark:m,positionPrefix:"upper",extraEncoding:d})),b(v({partName:"rule",mark:u({type:"rule",ariaRoleDescription:"errorbar"},void 0!==p?{size:p}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:d})));return u(u({},f),{},{transform:i},g.length>1?{layer:g}:u({},g[0]))}function wu(e,n){var t=e.encoding;if(function(e){return(Za(e.x)||Za(e.y))&&!Za(e.x2)&&!Za(e.y2)&&!Za(e.xError)&&!Za(e.xError2)&&!Za(e.yError)&&!Za(e.yError2)}(t))return{orient:vu(e,n),inputType:"raw"};var r=function(e){return Za(e.x2)||Za(e.y2)}(t),i=function(e){return Za(e.xError)||Za(e.xError2)||Za(e.yError)||Za(e.yError2)}(t),a=t.x,o=t.y;if(r){if(i)throw new Error("".concat(n," cannot be both type aggregated-upper-lower and aggregated-error"));var u=t.x2,l=t.y2;if(Za(u)&&Za(l))throw new Error("".concat(n," cannot have both x2 and y2"));if(Za(u)){if($a(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error("Both x and x2 have to be quantitative in ".concat(n))}if(Za(l)){if($a(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error("Both y and y2 have to be quantitative in ".concat(n))}throw new Error("No ranged axis")}var c=t.xError,s=t.xError2,f=t.yError,d=t.yError2;if(Za(s)&&!Za(c))throw new Error("".concat(n," cannot have xError2 without xError"));if(Za(d)&&!Za(f))throw new Error("".concat(n," cannot have yError2 without yError"));if(Za(c)&&Za(f))throw new Error("".concat(n," cannot have both xError and yError with both are quantiative"));if(Za(c)){if($a(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(Za(f)){if($a(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}function Au(e,n,t){var r,i=e.mark,a=e.encoding,o=e.selection,u=(e.projection,v(e,["mark","encoding","selection","projection"])),l=oa(i)?i:{type:i};o&&gr(Tt(n));var c=wu(e,n),s=c.orient,f=c.inputType,d=fu(e,s,n),p=d.continuousAxisChannelDef,h=d.continuousAxisChannelDef2,m=d.continuousAxisChannelDefError,g=d.continuousAxisChannelDefError2,y=d.continuousAxis,x=function(e,n,t,r,i,a,o,u){var l,c=[],s=[],f=n.field,d=!1;if("raw"===a){var v,p,h,m=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":u.errorbar.center,g=e.extent?e.extent:"mean"===m?"stderr":"iqr";if("median"===m!=("iqr"===g)&&gr(function(e,n,t){return"".concat(e," is not usually used with ").concat(n," for ").concat(t,".")}(m,g,o)),"stderr"===g||"stdev"===g)c=[{op:g,field:f,as:"extent_"+f},{op:m,field:f,as:"center_"+f}],s=[{calculate:'datum["center_'.concat(f,'"] + datum["extent_').concat(f,'"]'),as:"upper_"+f},{calculate:'datum["center_'.concat(f,'"] - datum["extent_').concat(f,'"]'),as:"lower_"+f}],l=[{fieldPrefix:"center_",titlePrefix:Ee(m)},{fieldPrefix:"upper_",titlePrefix:Du(m,g,"+")},{fieldPrefix:"lower_",titlePrefix:Du(m,g,"-")}],d=!0;else"ci"===g?(v="mean",p="ci0",h="ci1"):(v="median",p="q1",h="q3"),c=[{op:p,field:f,as:"lower_"+f},{op:h,field:f,as:"upper_"+f},{op:v,field:f,as:"center_"+f}],l=[{fieldPrefix:"upper_",titlePrefix:go({field:f,aggregate:h,type:"quantitative"},u,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:go({field:f,aggregate:p,type:"quantitative"},u,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:go({field:f,aggregate:v,type:"quantitative"},u,{allowDisabling:!1})}]}else{(e.center||e.extent)&&gr(function(e,n){return"".concat(n?"extent ":"").concat(n&&e?"and ":"").concat(e?"center ":"").concat(n&&e?"are ":"is ","not needed when data are aggregated.")}(e.center,e.extent)),"aggregated-upper-lower"===a?(l=[],s=[{calculate:'datum["'.concat(t.field,'"]'),as:"upper_"+f},{calculate:'datum["'.concat(f,'"]'),as:"lower_"+f}]):"aggregated-error"===a&&(l=[{fieldPrefix:"",titlePrefix:f}],s=[{calculate:'datum["'.concat(f,'"] + datum["').concat(r.field,'"]'),as:"upper_"+f}],i?s.push({calculate:'datum["'.concat(f,'"] + datum["').concat(i.field,'"]'),as:"lower_"+f}):s.push({calculate:'datum["'.concat(f,'"] - datum["').concat(r.field,'"]'),as:"lower_"+f}));var y,b=F(s);try{for(b.s();!(y=b.n()).done;){var x=y.value;l.push({fieldPrefix:x.as.substring(0,6),titlePrefix:je(je(x.calculate,'datum["',""),'"]',"")})}}catch(e){b.e(e)}finally{b.f()}}return{postAggregateCalculates:s,errorBarSpecificAggregate:c,tooltipSummary:l,tooltipTitleWithFieldName:d}}(l,p,h,m,g,f,n,t),k=x.errorBarSpecificAggregate,w=x.postAggregateCalculates,A=x.tooltipSummary,D=x.tooltipTitleWithFieldName,S="x"===y?"x2":"y2",E="x"===y?"xError":"yError",B="x"===y?"xError2":"yError2",O=(a[y],a[S],a[E],a[B],nu(v(a,[y,S,E,B].map(C)),t)),_=O.bins,z=O.timeUnits,j=O.aggregate,P=O.groupby,N=O.encoding,M=[].concat(b(j),b(k)),T="raw"!==f?[]:P,L=uu(A,p,N,D);return{transform:[].concat(b(null!==(r=u.transform)&&void 0!==r?r:[]),b(_),b(z),b(0===M.length?[]:[{aggregate:M,groupby:T}]),b(w)),groupby:T,continuousAxisChannelDef:p,continuousAxis:y,encodingWithoutContinuousAxis:N,ticksOrient:"vertical"===s?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:L}}function Du(e,n,t){return Ee(e)+" "+t+" "+n}var Fu="errorband",Cu=new Ko(Fu,Su);function Su(e,n){var t=n.config,r=Au(e=u(u({},e),{},{encoding:ru(e.encoding,t)}),Fu,t),i=r.transform,a=r.continuousAxisChannelDef,o=r.continuousAxis,l=r.encodingWithoutContinuousAxis,c=r.markDef,s=r.outerSpec,f=r.tooltipEncoding,d=c,v=cu(d,o,a,l,t.errorband),p=void 0!==e.encoding.x&&void 0!==e.encoding.y,h={type:p?"area":"rect"},m={type:p?"line":"rule"},g=u(u({},d.interpolate?{interpolate:d.interpolate}:{}),d.tension&&d.interpolate?{tension:d.tension}:{});return p?(h=u(u(u({},h),g),{},{ariaRoleDescription:"errorband"}),m=u(u(u({},m),g),{},{aria:!1})):d.interpolate?gr(lr("interpolate")):d.tension&&gr(lr("tension")),u(u({},s),{},{transform:i,layer:[].concat(b(v({partName:"band",mark:h,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:f})),b(v({partName:"borders",mark:m,positionPrefix:"lower",extraEncoding:f})),b(v({partName:"borders",mark:m,positionPrefix:"upper",extraEncoding:f})))})}var Eu={};function Bu(e,n,t){var r=new Ko(e,n);Eu[e]={normalizer:r,parts:t}}Bu(pu,gu,["box","median","outliers","rule","ticks"]),Bu(bu,ku,["ticks","rule"]),Bu(Fu,Su,["band","borders"]);var Ou=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],_u={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},zu={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},ju=ke(_u),Pu=ke(zu),Nu=ke({header:1,headerRow:1,headerColumn:1,headerFacet:1}),Mu=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"];function Tu(e){var n,t=[],r=F(e||[]);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=i.expr,o=i.bind,l=v(i,["expr","bind"]);if(o&&a){var c=u(u({},l),{},{bind:o,init:a});t.push(c)}else{var s=u(u(u({},l),a?{update:a}:{}),o?{bind:o}:{});t.push(s)}}}catch(e){r.e(e)}finally{r.f()}return t}var Lu="_vgsid_",qu={single:{on:"click",fields:[Lu],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[Lu],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Ru(e){return!(!e||"legend"!==e&&!e.legend)}function Wu(e){return Ru(e)&&T(e)}function Uu(e){return"concat"in e}function Iu(e){return"vconcat"in e}function Hu(e){return"hconcat"in e}var Gu=["background","padding"];function Vu(e,n){var t,r={},i=F(Gu);try{for(i.s();!(t=i.n()).done;){var a=t.value;e&&void 0!==e[a]&&(r[a]=To(e[a]))}}catch(e){i.e(e)}finally{i.f()}return n&&(r.params=e.params),r}function Yu(e){return T(e)&&void 0!==e.step}function Ju(e){return e.view||e.width||e.height}var Xu=ke({align:1,bounds:1,center:1,columns:1,spacing:1});function Qu(e,n){var t;return null!==(t=e[n])&&void 0!==t?t:e["width"===n?"continuousWidth":"continuousHeight"]}function $u(e,n){var t=Ku(e,n);return Yu(t)?t.step:Zu}function Ku(e,n){var t;return Me(null!==(t=e[n])&&void 0!==t?t:e["width"===n?"discreteWidth":"discreteHeight"],{step:e.step})}var Zu=20,el={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:Zu},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:fa,circle:{},geoshape:{},image:{},line:{},point:{},rect:da,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:qu,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},nl=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],tl={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},rl={blue:nl[0],orange:nl[1],red:nl[2],teal:nl[3],green:nl[4],yellow:nl[5],purple:nl[6],pink:nl[7],brown:nl[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function il(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{signals:[{name:"color",value:T(e)?u(u({},rl),e):rl}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function al(e){return{signals:[{name:"fontSize",value:T(e)?u(u({},tl),e):tl}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function ol(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function ul(e){var n,t={},r=F(ke(e||{}));try{for(r.s();!(n=r.n()).done;){var i=n.value,a=e[i];t[i]=He(a)?Mo(a):To(a)}}catch(e){r.e(e)}finally{r.f()}return t}function ll(e){var n,t={},r=F(ke(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;t[i]=ul(e[i])}}catch(e){r.e(e)}finally{r.f()}return t}var cl=[].concat(b(ca),b(Qe),b(Nu),["background","padding","legend","lineBreak","scale","style","title","view"]);function sl(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.color,t=e.font,r=e.fontSize,i=v(e,["color","font","fontSize"]),a=q({},el,t?ol(t):{},n?il(n):{},r?al(r):{},i||{}),o=oe(a,cl),u=0,l=["background","lineBreak","padding"];u<l.length;u++){var c=l[u];a[c]&&(o[c]=To(a[c]))}var s,f=F(ca);try{for(f.s();!(s=f.n()).done;){var d=s.value;a[d]&&(o[d]=Wi(a[d]))}}catch(e){f.e(e)}finally{f.f()}var p,h=F(Qe);try{for(h.s();!(p=h.n()).done;){var m=p.value;a[m]&&(o[m]=ul(a[m]))}}catch(e){h.e(e)}finally{h.f()}var g,y=F(Nu);try{for(y.s();!(g=y.n()).done;){var b=g.value;a[b]&&(o[b]=Wi(a[b]))}}catch(e){y.e(e)}finally{y.f()}return a.legend&&(o.legend=Wi(a.legend)),a.scale&&(o.scale=Wi(a.scale)),a.style&&(o.style=ll(a.style)),a.title&&(o.title=Wi(a.title)),a.view&&(o.view=Wi(a.view)),o}var fl=["view"].concat(b(aa)),dl=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],vl=u({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function pl(e){e=ie(e);var n,t=F(dl);try{for(t.s();!(n=t.n()).done;){delete e[n.value]}}catch(e){t.e(e)}finally{t.f()}if(e.axis)for(var r in e.axis)He(e.axis[r])&&delete e.axis[r];if(e.legend){var i,a=F(Ou);try{for(a.s();!(i=a.n()).done;){var o=i.value;delete e.legend[o]}}catch(e){a.e(e)}finally{a.f()}}if(e.mark){var l,c=F(la);try{for(c.s();!(l=c.n()).done;){var s=l.value;delete e.mark[s]}}catch(e){c.e(e)}finally{c.f()}e.mark.tooltip&&T(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(Tu(e.params)),delete e.params);var f,d=F(fl);try{for(d.s();!(f=d.n()).done;){var v,p=f.value,h=F(la);try{for(h.s();!(v=h.n()).done;){var m=v.value;delete e[p][m]}}catch(e){h.e(e)}finally{h.f()}var g=vl[p];if(g){var y,b=F(g);try{for(b.s();!(y=b.n()).done;){var x=y.value;delete e[p][x]}}catch(e){b.e(e)}finally{b.f()}}hl(e,p)}}catch(e){d.e(e)}finally{d.f()}var k,w=F(ke(Eu));try{for(w.s();!(k=w.n()).done;){delete e[k.value]}}catch(e){w.e(e)}finally{w.f()}for(var A in function(e){var n=Po(e.title),t=n.titleMarkConfig,r=n.subtitleMarkConfig,i=n.subtitle;xe(t)||(e.style["group-title"]=u(u({},e.style["group-title"]),t));xe(r)||(e.style["group-subtitle"]=u(u({},e.style["group-subtitle"]),r));xe(i)?delete e.title:e.title=i}(e),e)T(e[A])&&xe(e[A])&&delete e[A];return xe(e)?void 0:e}function hl(e,n,t,r){var i;"view"===n&&(t="cell");var a,o=u(u({},r?e[n][r]:e[n]),e.style[null!==(i=t)&&void 0!==i?i:n]);xe(o)||(e.style[null!==(a=t)&&void 0!==a?a:n]=o);r||delete e[n]}function ml(e){return"layer"in e}var gl=function(){function e(){t(this,e)}return i(e,[{key:"map",value:function(e,n){return Ra(e)?this.mapFacet(e,n):function(e){return"repeat"in e}(e)?this.mapRepeat(e,n):Hu(e)?this.mapHConcat(e,n):Iu(e)?this.mapVConcat(e,n):Uu(e)?this.mapConcat(e,n):this.mapLayerOrUnit(e,n)}},{key:"mapLayerOrUnit",value:function(e,n){if(ml(e))return this.mapLayer(e,n);if($o(e))return this.mapUnit(e,n);throw new Error(Bt(e))}},{key:"mapLayer",value:function(e,n){var t=this;return u(u({},e),{},{layer:e.layer.map((function(e){return t.mapLayerOrUnit(e,n)}))})}},{key:"mapHConcat",value:function(e,n){var t=this;return u(u({},e),{},{hconcat:e.hconcat.map((function(e){return t.map(e,n)}))})}},{key:"mapVConcat",value:function(e,n){var t=this;return u(u({},e),{},{vconcat:e.vconcat.map((function(e){return t.map(e,n)}))})}},{key:"mapConcat",value:function(e,n){var t=this,r=e.concat;return u(u({},v(e,["concat"])),{},{concat:r.map((function(e){return t.map(e,n)}))})}},{key:"mapFacet",value:function(e,n){return u(u({},e),{},{spec:this.map(e.spec,n)})}},{key:"mapRepeat",value:function(e,n){return u(u({},e),{},{spec:this.map(e.spec,n)})}}]),e}(),yl={zero:1,center:1,normalize:1};function bl(e){return e in yl}var xl=new Set([Ii,Gi,Hi,Qi,Ji,ea,na,Yi,$i,Ki]),kl=new Set([Gi,Hi,Ii]);function wl(e,n){var t="x"===n?"y":"radius",r=e[n],i=e[t];if(Ja(r)&&Ja(i))if("quantitative"===Xa(r)&&"quantitative"===Xa(i)){if(r.stack)return n;if(i.stack)return t;var a=Ja(r)&&!!r.aggregate;if(a!==(Ja(i)&&!!i.aggregate))return a?n:t;var o,u,l=null===(o=r.scale)||void 0===o?void 0:o.type,c=null===(u=i.scale)||void 0===u?void 0:u.type;if(l&&"linear"!==l)return t;if(c&&"linear"!==c)return n}else{if("quantitative"===Xa(r))return n;if("quantitative"===Xa(i))return t}else{if("quantitative"===Xa(r))return n;if("quantitative"===Xa(i))return t}}function Al(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function Dl(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=oa(e)?e.type:e;if(!xl.has(r))return null;var i=wl(n,"x")||wl(n,"theta");if(!i)return null;var a=n[i],o=Ja(a)?lo(a,{}):void 0,u=Al(i),l=n[u],c=Ja(l)?lo(l,{}):void 0;c===o&&(c=void 0,l=void 0,u=void 0);var s,f=ut.reduce((function(e,t){if("tooltip"!==t&&Zo(n,t)){var r,i=F(U(n[t]));try{for(i.s();!(r=i.n()).done;){var a=wo(r.value);if(!a.aggregate){var o=lo(a,{});o&&o===c||e.push({channel:t,fieldDef:a})}}}catch(e){i.e(e)}finally{i.f()}}return e}),[]);if(void 0!==a.stack?s=G(a.stack)?a.stack?"zero":null:a.stack:f.length>0&&kl.has(r)&&(s="zero"),!s||!bl(s))return null;if(eu(n)&&0===f.length)return null;if(a.scale&&a.scale.type&&a.scale.type!==ci){if(t.disallowNonLinearStack)return null;gr(ar(a.scale.type))}return Za(n[it(i)])?(void 0!==a.stack&&gr(ir(i)),null):(Ja(a)&&a.aggregate&&!se(an,a.aggregate)&&gr(or(a.aggregate)),{groupbyChannel:l?u:void 0,groupbyField:c,fieldChannel:i,impute:null!==a.impute&&ra(r),stackBy:f,offset:s})}function Fl(e){e.point,e.line;var n=v(e,["point","line"]);return ke(n).length>1?n:n.type}function Cl(e){var n,t=F(["line","area","rule","trail"]);try{for(t.s();!(n=t.n()).done;){var r=n.value;e[r]&&(e=u(u({},e),{},a({},r,oe(e[r],["point","line"]))))}}catch(e){t.e(e)}finally{t.f()}return e}function Sl(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;return"transparent"===e.point?{opacity:0}:e.point?T(e.point)?e.point:{}:void 0!==e.point?null:n.point||t.shape?T(n.point)?n.point:{}:void 0}function El(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:n.line?!0===n.line?{}:n.line:void 0}var Bl=function(){function e(){t(this,e),a(this,"name","path-overlay")}return i(e,[{key:"hasMatchingType",value:function(e,n){if($o(e)){var t=e.mark,r=e.encoding,i=oa(t)?t:{type:t};switch(i.type){case"line":case"rule":case"trail":return!!Sl(i,n[i.type],r);case"area":return!!Sl(i,n[i.type],r)||!!El(i,n[i.type])}}return!1}},{key:"run",value:function(e,n,t){var r=n.config,i=e.selection,o=e.projection,l=e.mark,c=e.encoding,s=v(e,["selection","projection","mark","encoding"]),f=ru(c,r),d=oa(l)?l:{type:l},p=Sl(d,r[d.type],f),h="area"===d.type&&El(d,r[d.type]),m=[u(u({},i?{selection:i}:{}),{},{mark:Fl(u(u({},"area"===d.type&&void 0===d.opacity&&void 0===d.fillOpacity?{opacity:.7}:{}),d)),encoding:oe(f,["shape"])})],g=Dl(d,f),y=f;if(g){var b=g.fieldChannel,x=g.offset;y=u(u({},f),{},a({},b,u(u({},f[b]),x?{stack:x}:{})))}return h&&m.push(u(u({},o?{projection:o}:{}),{},{mark:u(u({type:"line"},ae(d,["clip","interpolate","tension","tooltip"])),h),encoding:y})),p&&m.push(u(u({},o?{projection:o}:{}),{},{mark:u(u({type:"point",opacity:1,filled:!0},ae(d,["clip","tooltip"])),p),encoding:y})),t(u(u({},s),{},{layer:m}),u(u({},n),{},{config:Cl(r)}))}}]),e}(),Ol=function(){function e(){t(this,e),a(this,"name","RangeStep")}return i(e,[{key:"hasMatchingType",value:function(e){if($o(e)&&e.encoding){var n,t=F(ct);try{for(t.s();!(n=t.n()).done;){var r,i=n.value,a=e.encoding[i];if(a&&Za(a))if(null==a||null===(r=a.scale)||void 0===r?void 0:r.rangeStep)return!0}}catch(e){t.e(e)}finally{t.f()}}return!1}},{key:"run",value:function(e){var n,t={},r=u({},e.encoding),i=F(ct);try{for(i.s();!(n=i.n()).done;){var o,l=n.value,c=at(l),s=r[l];if(s&&Za(s))if(null==s||null===(o=s.scale)||void 0===o?void 0:o.rangeStep){var f=s.scale,d=v(s,["scale"]),p=f,h=(p.rangeStep,v(p,["rangeStep"]));t[c]={step:f.rangeStep},gr('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),r=u(u({},r),{},a({},l,u(u({},d),xe(h)?{}:{scale:h})))}}}catch(e){i.e(e)}finally{i.f()}return u(u(u({},t),e),{},{encoding:r})}}]),e}();function _l(e,n){return n?La(e)?Tl(e,n):Pl(e,n):e}function zl(e,n){return n?Tl(e,n):e}function jl(e,n,t){var r=n[e];return function(e){return e&&!Y(e)&&"repeat"in e}(r)?r.repeat in t?u(u({},n),{},a({},e,t[r.repeat])):void gr(function(e){return'Unknown repeated value "'.concat(e,'".')}(r.repeat)):n}function Pl(e,n){if(void 0!==(e=jl("field",e,n))){if(null===e)return null;if(Ua(e)&&Ma(e.sort)){var t=jl("field",e.sort,n);e=u(u({},e),t?{sort:t}:{})}return e}}function Nl(e,n){if(Ja(e))return Pl(e,n);var t=jl("datum",e,n);return t===e||t.type||(t.type="nominal"),t}function Ml(e,n){if(!Za(e)){if(Ya(e)){var t=Nl(e.condition,n);if(t)return u(u({},e),{},{condition:t});e.condition;return v(e,["condition"])}return e}var r=Nl(e,n);return r||(Ga(e)?{condition:e.condition}:void 0)}function Tl(e,n){var t={};for(var r in e)if(H(e,r)){var i=e[r];if(M(i))t[r]=i.map((function(e){return Ml(e,n)})).filter((function(e){return e}));else{var a=Ml(i,n);void 0!==a&&(t[r]=a)}}return t}var Ll=function(){function e(){t(this,e),a(this,"name","RuleForRangedLine")}return i(e,[{key:"hasMatchingType",value:function(e){if($o(e)){var n=e.encoding;if("line"===e.mark){var t,r=F(et);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=n[tt(i)];if(n[i]&&(Ja(a)&&!Ft(a.bin)||Qa(a)))return!0}}catch(e){r.e(e)}finally{r.f()}}}return!1}},{key:"run",value:function(e,n,t){var r,i,a=e.encoding;return gr((r=!!a.x2,i=!!a.y2,"Line mark is for continuous lines and thus cannot be used with ".concat(r&&i?"x2 and y2":r?"x2":"y2",". We will use the rule mark (line segments) instead."))),t(u(u({},e),{},{mark:"rule"}),n)}}]),e}();function ql(e){var n=e.parentEncoding,t=e.encoding,r=void 0===t?{}:t,i=e.layer,a={};if(n){var o,l=F(new Set([].concat(b(ke(n)),b(ke(r)))));try{for(l.s();!(o=l.n()).done;){var c=o.value,s=r[c],f=n[c];if(Za(s)){var d=u(u({},f),s);a[c]=d}else Ya(s)?a[c]=u(u({},s),{},{condition:u(u({},f),s.condition)}):s||null===s?a[c]=s:(i||no(f)||Tr(f)||Za(f)||M(f))&&(a[c]=f)}}catch(e){l.e(e)}finally{l.f()}}else a=r;return!a||xe(a)?void 0:a}function Rl(e){var n=e.parentProjection,t=e.projection;return n&&t&&gr(function(e){var n=e.parentProjection,t=e.projection;return"Layer's shared projection ".concat(ue(n)," is overridden by a child projection ").concat(ue(t),".")}({parentProjection:n,projection:t})),null!=t?t:n}function Wl(e,n){void 0===n&&(n=sl(e.config));var t=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ul.map(e,{config:n})}(e,n),r=function(e,n,t){var r=n.width,i=n.height,a=$o(e)||ml(e),o={};a?"container"==r&&"container"==i?(o.type="fit",o.contains="padding"):"container"==r?(o.type="fit-x",o.contains="padding"):"container"==i&&(o.type="fit-y",o.contains="padding"):("container"==r&&(gr(_t("width")),r=void 0),"container"==i&&(gr(_t("height")),i=void 0));var l=u(u(u({type:"pad"},o),t?Il(t.autosize):{}),Il(e.autosize));"fit"!==l.type||a||(gr(Ot),l.type="pad");"container"==r&&"fit"!=l.type&&"fit-x"!=l.type&&gr(zt("width"));"container"==i&&"fit"!=l.type&&"fit-y"!=l.type&&gr(zt("height"));if(re(l,{type:"pad"}))return;return l}(t,{width:e.width,height:e.height,autosize:e.autosize},n);return u(u({},t),r?{autosize:r}:{})}var Ul=new(function(e){l(r,e);var n=m(r);function r(){var e;t(this,r);for(var i=arguments.length,o=new Array(i),u=0;u<i;u++)o[u]=arguments[u];return a(p(e=n.call.apply(n,[this].concat(o))),"nonFacetUnitNormalizers",[hu,xu,Cu,new Bl,new Ll,new Ol]),e}return i(r,[{key:"map",value:function(e,n){if($o(e)){var t=Zo(e.encoding,un),i=Zo(e.encoding,ln),a=Zo(e.encoding,cn);if(t||i||a)return this.mapFacetedUnit(e,n)}return g(c(r.prototype),"map",this).call(this,e,n)}},{key:"mapUnit",value:function(e,n){var t=n.parentEncoding,r=n.parentProjection,i=zl(e.encoding,n.repeater),a=u(u({},e),i?{encoding:i}:{});if(t||r)return this.mapUnitWithParentEncodingOrProjection(a,n);var o,l=this.mapLayerOrUnit.bind(this),c=F(this.nonFacetUnitNormalizers);try{for(c.s();!(o=c.n()).done;){var s=o.value;if(s.hasMatchingType(a,n.config))return s.run(a,n,l)}}catch(e){c.e(e)}finally{c.f()}return a}},{key:"mapRepeat",value:function(e,n){return function(e){return!M(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,n):this.mapNonLayerRepeat(e,n)}},{key:"mapLayerRepeat",value:function(e,n){var t=this,r=e.repeat,i=e.spec,a=v(e,["repeat","spec"]),o=r.row,l=r.column,c=r.layer,s=n.repeater,f=void 0===s?{}:s,d=n.repeaterPrefix,p=void 0===d?"":d;return o||l?this.mapRepeat(u(u({},e),{},{repeat:u(u({},o?{row:o}:{}),l?{column:l}:{}),spec:{repeat:{layer:c},spec:i}}),n):u(u({},a),{},{layer:c.map((function(e){var r=u(u({},f),{},{layer:e}),a=(i.name||"")+p+"child__layer_".concat(Fe(e)),o=t.mapLayerOrUnit(i,u(u({},n),{},{repeater:r,repeaterPrefix:a}));return o.name=a,o}))})}},{key:"mapNonLayerRepeat",value:function(e,n){var t,r=e,i=r.repeat,a=r.spec,o=r.data,l=v(r,["repeat","spec","data"]);!M(i)&&e.columns&&(e=oe(e,["columns"]),gr(qt("repeat")));var c,s=[],f=n.repeater,d=void 0===f?{}:f,p=n.repeaterPrefix,h=void 0===p?"":p,m=!M(i)&&i.row||[d?d.row:null],g=!M(i)&&i.column||[d?d.column:null],y=F(M(i)&&i||[d?d.repeat:null]);try{for(y.s();!(c=y.n()).done;){var b,x=c.value,k=F(m);try{for(k.s();!(b=k.n()).done;){var w,A=b.value,D=F(g);try{for(D.s();!(w=D.n()).done;){var C=w.value,S={repeat:x,row:A,column:C,layer:d.layer},E=(a.name||"")+h+"child__"+(M(i)?"".concat(Fe(x)):(i.row?"row_".concat(Fe(A)):"")+(i.column?"column_".concat(Fe(C)):"")),B=this.map(a,u(u({},n),{},{repeater:S,repeaterPrefix:E}));B.name=E,s.push(oe(B,["data"]))}}catch(e){D.e(e)}finally{D.f()}}}catch(e){k.e(e)}finally{k.f()}}}catch(e){y.e(e)}finally{y.f()}var O=M(i)?e.columns:i.column?i.column.length:1;return u(u({data:null!==(t=a.data)&&void 0!==t?t:o,align:"all"},l),{},{columns:O,concat:s})}},{key:"mapFacet",value:function(e,n){return La(e.facet)&&e.columns&&(e=oe(e,["columns"]),gr(qt("facet"))),g(c(r.prototype),"mapFacet",this).call(this,e,n)}},{key:"mapUnitWithParentEncodingOrProjection",value:function(e,n){var t=e.encoding,r=e.projection,i=n.parentEncoding,a=n.parentProjection,o=n.config,l=Rl({parentProjection:a,projection:r}),c=ql({parentEncoding:i,encoding:zl(t,n.repeater)});return this.mapUnit(u(u(u({},e),l?{projection:l}:{}),c?{encoding:c}:{}),{config:o})}},{key:"mapFacetedUnit",value:function(e,n){var t=e.encoding,r=t.row,i=t.column,a=t.facet,o=v(t,["row","column","facet"]),l=e.mark,c=e.width,s=e.projection,f=e.height,d=e.view,p=e.selection,h=(e.encoding,v(e,["mark","width","projection","height","view","selection","encoding"])),m=this.getFacetMappingAndLayout({row:r,column:i,facet:a},n),g=m.facetMapping,y=m.layout,b=zl(o,n.repeater);return this.mapFacet(u(u(u({},h),y),{},{facet:g,spec:u(u(u(u(u({},c?{width:c}:{}),f?{height:f}:{}),d?{view:d}:{}),s?{projection:s}:{}),{},{mark:l,encoding:b},p?{selection:p}:{})}),n)}},{key:"getFacetMappingAndLayout",value:function(e,n){var t=e.row,r=e.column,i=e.facet;if(t||r){i&&gr((y=[].concat(b(t?[un]:[]),b(r?[ln]:[])),"Facet encoding dropped as ".concat(y.join(" and ")," ").concat(y.length>1?"are":"is"," also specified.")));for(var a={},o={},l=0,c=[un,ln];l<c.length;l++){var s=c[l],f=e[s];if(f){f.align,f.center,f.spacing,f.columns;var d=v(f,["align","center","spacing","columns"]);a[s]=d;var p,h=F(["align","center","spacing"]);try{for(h.s();!(p=h.n()).done;){var m,g=p.value;if(void 0!==f[g])o[g]=null!==(m=o[g])&&void 0!==m?m:{},o[g][s]=f[g]}}catch(e){h.e(e)}finally{h.f()}}}return{facetMapping:a,layout:o}}var y,x=i.align,k=i.center,w=i.spacing,A=i.columns;return{facetMapping:_l(v(i,["align","center","spacing","columns"]),n.repeater),layout:u(u(u(u({},x?{align:x}:{}),k?{center:k}:{}),w?{spacing:w}:{}),A?{columns:A}:{})}}},{key:"mapLayer",value:function(e,n){var t=n.parentEncoding,i=n.parentProjection,a=v(n,["parentEncoding","parentProjection"]),o=e.encoding,l=e.projection,s=v(e,["encoding","projection"]),f=u(u({},a),{},{parentEncoding:ql({parentEncoding:t,encoding:o,layer:!0}),parentProjection:Rl({parentProjection:i,projection:l})});return g(c(r.prototype),"mapLayer",this).call(this,s,f)}}]),r}(gl));function Il(e){return Y(e)?{type:e}:null!=e?e:{}}var Hl=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,e),this.explicit=n,this.implicit=r}return i(e,[{key:"clone",value:function(){return new e(ie(this.explicit),ie(this.implicit))}},{key:"combine",value:function(){return u(u({},this.explicit),this.implicit)}},{key:"get",value:function(e){return Me(this.explicit[e],this.implicit[e])}},{key:"getWithExplicit",value:function(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}},{key:"setWithExplicit",value:function(e,n){void 0!==n.value&&this.set(e,n.value,n.explicit)}},{key:"set",value:function(e,n,t){return delete this[t?"implicit":"explicit"][e],this[t?"explicit":"implicit"][e]=n,this}},{key:"copyKeyFromSplit",value:function(e,n){void 0!==n.explicit[e]?this.set(e,n.explicit[e],!0):void 0!==n.implicit[e]&&this.set(e,n.implicit[e],!1)}},{key:"copyKeyFromObject",value:function(e,n){void 0!==n[e]&&this.set(e,n[e],!0)}},{key:"copyAll",value:function(e){var n,t=F(ke(e.combine()));try{for(t.s();!(n=t.n()).done;){var r=n.value,i=e.getWithExplicit(r);this.setWithExplicit(r,i)}}catch(e){t.e(e)}finally{t.f()}}}]),e}();function Gl(e){return{explicit:!0,value:e}}function Vl(e){return{explicit:!1,value:e}}function Yl(e){return function(n,t,r,i){var a=e(n.value,t.value);return a>0?n:a<0?t:Jl(n,t,r,i)}}function Jl(e,n,t,r){return e.explicit&&n.explicit&&gr(function(e,n,t,r){return"Conflicting ".concat(n.toString(),' property "').concat(e.toString(),'" (').concat(ue(t)," and ").concat(ue(r),"). Using ").concat(ue(t),".")}(t,r,e.value,n.value)),e}function Xl(e,n,t,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Jl;return void 0===e||void 0===e.value?n:e.explicit&&!n.explicit?e:n.explicit&&!e.explicit?n:re(e.value,n.value)?e:i(e,n,t,r)}var Ql,$l=function(e){l(r,e);var n=m(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t(this,r),(e=n.call(this,i,a)).explicit=i,e.implicit=a,e.parseNothing=o,e}return i(r,[{key:"clone",value:function(){var e=g(c(r.prototype),"clone",this).call(this);return e.parseNothing=this.parseNothing,e}}]),r}(Hl);function Kl(e){return"url"in e}function Zl(e){return"values"in e}function ec(e){return"name"in e&&!Kl(e)&&!Zl(e)&&!nc(e)}function nc(e){return e&&(tc(e)||rc(e)||ic(e))}function tc(e){return"sequence"in e}function rc(e){return"sphere"in e}function ic(e){return"graticule"in e}function ac(e){return"filter"in e}function oc(e){return"lookup"in e}function uc(e){return"pivot"in e}function lc(e){return"density"in e}function cc(e){return"quantile"in e}function sc(e){return"regression"in e}function fc(e){return"loess"in e}function dc(e){return"sample"in e}function vc(e){return"window"in e}function pc(e){return"joinaggregate"in e}function hc(e){return"flatten"in e}function mc(e){return"calculate"in e}function gc(e){return"bin"in e}function yc(e){return"impute"in e}function bc(e){return"timeUnit"in e}function xc(e){return"aggregate"in e}function kc(e){return"stack"in e}function wc(e){return"fold"in e}!function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"}(Ql||(Ql={}));var Ac,Dc,Fc="[",Cc="]",Sc=/[[\]{}]/,Ec={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function Bc(e,n,t){return Ac=n||"view",Dc=t||Ec,_c(e.trim()).map(zc)}function Oc(e,n,t,r,i){for(var a,o=e.length,u=0;n<o;++n){if(a=e[n],!u&&a===t)return n;i&&i.indexOf(a)>=0?--u:r&&r.indexOf(a)>=0&&++u}return n}function _c(e){for(var n=[],t=e.length,r=0,i=0;i<t;)i=Oc(e,i,",","[{","]}"),n.push(e.substring(r,i).trim()),r=++i;if(0===n.length)throw"Empty event selector: "+e;return n}function zc(e){return"["===e[0]?function(e){var n,t=e.length,r=1;if((r=Oc(e,r,Cc,Fc,Cc))===t)throw"Empty between selector: "+e;if(2!==(n=_c(e.substring(1,r))).length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(zc);var i=zc(e.slice(1).trim());if(i.between)return{between:n,stream:i};i.between=n;return i}(e):function(e){var n,t,r={source:Ac},i=[],a=[0,0],o=0,u=0,l=e.length,c=0;if("}"===e[l-1]){if(!((c=e.lastIndexOf("{"))>=0))throw"Unmatched right brace: "+e;try{a=function(e){var n=e.split(",");if(!e.length||n.length>2)throw e;return n.map((function(n){var t=+n;if(t!=t)throw e;return t}))}(e.substring(c+1,l-1))}catch(n){throw"Invalid throttle specification: "+e}l=(e=e.slice(0,c).trim()).length,c=0}if(!l)throw e;"@"===e[0]&&(o=++c);(n=Oc(e,c,":"))<l&&(i.push(e.substring(u,n).trim()),u=c=++n);if((c=Oc(e,c,Fc))===l)i.push(e.substring(u,l).trim());else if(i.push(e.substring(u,c).trim()),t=[],(u=++c)===l)throw"Unmatched left bracket: "+e;for(;c<l;){if((c=Oc(e,c,Cc))===l)throw"Unmatched left bracket: "+e;if(t.push(e.substring(u,c).trim()),c<l-1&&e[++c]!==Fc)throw"Expected left bracket: "+e;u=++c}if(!(l=i.length)||Sc.test(i[l-1]))throw"Invalid event selector: "+e;l>1?(r.type=i[1],o?r.markname=i[0].slice(1):(s=i[0],Dc[s]?r.marktype=i[0]:r.source=i[0])):r.type=i[0];var s;"!"===r.type.slice(-1)&&(r.consume=!0,r.type=r.type.slice(0,-1));null!=t&&(r.filter=t);a[0]&&(r.throttle=a[0]);a[1]&&(r.debounce=a[1]);return r}(e)}function jc(e,n,t,r){var i=Ga(n)&&n.condition,o=r(n);if(i){var l=U(i).map((function(n){var t=r(n);return u({test:function(e){return e.selection}(n)?yd(e,n.selection):xd(e,n.test)},t)}));return a({},t,[].concat(b(l),b(void 0!==o?[o]:[])))}return void 0!==o?a({},t,o):{}}function Pc(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",t=e.encoding[n];return jc(e,t,n,(function(n){return Nc(n,e.config)}))}function Nc(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"datum";if(e){if(no(e))return qo(e.value);if(Za(e)){var r=xo(e),i=r.format,a=r.formatType;return Aa({fieldOrDatumDef:e,format:i,formatType:a,expr:t,config:n})}}}function Mc(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=e.encoding,r=e.markDef,i=e.config,a=e.stack,o=t.tooltip;if(M(o))return{tooltip:Lc({tooltip:o},a,i,n)};var u=n.reactiveGeom?"datum.datum":"datum";return jc(e,o,"tooltip",(function(e){var o=Nc(e,i,u);if(o)return o;if(null!==e){var l=Io("tooltip",r,i);return!0===l&&(l={content:"encoding"}),Y(l)?{value:l}:T(l)?Tr(l)?l:"encoding"===l.content?Lc(t,a,i,n):{signal:u}:void 0}}))}function Tc(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.reactiveGeom,a={},o=i?"datum.datum":"datum",l=[];function c(r,i){var c,s,f=tt(i),d=eo(r)?r:u(u({},r),{},{type:e[f].type}),v=U(d.title||bo(d,t)).join(", ");if(st(i)){var p="x"===i?"x2":"y2",h=wo(e[p]);if(Ft(d.bin)&&h){var m=lo(d,{expr:o}),g=lo(h,{expr:o}),y=xo(d);s=_a(m,g,y.format,y.formatType,t),a[p]=!0}else if(n&&n.fieldChannel===i&&"normalize"===n.offset){var b=xo(d);s=Aa({fieldOrDatumDef:d,format:b.format,formatType:b.formatType,expr:o,config:t,normalizeStack:!0}).signal}}s=null!==(c=s)&&void 0!==c?c:Nc(d,t,o).signal,l.push({channel:i,key:v,value:s})}au(e,(function(e,n){Ja(e)?c(e,n):Va(e)&&c(e.condition,n)}));for(var s={},f=0,d=l;f<d.length;f++){var v=d[f],p=v.channel,h=v.key,m=v.value;a[p]||s[h]||(s[h]=m)}return s}function Lc(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.reactiveGeom,a=Tc(e,n,t,{reactiveGeom:i}),o=Ae(a).map((function(e){var n=y(e,2),t=n[0],r=n[1];return'"'.concat(t,'": ').concat(r)}));return o.length>0?{signal:"{".concat(o.join(", "),"}")}:void 0}function qc(e){var n=Io("aria",e.markDef,e.config);return!1===n?{}:u(u(u({},n?{aria:n}:{}),function(e){var n=e.mark,t=e.markDef,r=e.config;if(!1===r.aria)return{};var i=Io("ariaRoleDescription",t,r);if(null!=i)return{ariaRoleDescription:{value:i}};return n in Wr?{}:{ariaRoleDescription:{value:n}}}(e)),function(e){var n=e.encoding,t=e.markDef,r=e.config,i=e.stack,a=n.description;if(a)return jc(e,a,"description",(function(n){return Nc(n,e.config)}));var o=Io("description",t,r);if(null!=o)return{description:qo(o)};if(!1===r.aria)return{};var u=Tc(n,i,r);if(xe(u))return;return{description:{signal:Ae(u).map((function(e,n){var t=y(e,2),r=t[0],i=t[1];return'"'.concat(n>0?"; ":"").concat(r,': " + (').concat(i,")")})).join(" + ")}}}(e))}function Rc(e,n){var t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.markDef,a=n.encoding,o=n.config,u=r.vgChannel,l=r.defaultRef,c=r.defaultValue;void 0===l&&(void 0!==(c=null!==(t=c)&&void 0!==t?t:Io(e,i,o,{vgChannel:u,ignoreVgConfig:!0}))&&(l=qo(c)));var s=a[e];return jc(n,s,null!=u?u:e,(function(t){return ba({channel:e,channelDef:t,markDef:i,config:o,scaleName:n.scaleName(e),scale:n.getScaleComponent(e),stack:null,defaultRef:l})}))}function Wc(e){var n,t,r,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{filled:void 0},o=e.markDef,l=e.encoding,c=e.config,s=o.type,f=null!==(n=a.filled)&&void 0!==n?n:Io("filled",o,c),d=se(["bar","point","circle","square","geoshape"],s)?"transparent":void 0,v=null!==(t=null!==(r=Io(!0===f?"color":void 0,o,c,{vgChannel:"fill"}))&&void 0!==r?r:c.mark[!0===f&&"color"])&&void 0!==t?t:d,p=null!==(i=Io(!1===f?"color":void 0,o,c,{vgChannel:"stroke"}))&&void 0!==i?i:c.mark[!1===f&&"color"],h=f?"fill":"stroke",m=u(u({},v?{fill:qo(v)}:{}),p?{stroke:qo(p)}:{});return o.color&&(f?o.fill:o.stroke)&&gr(Vt("property",{fill:"fill"in o,stroke:"stroke"in o})),u(u(u(u({},m),Rc("color",e,{vgChannel:h,defaultValue:f?v:p})),Rc("fill",e,{defaultValue:l.fill?v:void 0})),Rc("stroke",e,{defaultValue:l.stroke?p:void 0}))}function Uc(e,n){var t=n[function(e){switch(e){case sn:return"xOffset";case fn:return"yOffset";case dn:return"x2Offset";case vn:return"y2Offset";case mn:return"thetaOffset";case pn:return"radiusOffset";case gn:return"theta2Offset";case hn:return"radius2Offset"}}(e)];if(t)return t}function Ic(e,n,t){var r=t.defaultPos,i=t.vgChannel,o=t.isMidPoint,u=n.encoding,l=n.markDef,c=n.config,s=n.stack,f=u[e],d=u[it(e)],v=n.scaleName(e),p=n.getScaleComponent(e),h=Uc(e,l),m=Hc({model:n,defaultPos:r,channel:e,scaleName:v,scale:p}),g=!f&&st(e)&&(u.latitude||u.longitude)?{field:n.getName(e)}:function(e){var n=e.channel,t=e.channelDef,r=e.isMidPoint,i=e.scaleName,a=e.stack,o=e.offset,u=e.markDef,l=e.config;if(Za(t)&&a&&n===a.fieldChannel){if(Ja(t)){var c=Ia({channel:n,fieldDef:t,isMidPoint:r,markDef:u,stack:a,config:l});if(void 0!==c)return ya({scaleName:i,fieldOrDatumDef:t,startSuffix:"start",band:c,offset:o})}return ga(t,i,{suffix:"end"},{offset:o})}return va(e)}({channel:e,channelDef:f,channel2Def:d,markDef:l,config:c,isMidPoint:o,scaleName:v,scale:p,stack:s,offset:h,defaultRef:m});return g?a({},i||e,g):void 0}function Hc(e){var n=e.model,t=e.defaultPos,r=e.channel,i=e.scaleName,a=e.scale,o=n.markDef,l=n.config;return function(){var e=tt(r),c=rt(r),s=Io(r,o,l,{vgChannel:c});if(void 0!==s)return xa(r,s);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){var f=a.get("type");if(se([si,pi,hi],f));else if(a.domainDefinitelyIncludesZero())return{scale:i,value:0}}if("zeroOrMin"===t)return"y"===e?{field:{group:"height"}}:{value:0};switch(e){case"radius":return{signal:"min(".concat(n.width.signal,",").concat(n.height.signal,")/2")};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":return u(u({},n[at(r)]),{},{mult:.5})}}}var Gc={left:"x",center:"xc",right:"x2"},Vc={top:"y",middle:"yc",bottom:"y2"};function Yc(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"middle";if("radius"===e||"theta"===e)return rt(e);var i,a="x"===e?"align":"baseline",o=Io(a,n,t);return Tr(o)?(gr($t(a)),i=void 0):i=o,"x"===e?Gc[i||("top"===r?"left":"center")]:Vc[i||r]}function Jc(e,n,t){var r=t.defaultPos,i=t.defaultPos2;return t.range?Xc(e,n,{defaultPos:r,defaultPos2:i}):Ic(e,n,{defaultPos:r})}function Xc(e,n,t){var r=t.defaultPos,i=t.defaultPos2,o=n.markDef,l=n.config,c=it(e),s=at(e),f=function(e,n,t){var r,i=e.encoding,o=e.mark,u=e.markDef,l=e.stack,c=e.config,s=tt(t),f=at(t),d=rt(t),v=i[s],p=e.scaleName(s),h=e.getScaleComponent(s),m=Uc(t in i||t in u?t:s,e.markDef);if(!v&&("x2"===t||"y2"===t)&&(i.latitude||i.longitude))return a({},d,{field:e.getName(t)});var g=function(e){var n=e.channel,t=e.channelDef,r=e.channel2Def,i=e.markDef,a=e.config,o=e.scaleName,u=e.scale,l=e.stack,c=e.offset,s=e.defaultRef;if(Za(t)&&l&&n.charAt(0)===l.fieldChannel.charAt(0))return ga(t,o,{suffix:"start"},{offset:c});return va({channel:n,channelDef:r,scaleName:o,scale:u,stack:l,markDef:i,config:a,offset:c,defaultRef:s})}({channel:t,channelDef:v,channel2Def:i[t],markDef:u,config:c,scaleName:p,scale:h,stack:l,offset:m,defaultRef:void 0});if(void 0!==g)return a({},d,g);return Qc(t,u)||Qc(t,(a(r={},t,Go(t,u,c.style)),a(r,f,Go(f,u,c.style)),r))||Qc(t,c[o])||Qc(t,c.mark)||a({},d,Hc({model:e,defaultPos:n,channel:t,scaleName:p,scale:h})())}(n,i,c);return u(u({},Ic(e,n,{defaultPos:r,vgChannel:f[s]?Yc(e,o,l):rt(e)})),f)}function Qc(e,n){var t=at(e),r=rt(e);return void 0!==n[r]?a({},r,xa(e,n[r])):void 0!==n[e]?a({},r,xa(e,n[e])):n[t]?a({},t,xa(e,n[t])):void 0}function $c(e,n,t){var r,i,o=e.config,l=e.encoding,c=e.markDef,s=e.stack,f=it(n),d=at(n),v=l[n],p=l[f],h=e.getScaleComponent(n),m=h?h.get("type"):void 0,g=e.scaleName(n),y=c.orient,b=null!==(r=null!==(i=l[d])&&void 0!==i?i:l.size)&&void 0!==r?r:Io("size",c,o,{vgChannel:d}),x="bar"===t&&("x"===n?"vertical"===y:"horizontal"===y);if(Ja(v)&&(Dt(v.bin)||Ft(v.bin)||v.timeUnit&&!p)&&!b&&!_i(m)){var k,w,A=Ia({channel:n,fieldDef:v,stack:s,markDef:c,config:o}),D=null===(k=e.component.axes[n])||void 0===k?void 0:k[0];return function(e){var n,t=e.fieldDef,r=e.fieldDef2,i=e.channel,o=e.band,u=e.scaleName,l=e.markDef,c=e.spacing,s=void 0===c?0:c,f=e.axisTranslate,d=e.reverse,v=e.config,p=it(i),h=rt(i),m=rt(p),g=Uc(i,l);if(Dt(t.bin)||t.timeUnit)return a(n={},m,Zc({channel:i,fieldDef:t,scaleName:u,markDef:l,band:(1-o)/2,offset:Kc(p,s,d,f,g),config:v})),a(n,h,Zc({channel:i,fieldDef:t,scaleName:u,markDef:l,band:1-(1-o)/2,offset:Kc(i,s,d,f,g),config:v})),n;if(Ft(t.bin)){var y,b,x=ga(t,u,{},{offset:Kc(p,s,d,f,g)});if(Ja(r))return a(y={},m,x),a(y,h,ga(r,u,{},{offset:Kc(i,s,d,f,g)})),y;if(Ct(t.bin)&&t.bin.step)return a(b={},m,x),a(b,h,{signal:'scale("'.concat(u,'", ').concat(lo(t,{expr:"datum"})," + ").concat(t.bin.step,")"),offset:Kc(i,s,d,f,g)}),b}return void gr(cr(p))}({fieldDef:v,fieldDef2:p,channel:n,markDef:c,scaleName:g,band:A,axisTranslate:null!==(w=null==D?void 0:D.get("translate"))&&void 0!==w?w:.5,spacing:st(n)?Io("binSpacing",c,o):void 0,reverse:h.get("reverse"),config:o})}return(Za(v)&&_i(m)||x)&&!p?function(e,n,t,r){var i,o,l=r.markDef,c=r.encoding,s=r.config,f=r.stack,d=l.orient,v=r.scaleName(t),p=r.getScaleComponent(t),h=at(t),m=it(t),g="horizontal"===d&&"y"===t||"vertical"===d&&"x"===t,y=Io(g?"size":h,l,s,{vgChannel:h});(c.size||void 0!==y)&&(g?o=Rc("size",r,{vgChannel:h,defaultValue:y}):gr(function(e){return'Cannot apply size to non-oriented mark "'.concat(e,'".')}(l.type)));var b=null!==(i=Za(n)?Ia({channel:t,fieldDef:n,markDef:l,stack:f,config:s}):void 0)&&void 0!==i?i:1;o=o||a({},h,function(e,n,t,r,i,a){if(r){var o=r.get("type");if("point"===o||"band"===o){if(void 0!==i[e].discreteBandSize)return{value:i[e].discreteBandSize};if(o===bi){var u=r.get("range");return Lr(u)&&V(u.step)?{value:u.step-2}:{value:Zu-2}}return{scale:t,band:a}}return{value:i[e].continuousBandSize}}var l=$u(i.view,n),c=Me(i[e].discreteBandSize,l-2);return void 0!==c?{value:c}:void 0}(e,h,v,p,s,b));var x="band"!==(null==p?void 0:p.get("type"))||!("band"in o[h]),k=Yc(t,l,s,x?"middle":"top"),w=Uc(t,l),A=va({channel:t,channelDef:n,markDef:l,config:s,scaleName:v,scale:p,stack:f,offset:w,defaultRef:Hc({model:r,defaultPos:"mid",channel:t,scaleName:v,scale:p}),band:x?.5:(1-b)/2});if(h)return u(a({},k,A),o);var D,F=rt(m),C=o[h],S=w?u(u({},C),{},{offset:w}):C;return a(D={},k,A),a(D,F,M(A)?[A[0],u(u({},A[1]),{},{offset:S})]:u(u({},A),{},{offset:S})),D}(t,v,n,e):Xc(n,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function Kc(e,n,t,r,i){if(Un(e))return 0;var a="x"===e||"y2"===e?-n/2:n/2;if(Tr(t)||Tr(i)||Tr(r)){var o=Wo(t),u=Wo(i),l=Wo(r);return{signal:(l?"".concat(l," + "):"")+(o?"(".concat(o," ? -1 : 1) * "):"")+(u?"(".concat(u," + ").concat(a,")"):a)}}return i=i||0,r+(t?-i-a:+i+a)}function Zc(e){var n=e.channel,t=e.fieldDef,r=e.scaleName,i=e.markDef,a=e.band,o=e.offset,u=e.config;return pa({fieldDef:t,channel:n,markDef:i,ref:ya({scaleName:r,fieldOrDatumDef:t,band:a,offset:o}),config:u})}var es=new Set(["aria"]);function ns(e,n){var t="include"===n.color?Wc(e):{},r=t.fill,i=void 0===r?void 0:r,a=t.stroke,o=void 0===a?void 0:a;return u(u(u(u(u(u(u(u(u(u(u(u({},function(e,n){return Rr.reduce((function(t,r){return es.has(r)||void 0===e[r]||"ignore"===n[r]||(t[r]=qo(e[r])),t}),{})}(e.markDef,n)),ts(e,"fill",i)),ts(e,"stroke",o)),Rc("opacity",e)),Rc("fillOpacity",e)),Rc("strokeOpacity",e)),Rc("strokeWidth",e)),Rc("strokeDash",e)),function(e){var n=e.encoding,t=e.mark,r=n.order;return!ra(t)&&no(r)?jc(e,r,"zindex",(function(e){return qo(e.value)})):{}}(e)),Mc(e)),Pc(e,"href")),qc(e))}function ts(e,n,t){var r=e.config,i=e.mark;if("hide"===Io("invalid",e.markDef,r)&&t&&!ra(i)){var o=function(e,n){var t=n.invalid,r=void 0!==t&&t,i=n.channels.reduce((function(n,t){var r=e.getScaleComponent(t);if(r){var i=r.get("type"),a=e.vgField(t,{expr:"datum"});a&&zi(i)&&(n[a]=!0)}return n}),{}),a=ke(i);if(a.length>0){var o=r?"||":"&&";return a.map((function(e){return ma(e,r)})).join(" ".concat(o," "))}return}(e,{invalid:!0,channels:gt});if(o)return a({},n,[{test:o,value:null}].concat(b(U(t))))}return t?a({},n,t):{}}function rs(e){var n=e.config;if(Io("invalid",e.markDef,n)){var t=function(e,n){var t=n.invalid,r=void 0!==t&&t,i=n.channels.reduce((function(n,t){var r=e.getScaleComponent(t);if(r){var i=r.get("type"),a=e.vgField(t,{expr:"datum"});a&&zi(i)&&(n[a]=!0)}return n}),{}),a=ke(i);if(a.length>0){var o=r?"||":"&&";return a.map((function(e){return ma(e,r)})).join(" ".concat(o," "))}return}(e,{channels:ct});if(t)return{defined:{signal:t}}}return{}}function is(e,n){if(void 0!==n)return a({},e,qo(n))}var as="voronoi",os={has:function(e){return"interval"!==e.type&&e.nearest},parse:function(e,n){if(n.events){var t,r=F(n.events);try{for(r.s();!(t=r.n()).done;){t.value.markname=e.getName(as)}}catch(e){r.e(e)}finally{r.f()}}},marks:function(e,n,t){var r=n.project.hasChannel,i=r.x,a=r.y,o=e.mark;if(ra(o))return gr('The "nearest" transform is not supported for '.concat(o," marks.")),t;var l={name:e.getName(as),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:u({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},Mc(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!a?"datum.datum.x || 0":"0"},y:{expr:a||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]},c=0,s=!1;return t.forEach((function(n,t){var r,i=null!==(r=n.name)&&void 0!==r?r:"";i===e.component.mark[0].name?c=t:i.indexOf(as)>=0&&(s=!0)})),s||t.splice(c+1,0,l),t}},us=function(){function e(n,r){t(this,e),this.debugName=r,a(this,"_children",[]),a(this,"_parent",null),a(this,"_hash",void 0),n&&(this.parent=n)}return i(e,[{key:"clone",value:function(){throw new Error("Cannot clone node")}},{key:"numChildren",value:function(){return this._children.length}},{key:"addChild",value:function(e,n){this._children.indexOf(e)>-1?gr("Attempt to add the same child twice."):void 0!==n?this._children.splice(n,0,e):this._children.push(e)}},{key:"removeChild",value:function(e){var n=this._children.indexOf(e);return this._children.splice(n,1),n}},{key:"remove",value:function(){var e,n=this._parent.removeChild(this),t=F(this._children);try{for(t.s();!(e=t.n()).done;){var r=e.value;r._parent=this._parent,this._parent.addChild(r,n++)}}catch(e){t.e(e)}finally{t.f()}}},{key:"insertAsParentOf",value:function(e){var n=e.parent;n.removeChild(this),this.parent=n,e.parent=this}},{key:"swapWithParent",value:function(){var e,n=this._parent,t=n.parent,r=F(this._children);try{for(r.s();!(e=r.n()).done;){e.value.parent=n}}catch(e){r.e(e)}finally{r.f()}this._children=[],n.removeChild(this),n.parent.removeChild(n),this.parent=t,n.parent=this}},{key:"parent",get:function(){return this._parent},set:function(e){this._parent=e,e&&e.addChild(this)}},{key:"children",get:function(){return this._children}}]),e}(),ls=function(e){l(r,e);var n=m(r);function r(e,i,o,u){var l;return t(this,r),(l=n.call(this,e,i)).type=o,l.refCounts=u,a(p(l),"_source",void 0),a(p(l),"_name",void 0),l._source=l._name=i,l.refCounts&&!(l._name in l.refCounts)&&(l.refCounts[l._name]=0),l}return i(r,[{key:"clone",value:function(){var e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}}]),i(r,[{key:"dependentFields",value:function(){return new Set}},{key:"producedFields",value:function(){return new Set}},{key:"hash",value:function(){return void 0===this._hash&&(this._hash="Output ".concat(Le())),this._hash}},{key:"getSource",value:function(){return this.refCounts[this._name]++,this._source}},{key:"isRequired",value:function(){return!!this.refCounts[this._name]}},{key:"setSource",value:function(e){this._source=e}}]),r}(us),cs=function(e){l(r,e);var n=m(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e)).formula=i,a}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.formula))}}]),i(r,[{key:"merge",value:function(e){for(var n in this.formula=u({},this.formula),e.formula)this.formula[n]&&!e.formula[n].band||(this.formula[n]=e.formula[n]);var t,r=F(e.children);try{for(r.s();!(t=r.n()).done;){var i=t.value;e.removeChild(i),i.parent=this}}catch(e){r.e(e)}finally{r.f()}e.remove()}},{key:"removeFormulas",value:function(e){var n,t={},r=F(Ae(this.formula));try{for(r.s();!(n=r.n()).done;){var i=y(n.value,2),a=i[0],o=i[1];e.has(o.as)||(t[a]=o)}}catch(e){r.e(e)}finally{r.f()}this.formula=t}},{key:"producedFields",value:function(){return new Set(we(this.formula).map((function(e){return e.as})))}},{key:"dependentFields",value:function(){return new Set(we(this.formula).map((function(e){return e.field})))}},{key:"hash",value:function(){return"TimeUnit ".concat(le(this.formula))}},{key:"assemble",value:function(){var e,n=[],t=F(we(this.formula));try{for(t.s();!(e=t.n()).done;){var r=e.value,i=r.field,a=r.as,o=Nr(r.timeUnit),l=o.unit,c=o.utc,s=v(o,["unit","utc"]);n.push(u(u(u(u({field:ze(i),type:"timeunit"},l?{units:_r(l)}:{}),c?{timezone:"utc"}:{}),s),{},{as:[a,"".concat(a,"_end")]}))}}catch(e){t.e(e)}finally{t.f()}return n}}],[{key:"makeFromEncoding",value:function(e,n){var t=n.reduceFieldDef((function(e,t,r){var i=t.field,a=t.timeUnit,o=Vp(n)?n.encoding[it(r)]:void 0,l=Vp(n)&&Ha(r,t,o,n.stack,n.markDef,n.config);if(a){var c=lo(t,{forAs:!0});e[le({as:c,field:i,timeUnit:a})]=u({as:c,field:i,timeUnit:a},l?{band:!0}:{})}return e}),{});return xe(t)?null:new r(e,t)}},{key:"makeFromTransform",value:function(e,n){var t=u({},n),i=t.timeUnit,o=v(t,["timeUnit"]),l=Nr(i),c=u(u({},o),{},{timeUnit:l});return new r(e,a({},le(c),c))}}]),r}(us),ss="_tuple_fields",fs=function e(){t(this,e),a(this,"hasChannel",void 0),a(this,"hasField",void 0),a(this,"timeUnit",void 0),a(this,"items",void 0);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];this.items=r,this.hasChannel={},this.hasField={}},ds={has:function(e){return"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!Ru(e.bind)},parse:function(e,n,t,r){r.on||delete n.events,r.clear||delete n.clear},topLevelSignals:function(e,n,t){var r=n.name,i=n.project,a=n.bind,o=n.init&&n.init[0],l=os.has(n)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((function(e,i){var c,s,f=Fe("".concat(r,"_").concat(e.field));t.filter((function(e){return e.name===f})).length||t.unshift(u(u({name:f},o?{init:Os(o[i])}:{value:null}),{},{on:n.events?[{events:n.events,update:"datum && item().mark.marktype !== 'group' ? ".concat(l,"[").concat(J(e.field),"] : null")}]:[],bind:null!==(c=null!==(s=a[e.field])&&void 0!==s?s:a[e.channel])&&void 0!==c?c:a}))})),t},signals:function(e,n,t){var r=n.name,i=n.project,a=t.filter((function(e){return e.name===r+Ws}))[0],o=r+ss,u=i.items.map((function(e){return Fe("".concat(r,"_").concat(e.field))})),l=u.map((function(e){return"".concat(e," !== null")})).join(" && ");return u.length&&(a.update="".concat(l," ? {fields: ").concat(o,", values: [").concat(u.join(", "),"]} : null")),delete a.value,delete a.on,t}},vs="_toggle",ps={has:function(e){return"multi"===e.type&&!!e.toggle},signals:function(e,n,t){return t.concat({name:n.name+vs,value:!1,on:[{events:n.events,update:n.toggle}]})},modifyExpr:function(e,n){var t=n.name+Ws,r=n.name+vs;return"".concat(r," ? null : ").concat(t,", ")+("global"===n.resolve?"".concat(r," ? null : true, "):"".concat(r," ? null : {unit: ").concat(Ys(e),"}, "))+"".concat(r," ? ").concat(t," : null")}},hs={has:function(e){return void 0!==e.clear&&!1!==e.clear},parse:function(e,n,t){t.clear&&(n.clear=Y(t.clear)?Bc(t.clear,"scope"):t.clear)},topLevelSignals:function(e,n,t){if(ds.has(n)){var r,i=F(n.project.items);try{var a=function(){var e=r.value,i=t.findIndex((function(t){return t.name===Fe("".concat(n.name,"_").concat(e.field))}));-1!==i&&t[i].on.push({events:n.clear,update:"null"})};for(i.s();!(r=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}return t},signals:function(e,n,t){function r(e,r){-1!==e&&t[e].on&&t[e].on.push({events:n.clear,update:r})}if("interval"===n.type){var i,a=F(n.project.items);try{var o=function(){var e=i.value,n=t.findIndex((function(n){return n.name===e.signals.visual}));(r(n,"[0, 0]"),-1===n)&&r(t.findIndex((function(n){return n.name===e.signals.data})),"null")};for(a.s();!(i=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}}else{var u=t.findIndex((function(e){return e.name===n.name+Ws}));r(u,"null"),ps.has(n)&&r(u=t.findIndex((function(e){return e.name===n.name+vs})),"false")}return t}},ms={has:function(e){return"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind},parse:function(e,n){var t,r=n.scales=[],i=F(n.project.items);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.channel;if(yt(o)){var u=e.getScaleComponent(o),l=u?u.get("type"):void 0;if(u&&zi(l)){var c={selection:n.name,field:a.field};u.set("selectionExtent",c,!0),r.push(a)}else gr("Scale bindings are currently only supported for scales with unbinned, continuous domains.")}}}catch(e){i.e(e)}finally{i.f()}},topLevelSignals:function(e,n,t){var r=n.scales.filter((function(e){return 0===t.filter((function(n){return n.name===e.signals.data})).length}));if(!e.parent||ys(e)||0===r.length)return t;var i=t.filter((function(e){return e.name===n.name}))[0],a=i.update;if(a.indexOf(Is)>=0)i.update="{".concat(r.map((function(e){return"".concat(J(e.field),": ").concat(e.signals.data)})).join(", "),"}");else{var o,u=F(r);try{for(u.s();!(o=u.n()).done;){var l=o.value,c="".concat(J(l.field),": ").concat(l.signals.data);a.indexOf(c)<0&&(a="".concat(a.substring(0,a.length-1),", ").concat(c,"}"))}}catch(e){u.e(e)}finally{u.f()}i.update=a}return t.concat(r.map((function(e){return{name:e.signals.data}})))},signals:function(e,n,t){if(e.parent&&!ys(e)){var r,i=F(n.scales);try{var a=function(){var e=r.value,n=t.filter((function(n){return n.name===e.signals.data}))[0];n.push="outer",delete n.value,delete n.update};for(i.s();!(r=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}return t}};function gs(e,n){var t=J(e.scaleName(n));return"domain(".concat(t,")")}function ys(e){var n;return e.parent&&Xp(e.parent)&&(null!==(n=!e.parent.parent)&&void 0!==n?n:ys(e.parent.parent))}var bs={has:function(e){var n="global"===e.resolve&&e.bind&&Ru(e.bind),t=1===e.project.items.length&&e.project.items[0].field!==Lu;return n&&!t&&gr("Legend bindings are only supported for selections over an individual field or encoding channel."),n&&t},parse:function(e,n,t,r){if(r.on||delete n.events,r.clear||delete n.clear,r.on||r.clear){var i,a='event.item && indexof(event.item.mark.role, "legend") < 0',o=F(n.events);try{for(o.s();!(i=o.n()).done;){var u,l=i.value;l.filter=U(null!==(u=l.filter)&&void 0!==u?u:[]),l.filter.indexOf(a)<0&&l.filter.push(a)}}catch(e){o.e(e)}finally{o.f()}}var c=Wu(n.bind)?n.bind.legend:"click",s=Y(c)?Bc(c,"view"):U(c);n.bind={legend:{merge:s}}},topLevelSignals:function(e,n,t){var r,i=n.name,a=Wu(n.bind)&&n.bind.legend,o=function(e){return function(n){var t=ie(n);return t.markname=e,t}},l=F(n.project.items);try{var c=function(){var e=r.value;if(!e.hasLegend)return"continue";var l="".concat(Fe(e.field),"_legend"),c="".concat(i,"_").concat(l);if(0===t.filter((function(e){return e.name===c})).length){var s=a.merge.map(o("".concat(l,"_symbols"))).concat(a.merge.map(o("".concat(l,"_labels")))).concat(a.merge.map(o("".concat(l,"_entries"))));t.unshift(u(u({name:c},n.init?{}:{value:null}),{},{on:[{events:s,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:a.merge,update:"!event.item || !datum ? null : ".concat(c),force:!0}]}))}};for(l.s();!(r=l.n()).done;)c()}catch(e){l.e(e)}finally{l.f()}return t},signals:function(e,n,t){var r=n.name,i=n.project,a=t.find((function(e){return e.name===r+Ws})),o=r+ss,l=i.items.filter((function(e){return e.hasLegend})).map((function(e){return Fe("".concat(r,"_").concat(Fe(e.field),"_legend"))})),c=l.map((function(e){return"".concat(e," !== null")})).join(" && "),s="".concat(c," ? {fields: ").concat(o,", values: [").concat(l.join(", "),"]} : null");n.events&&l.length>0?a.on.push({events:l.map((function(e){return{signal:e}})),update:s}):l.length>0&&(a.update=s,delete a.value,delete a.on);var f=t.find((function(e){return e.name===r+vs})),d=Wu(n.bind)&&n.bind.legend;return f&&(n.events?f.on.push(u(u({},f.on[0]),{},{events:d})):f.on[0].events=d),t}};var xs="_translate_anchor",ks="_translate_delta",ws={has:function(e){return"interval"===e.type&&e.translate},signals:function(e,n,t){var r=n.name,i=ms.has(n),a=r+xs,o=n.project.hasChannel,u=o.x,l=o.y,c=Bc(n.translate,"scope");return i||(c=c.map((function(e){return e.between[0].markname=r+js,e}))),t.push({name:a,value:{},on:[{events:c.map((function(e){return e.between[0]})),update:"{x: x(unit), y: y(unit)"+(void 0!==u?", extent_x: "+(i?gs(e,sn):"slice(".concat(u.signals.visual,")")):"")+(void 0!==l?", extent_y: "+(i?gs(e,fn):"slice(".concat(l.signals.visual,")")):"")+"}"}]},{name:r+ks,value:{},on:[{events:c,update:"{x: ".concat(a,".x - x(unit), y: ").concat(a,".y - y(unit)}")}]}),void 0!==u&&As(e,n,u,"width",t),void 0!==l&&As(e,n,l,"height",t),t}};function As(e,n,t,r,i){var a,o=n.name,u=o+xs,l=o+ks,c=t.channel,s=ms.has(n),f=i.filter((function(e){return e.name===t.signals[s?"data":"visual"]}))[0],d=e.getSizeSignalRef(r).signal,v=e.getScaleComponent(c),p=v.get("type"),h=s&&c===sn?"-":"",m="".concat(u,".extent_").concat(c),g="".concat(h).concat(l,".").concat(c," / ")+(s?"".concat(d):"span(".concat(m,")")),y="".concat(s?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear","(").concat(m,", ").concat(g)+(s&&"pow"===p?", ".concat(null!==(a=v.get("exponent"))&&void 0!==a?a:1):"")+")";f.on.push({events:{signal:l},update:s?y:"clampRange(".concat(y,", 0, ").concat(d,")")})}var Ds="_zoom_anchor",Fs="_zoom_delta",Cs={has:function(e){return"interval"===e.type&&e.zoom},signals:function(e,n,t){var r=n.name,i=ms.has(n),a=r+Fs,o=n.project.hasChannel,u=o.x,l=o.y,c=J(e.scaleName(sn)),s=J(e.scaleName(fn)),f=Bc(n.zoom,"scope");return i||(f=f.map((function(e){return e.markname=r+js,e}))),t.push({name:r+Ds,on:[{events:f,update:i?"{"+[c?"x: invert(".concat(c,", x(unit))"):"",s?"y: invert(".concat(s,", y(unit))"):""].filter((function(e){return!!e})).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:f,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==u&&Ss(e,n,u,"width",t),void 0!==l&&Ss(e,n,l,"height",t),t}};function Ss(e,n,t,r,i){var a,o=n.name,u=t.channel,l=ms.has(n),c=i.filter((function(e){return e.name===t.signals[l?"data":"visual"]}))[0],s=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(u),d=f.get("type"),v=l?gs(e,u):c.name,p=o+Fs,h="".concat(o).concat(Ds,".").concat(u),m="".concat(l?"log"===d?"zoomLog":"pow"===d?"zoomPow":"zoomLinear":"zoomLinear","(").concat(v,", ").concat(h,", ").concat(p)+(l&&"pow"===d?", ".concat(null!==(a=f.get("exponent"))&&void 0!==a?a:1):"")+")";c.on.push({events:{signal:p},update:l?m:"clampRange(".concat(m,", 0, ").concat(s,")")})}var Es=[{has:function(){return!0},parse:function(e,n,t){var r,i,o,l=n.name,c=null!==(r=n.project)&&void 0!==r?r:n.project=new fs,s={},f={},d=new Set,v=function(e,n){for(var t="visual"===n?e.channel:e.field,r=Fe("".concat(l,"_").concat(t)),i=1;d.has(r);i++)r=Fe("".concat(l,"_").concat(t,"_").concat(i));return d.add(r),a({},n,r)};if(!t.fields&&!t.encodings){var p=e.config.selection[t.type];if(t.init){var h,m=F(U(t.init));try{for(m.s();!(h=m.n()).done;){var g,y=h.value,b=F(ke(y));try{for(b.s();!(g=b.n()).done;){var x=g.value;Kn[x]?(t.encodings||(t.encodings=[])).push(x):"interval"===t.type?(gr('Interval selections should be initialized using "x" and/or "y" keys.'),t.encodings=p.encodings):(t.fields||(t.fields=[])).push(x)}}catch(e){b.e(e)}finally{b.f()}}}catch(e){m.e(e)}finally{m.f()}}else t.encodings=p.encodings,t.fields=p.fields}var k,w=F(null!==(i=t.fields)&&void 0!==i?i:[]);try{for(w.s();!(k=w.n()).done;){var A=k.value,D={type:"E",field:A};D.signals=u({},v(D,"data")),c.items.push(D),c.hasField[A]=D}}catch(e){w.e(e)}finally{w.f()}var C,S=F(null!==(o=t.encodings)&&void 0!==o?o:[]);try{for(S.s();!(C=S.n()).done;){var E=C.value,B=e.fieldDef(E);if(B){var O=B.field;if(B.aggregate){gr(Mt(E,B.aggregate));continue}if(!O){gr(Nt(E));continue}if(B.timeUnit){O=e.vgField(E);var _={timeUnit:B.timeUnit,as:O,field:B.field};f[le(_)]=_}if(!s[O]){var z="E";if("interval"===n.type)zi(e.getScaleComponent(E).get("type"))&&(z="R");else B.bin&&(z="R-RE");var j={field:O,channel:E,type:z};j.signals=u(u({},v(j,"data")),v(j,"visual")),c.items.push(s[O]=j),c.hasField[O]=c.hasChannel[E]=s[O]}}else gr(Nt(E))}}catch(e){S.e(e)}finally{S.f()}if(t.init){var P=function(e){return c.items.map((function(n){return void 0!==e[n.channel]?e[n.channel]:e[n.field]}))};if("interval"===t.type)n.init=P(t.init);else{var N=U(t.init);n.init=N.map(P)}}xe(f)||(c.timeUnit=new cs(null,f))},signals:function(e,n,t){var r=n.name+ss;return t.filter((function(e){return e.name===r})).length>0?t:t.concat({name:r,value:n.project.items.map((function(e){e.signals,e.hasLegend;var n=v(e,["signals","hasLegend"]);return n.field=ze(n.field),n}))})}},ps,ms,bs,ws,Cs,ds,os,hs];function Bs(e,n){var t,r=F(Es);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.has(e)&&n(i)}}catch(e){r.e(e)}finally{r.f()}}function Os(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P;if(M(e)){var r=e.map((function(e){return Os(e,n,t)}));return n?"[".concat(r.join(", "),"]"):r}return yr(e)?t(n?Dr(e):Cr(e)):n?t(JSON.stringify(e)):e}function _s(e,n){return Gs(e,(function(t,r){n=r.marks?r.marks(e,t,n):n,Bs(t,(function(r){r.marks&&(n=r.marks(e,t,n))}))})),n}function zs(e){return e.map((function(e){return e.on&&!e.on.length&&delete e.on,e}))}var js="_brush",Ps="_scale_trigger",Ns={signals:function(e,n){var t=n.name,r=t+ss,i=ms.has(n),a=[],o=[],l=[];if(n.translate&&!i){var c="!event.item || event.item.mark.name !== ".concat(J(t+js));Ms(n,(function(e,n){var t,r=U(null!==(t=n.between[0].filter)&&void 0!==t?t:n.between[0].filter=[]);return r.indexOf(c)<0&&r.push(c),e}))}n.project.items.forEach((function(t,r){var i=t.channel;if(i===sn||i===fn){var c=n.init?n.init[r]:null,s=function(e,n,t,r){var i=t.channel,a=t.signals.visual,o=t.signals.data,l=ms.has(n),c=J(e.scaleName(i)),s=e.getScaleComponent(i),f=s?s.get("type"):void 0,d=function(e){return"scale(".concat(c,", ").concat(e,")")},v=e.getSizeSignalRef(i===sn?"width":"height").signal,p="".concat(i,"(unit)"),h=Ms(n,(function(e,n){return[].concat(b(e),[{events:n.between[0],update:"[".concat(p,", ").concat(p,"]")},{events:n,update:"[".concat(a,"[0], clamp(").concat(p,", 0, ").concat(v,")]")}])}));return h.push({events:{signal:n.name+Ps},update:zi(f)?"[".concat(d("".concat(o,"[0]")),", ").concat(d("".concat(o,"[1]")),"]"):"[0, 0]"}),l?[{name:o,on:[]}]:[u(u({name:a},r?{init:Os(r,!0,d)}:{value:[]}),{},{on:h}),u(u({name:o},r?{init:Os(r)}:{}),{},{on:[{events:{signal:a},update:"".concat(a,"[0] === ").concat(a,"[1] ? null : invert(").concat(c,", ").concat(a,")")}]})]}(e,n,t,c),f=t.signals.data,d=t.signals.visual,v=J(e.scaleName(i)),p=zi(e.getScaleComponent(i).get("type"))?"+":"";a.push.apply(a,b(s)),o.push(f),l.push({scaleName:e.scaleName(i),expr:"(!isArray(".concat(f,") || ")+"(".concat(p,"invert(").concat(v,", ").concat(d,")[0] === ").concat(p).concat(f,"[0] && ")+"".concat(p,"invert(").concat(v,", ").concat(d,")[1] === ").concat(p).concat(f,"[1]))")})}else gr("Interval selections only support x and y encoding channels.")})),i||a.push({name:t+Ps,value:{},on:[{events:l.map((function(e){return{scale:e.scaleName}})),update:l.map((function(e){return e.expr})).join(" && ")+" ? ".concat(t+Ps," : {}")}]});var s=n.init,f="unit: ".concat(Ys(e),", fields: ").concat(r,", values");return a.concat(u(u({name:t+Ws},s?{init:"{".concat(f,": ").concat(Os(s),"}")}:{}),{},{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+" ? {".concat(f,": [").concat(o,"]} : null")}]}))},modifyExpr:function(e,n){return n.name+Ws+", "+("global"===n.resolve?"true":"{unit: ".concat(Ys(e),"}"))},marks:function(e,n,t){var r=n.name,i=n.project.hasChannel,a=i.x,o=i.y,l=a&&a.signals.visual,c=o&&o.signals.visual,s="data(".concat(J(n.name+Rs),")");if(ms.has(n))return t;var f={x:void 0!==a?{signal:"".concat(l,"[0]")}:{value:0},y:void 0!==o?{signal:"".concat(c,"[0]")}:{value:0},x2:void 0!==a?{signal:"".concat(l,"[1]")}:{field:{group:"width"}},y2:void 0!==o?{signal:"".concat(c,"[1]")}:{field:{group:"height"}}};if("global"===n.resolve){var d,p=F(ke(f));try{for(p.s();!(d=p.n()).done;){var h=d.value;f[h]=[u({test:"".concat(s,".length && ").concat(s,"[0].unit === ").concat(Ys(e))},f[h]),{value:0}]}}catch(e){p.e(e)}finally{p.f()}}var m=n.mark,g=m.fill,y=m.fillOpacity,x=m.cursor,k=v(m,["fill","fillOpacity","cursor"]),w=ke(k).reduce((function(e,n){return e[n]=[{test:[void 0!==a&&"".concat(l,"[0] !== ").concat(l,"[1]"),void 0!==o&&"".concat(c,"[0] !== ").concat(c,"[1]")].filter((function(e){return e})).join(" && "),value:k[n]},{value:null}],e}),{});return[{name:r+js+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:g},fillOpacity:{value:y}},update:f}}].concat(b(t),[{name:r+js,type:"rect",clip:!0,encode:{enter:u(u({},x?{cursor:{value:x}}:{}),{},{fill:{value:"transparent"}}),update:u(u({},f),w)}}])}};function Ms(e,n){return e.events.reduce((function(e,t){return t.between?n(e,t):(gr("".concat(t," is not an ordered event stream for interval selections.")),e)}),[])}function Ts(e,n){var t=n.name,r=t+ss,i=n.project,a="(item().isVoronoi ? datum.datum : datum)",o=i.items.map((function(n){var t=e.fieldDef(n.channel);return t&&t.bin?"[".concat(a,"[").concat(J(e.vgField(n.channel,{})),"], ")+"".concat(a,"[").concat(J(e.vgField(n.channel,{binSuffix:"end"})),"]]"):"".concat(a,"[").concat(J(n.field),"]")})).join(", "),u="unit: ".concat(Ys(e),", fields: ").concat(r,", values"),l=n.events;return[{name:t+Ws,on:l?[{events:l,update:"datum && item().mark.marktype !== 'group' ? {".concat(u,": [").concat(o,"]} : null"),force:!0}]:[]}]}var Ls={signals:Ts,modifyExpr:function(e,n){return n.name+Ws+", "+("global"===n.resolve?"null":"{unit: ".concat(Ys(e),"}"))}},qs={signals:Ts,modifyExpr:function(e,n){return n.name+Ws+", "+("global"===n.resolve?"true":"{unit: ".concat(Ys(e),"}"))}},Rs="_store",Ws="_tuple",Us="_modify",Is="vlSelectionResolve",Hs={single:qs,multi:Ls,interval:Ns};function Gs(e,n){var t=e.component.selection;if(t){var r,i=F(we(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;if(!0===n(a,Hs[a.type]))break}}catch(e){i.e(e)}finally{i.f()}}}function Vs(e){for(var n=e.parent;n&&!Yp(n);)n=n.parent;return n}function Ys(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{escape:!0},t=n.escape,r=t?J(e.name):e.name,i=Vs(e);if(i){var a,o=i.facet,u=F(Jn);try{for(u.s();!(a=u.n()).done;){var l=a.value;o[l]&&(r+=" + '__facet_".concat(l,"_' + (facet[").concat(J(i.vgField(l)),"])"))}}catch(e){u.e(e)}finally{u.f()}}return r}function Js(e){var n=!1;return Gs(e,(function(e){n=n||e.project.items.some((function(e){return e.field===Lu}))})),n}var Xs,Qs,$s,Ks,Zs,ef="RawCode",nf="Literal",tf="Property",rf="Identifier",af="ArrayExpression",of="BinaryExpression",uf="CallExpression",lf="ConditionalExpression",cf="LogicalExpression",sf="MemberExpression",ff="ObjectExpression",df="UnaryExpression";function vf(e){this.type=e}vf.prototype.visit=function(e){var n,t,r;if(e(this))return 1;for(t=0,r=(n=function(e){switch(e.type){case af:return e.elements;case of:case cf:return[e.left,e.right];case uf:return[e.callee].concat(e.arguments);case lf:return[e.test,e.consequent,e.alternate];case sf:return[e.object,e.property];case ff:return e.properties;case tf:return[e.key,e.value];case df:return[e.argument];case rf:case nf:case ef:default:return[]}}(this)).length;t<r;++t)if(n[t].visit(e))return 1};(Xs={})[1]="Boolean",Xs[2]="<end>",Xs[3]="Identifier",Xs[4]="Keyword",Xs[5]="Null",Xs[6]="Numeric",Xs[7]="Punctuator",Xs[8]="String",Xs[9]="RegularExpression";var pf="Identifier",hf="Unexpected token %0",mf="Invalid regular expression",gf="Invalid regular expression: missing /",yf="Octal literals are not allowed in strict mode.",bf="ILLEGAL",xf="Disabled.",kf=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),wf=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Af(e,n){if(!e)throw new Error("ASSERT: "+n)}function Df(e){return e>=48&&e<=57}function Ff(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Cf(e){return"01234567".indexOf(e)>=0}function Sf(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Ef(e){return 10===e||13===e||8232===e||8233===e}function Bf(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&kf.test(String.fromCharCode(e))}function Of(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&wf.test(String.fromCharCode(e))}var _f={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function zf(){for(;$s<Ks;){var e=Qs.charCodeAt($s);if(!Sf(e)&&!Ef(e))break;++$s}}function jf(e){var n,t,r,i=0;for(t="u"===e?4:2,n=0;n<t;++n)$s<Ks&&Ff(Qs[$s])?(r=Qs[$s++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):Xf({},hf,bf);return String.fromCharCode(i)}function Pf(){var e,n,t,r;for(n=0,"}"===(e=Qs[$s])&&Xf({},hf,bf);$s<Ks&&Ff(e=Qs[$s++]);)n=16*n+"0123456789abcdef".indexOf(e.toLowerCase());return(n>1114111||"}"!==e)&&Xf({},hf,bf),n<=65535?String.fromCharCode(n):(t=55296+(n-65536>>10),r=56320+(n-65536&1023),String.fromCharCode(t,r))}function Nf(){var e,n;for(e=Qs.charCodeAt($s++),n=String.fromCharCode(e),92===e&&(117!==Qs.charCodeAt($s)&&Xf({},hf,bf),++$s,(e=jf("u"))&&"\\"!==e&&Bf(e.charCodeAt(0))||Xf({},hf,bf),n=e);$s<Ks&&Of(e=Qs.charCodeAt($s));)++$s,n+=String.fromCharCode(e),92===e&&(n=n.substr(0,n.length-1),117!==Qs.charCodeAt($s)&&Xf({},hf,bf),++$s,(e=jf("u"))&&"\\"!==e&&Of(e.charCodeAt(0))||Xf({},hf,bf),n+=e);return n}function Mf(){var e,n;return e=$s,{type:1===(n=92===Qs.charCodeAt($s)?Nf():function(){var e,n;for(e=$s++;$s<Ks;){if(92===(n=Qs.charCodeAt($s)))return $s=e,Nf();if(!Of(n))break;++$s}return Qs.slice(e,$s)}()).length?3:_f.hasOwnProperty(n)?4:"null"===n?5:"true"===n||"false"===n?1:3,value:n,start:e,end:$s}}function Tf(){var e,n,t,r,i=$s,a=Qs.charCodeAt($s),o=Qs[$s];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++$s,{type:7,value:String.fromCharCode(a),start:i,end:$s};default:if(61===(e=Qs.charCodeAt($s+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return $s+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:$s};case 33:case 61:return $s+=2,61===Qs.charCodeAt($s)&&++$s,{type:7,value:Qs.slice(i,$s),start:i,end:$s}}}return">>>="===(r=Qs.substr($s,4))?{type:7,value:r,start:i,end:$s+=4}:">>>"===(t=r.substr(0,3))||"<<="===t||">>="===t?{type:7,value:t,start:i,end:$s+=3}:o===(n=t.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===n?{type:7,value:n,start:i,end:$s+=2}:"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++$s}:void Xf({},hf,bf)}function Lf(){var e,n,t;if(Af(Df((t=Qs[$s]).charCodeAt(0))||"."===t,"Numeric literal must start with a decimal digit or a decimal point"),n=$s,e="","."!==t){if(e=Qs[$s++],t=Qs[$s],"0"===e){if("x"===t||"X"===t)return++$s,function(e){for(var n="";$s<Ks&&Ff(Qs[$s]);)n+=Qs[$s++];return 0===n.length&&Xf({},hf,bf),Bf(Qs.charCodeAt($s))&&Xf({},hf,bf),{type:6,value:parseInt("0x"+n,16),start:e,end:$s}}(n);if(Cf(t))return function(e){for(var n="0"+Qs[$s++];$s<Ks&&Cf(Qs[$s]);)n+=Qs[$s++];return(Bf(Qs.charCodeAt($s))||Df(Qs.charCodeAt($s)))&&Xf({},hf,bf),{type:6,value:parseInt(n,8),octal:!0,start:e,end:$s}}(n);t&&Df(t.charCodeAt(0))&&Xf({},hf,bf)}for(;Df(Qs.charCodeAt($s));)e+=Qs[$s++];t=Qs[$s]}if("."===t){for(e+=Qs[$s++];Df(Qs.charCodeAt($s));)e+=Qs[$s++];t=Qs[$s]}if("e"===t||"E"===t)if(e+=Qs[$s++],"+"!==(t=Qs[$s])&&"-"!==t||(e+=Qs[$s++]),Df(Qs.charCodeAt($s)))for(;Df(Qs.charCodeAt($s));)e+=Qs[$s++];else Xf({},hf,bf);return Bf(Qs.charCodeAt($s))&&Xf({},hf,bf),{type:6,value:parseFloat(e),start:n,end:$s}}function qf(){var e,n,t,r;return Zs=null,zf(),e=$s,n=function(){var e,n,t,r;for(Af("/"===(e=Qs[$s]),"Regular expression literal must start with a slash"),n=Qs[$s++],t=!1,r=!1;$s<Ks;)if(n+=e=Qs[$s++],"\\"===e)Ef((e=Qs[$s++]).charCodeAt(0))&&Xf({},gf),n+=e;else if(Ef(e.charCodeAt(0)))Xf({},gf);else if(t)"]"===e&&(t=!1);else{if("/"===e){r=!0;break}"["===e&&(t=!0)}return r||Xf({},gf),{value:n.substr(1,n.length-2),literal:n}}(),t=function(){var e,n,t;for(n="",t="";$s<Ks&&Of((e=Qs[$s]).charCodeAt(0));)++$s,"\\"===e&&$s<Ks?Xf({},hf,bf):(t+=e,n+=e);return t.search(/[^gimuy]/g)>=0&&Xf({},mf,t),{value:t,literal:n}}(),r=function(e,n){var t=e;n.indexOf("u")>=0&&(t=t.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,n){if(parseInt(n,16)<=1114111)return"x";Xf({},mf)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(t)}catch(e){Xf({},mf)}try{return new RegExp(e,n)}catch(e){return null}}(n.value,t.value),{literal:n.literal+t.literal,value:r,regex:{pattern:n.value,flags:t.value},start:e,end:$s}}function Rf(){if(zf(),$s>=Ks)return{type:2,start:$s,end:$s};var e=Qs.charCodeAt($s);return Bf(e)?Mf():40===e||41===e||59===e?Tf():39===e||34===e?function(){var e,n,t,r,i="",a=!1;for(Af("'"===(e=Qs[$s])||'"'===e,"String literal must starts with a quote"),n=$s,++$s;$s<Ks;){if((t=Qs[$s++])===e){e="";break}if("\\"===t)if((t=Qs[$s++])&&Ef(t.charCodeAt(0)))"\r"===t&&"\n"===Qs[$s]&&++$s;else switch(t){case"u":case"x":"{"===Qs[$s]?(++$s,i+=Pf()):i+=jf(t);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:Cf(t)?(0!==(r="01234567".indexOf(t))&&(a=!0),$s<Ks&&Cf(Qs[$s])&&(a=!0,r=8*r+"01234567".indexOf(Qs[$s++]),"0123".indexOf(t)>=0&&$s<Ks&&Cf(Qs[$s])&&(r=8*r+"01234567".indexOf(Qs[$s++]))),i+=String.fromCharCode(r)):i+=t}else{if(Ef(t.charCodeAt(0)))break;i+=t}}return""!==e&&Xf({},hf,bf),{type:8,value:i,octal:a,start:n,end:$s}}():46===e?Df(Qs.charCodeAt($s+1))?Lf():Tf():Df(e)?Lf():Tf()}function Wf(){var e=Zs;return $s=e.end,Zs=Rf(),$s=e.end,e}function Uf(){var e=$s;Zs=Rf(),$s=e}function If(e,n,t){var r=new vf("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=n,r.right=t,r}function Hf(e,n){var t=new vf("CallExpression");return t.callee=e,t.arguments=n,t}function Gf(e){var n=new vf(pf);return n.name=e,n}function Vf(e){var n=new vf("Literal");return n.value=e.value,n.raw=Qs.slice(e.start,e.end),e.regex&&("//"===n.raw&&(n.raw="/(?:)/"),n.regex=e.regex),n}function Yf(e,n,t){var r=new vf("MemberExpression");return r.computed="["===e,r.object=n,r.property=t,r.computed||(t.member=!0),r}function Jf(e,n,t){var r=new vf("Property");return r.key=n,r.value=t,r.kind=e,r}function Xf(e,n){var t,r=Array.prototype.slice.call(arguments,2),i=n.replace(/%(\d)/g,(function(e,n){return Af(n<r.length,"Message reference must be in range"),r[n]}));throw(t=new Error(i)).index=$s,t.description=i,t}function Qf(e){2===e.type&&Xf(e,"Unexpected end of input"),6===e.type&&Xf(e,"Unexpected number"),8===e.type&&Xf(e,"Unexpected string"),3===e.type&&Xf(e,"Unexpected identifier"),4===e.type&&Xf(e,"Unexpected reserved word"),Xf(e,hf,e.value)}function $f(e){var n=Wf();7===n.type&&n.value===e||Qf(n)}function Kf(e){return 7===Zs.type&&Zs.value===e}function Zf(e){return 4===Zs.type&&Zs.value===e}function ed(){var e=[];for($s=Zs.start,$f("[");!Kf("]");)Kf(",")?(Wf(),e.push(null)):(e.push(dd()),Kf("]")||$f(","));return Wf(),function(e){var n=new vf("ArrayExpression");return n.elements=e,n}(e)}function nd(){$s=Zs.start;var e=Wf();return 8===e.type||6===e.type?(e.octal&&Xf(e,yf),Vf(e)):Gf(e.value)}function td(){var e,n,t;return $s=Zs.start,3===(e=Zs).type?(t=nd(),$f(":"),Jf("init",t,dd())):2!==e.type&&7!==e.type?(n=nd(),$f(":"),Jf("init",n,dd())):void Qf(e)}function rd(){var e,n,t=[],r={},i=String;for($s=Zs.start,$f("{");!Kf("}");)n="$"+((e=td()).key.type===pf?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,n)?Xf({},"Duplicate data property in object literal not allowed in strict mode"):r[n]=!0,t.push(e),Kf("}")||$f(",");return $f("}"),function(e){var n=new vf("ObjectExpression");return n.properties=e,n}(t)}var id={if:1};function ad(){var e,n,t;if(Kf("("))return function(){$f("(");var e=vd();return $f(")"),e}();if(Kf("["))return ed();if(Kf("{"))return rd();if(e=Zs.type,$s=Zs.start,3===e||id[Zs.value])t=Gf(Wf().value);else if(8===e||6===e)Zs.octal&&Xf(Zs,yf),t=Vf(Wf());else{if(4===e)throw new Error(xf);1===e?((n=Wf()).value="true"===n.value,t=Vf(n)):5===e?((n=Wf()).value=null,t=Vf(n)):Kf("/")||Kf("/=")?(t=Vf(qf()),Uf()):Qf(Wf())}return t}function od(){var e=[];if($f("("),!Kf(")"))for(;$s<Ks&&(e.push(dd()),!Kf(")"));)$f(",");return $f(")"),e}function ud(){return $f("."),function(){$s=Zs.start;var e=Wf();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||Qf(e),Gf(e.value)}()}function ld(){$f("[");var e=vd();return $f("]"),e}function cd(){var e=function(){var e;for(e=ad();;)if(Kf("."))e=Yf(".",e,ud());else if(Kf("("))e=Hf(e,od());else{if(!Kf("["))break;e=Yf("[",e,ld())}return e}();if(7===Zs.type&&(Kf("++")||Kf("--")))throw new Error(xf);return e}function sd(){var e,n,t,r,i;if(7!==Zs.type&&4!==Zs.type)n=cd();else{if(Kf("++")||Kf("--"))throw new Error(xf);if(Kf("+")||Kf("-")||Kf("~")||Kf("!"))e=Wf(),n=sd(),t=e.value,r=n,(i=new vf("UnaryExpression")).operator=t,i.argument=r,i.prefix=!0,n=i;else{if(Zf("delete")||Zf("void")||Zf("typeof"))throw new Error(xf);n=cd()}}return n}function fd(e){var n=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":n=1;break;case"&&":n=2;break;case"|":n=3;break;case"^":n=4;break;case"&":n=5;break;case"==":case"!=":case"===":case"!==":n=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":n=7;break;case"<<":case">>":case">>>":n=8;break;case"+":case"-":n=9;break;case"*":case"/":case"%":n=11}return n}function dd(){var e,n;return e=function(){var e,n,t,r,i,a,o,u,l,c;if(e=Zs,l=sd(),0===(i=fd(r=Zs)))return l;for(r.prec=i,Wf(),n=[e,Zs],a=[l,r,o=sd()];(i=fd(Zs))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),u=a.pop().value,l=a.pop(),n.pop(),t=If(u,l,o),a.push(t);(r=Wf()).prec=i,a.push(r),n.push(Zs),t=sd(),a.push(t)}for(t=a[c=a.length-1],n.pop();c>1;)n.pop(),t=If(a[c-1].value,a[c-2],t),c-=2;return t}(),Kf("?")&&(Wf(),n=dd(),$f(":"),e=function(e,n,t){var r=new vf("ConditionalExpression");return r.test=e,r.consequent=n,r.alternate=t,r}(e,n,dd())),e}function vd(){var e=dd();if(Kf(","))throw new Error(xf);return e}function pd(e){var n=[];return"Identifier"===e.type?[e.name]:"Literal"===e.type?[e.value]:("MemberExpression"===e.type&&(n.push.apply(n,b(pd(e.object))),n.push.apply(n,b(pd(e.property)))),n)}function hd(e){return"MemberExpression"===e.object.type?hd(e.object):"datum"===e.object.name}function md(e){var n=function(e){$s=0,Ks=(Qs=e).length,Zs=null,Uf();var n=vd();if(2!==Zs.type)throw new Error("Unexpect token after expression.");return n}(e),t=new Set;return n.visit((function(e){"MemberExpression"===e.type&&hd(e)&&t.add(pd(e).slice(1).join("."))})),t}var gd=function(e){l(r,e);var n=m(r);function r(e,i,o){var u;return t(this,r),(u=n.call(this,e)).model=i,u.filter=o,a(p(u),"expr",void 0),a(p(u),"_dependentFields",void 0),u.expr=xd(u.model,u.filter,p(u)),u._dependentFields=md(u.expr),u}return i(r,[{key:"clone",value:function(){return new r(null,this.model,ie(this.filter))}}]),i(r,[{key:"dependentFields",value:function(){return this._dependentFields}},{key:"producedFields",value:function(){return new Set}},{key:"assemble",value:function(){return{type:"filter",expr:this.expr}}},{key:"hash",value:function(){return"Filter ".concat(this.expr)}}]),r}(us);function yd(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"datum",i=[];function a(n){var a=Fe(n),o=e.getSelectionComponent(a,n),u=J(a+Rs);if(o.project.timeUnit){var l=null!=t?t:e.component.data.raw,c=o.project.timeUnit.clone();l.parent?c.insertAsParentOf(l):l.parent=c}return"none"!==o.empty&&i.push(u),"vlSelectionTest(".concat(u,", ").concat(r)+("global"===o.resolve?")":", ".concat(J(o.resolve),")"))}var o=Ce(n,a);return(i.length?"!("+i.map((function(e){return"length(data(".concat(e,"))")})).join(" || ")+") || ":"")+"(".concat(o,")")}function bd(e,n){var t=n.encoding,r=n.field;if(t||r){if(t&&!r){var i=e.project.items.filter((function(e){return e.channel===t}));!i.length||i.length>1?(r=e.project.items[0].field,gr((i.length?"Multiple ":"No ")+"matching ".concat(J(t)," encoding found for selection ").concat(J(n.selection),". ")+'Using "field": '.concat(J(r),"."))):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&gr('A "field" or "encoding" must be specified when using a selection as a scale domain. '+'Using "field": '.concat(J(r),"."));return"".concat(e.name,"[").concat(J(r),"]")}function xd(e,n,t){return Ce(n,(function(n){return Y(n)?n:function(e){return null==e?void 0:e.selection}(n)?yd(e,n.selection,t):ei(n)}))}function kd(e,n){if(e)return M(e)&&!No(e)?e.map((function(e){return bo(e,n)})).join(", "):e}function wd(e,n,t,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[n]=null!==(a=e.encode[n])&&void 0!==a?a:{},e.encode[n].update=null!==(o=e.encode[n].update)&&void 0!==o?o:{},e.encode[n].update[t]=r}function Ad(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{header:!1},i=e.combine(),a=i.disable,o=i.orient,l=i.scale,c=i.labelExpr,s=i.title,f=i.zindex,d=v(i,["disable","orient","scale","labelExpr","title","zindex"]);if(!a){for(var p in d){var h=Ve[p],m=d[p];if(h&&h!==n&&"both"!==h)delete d[p];else if(He(m)){var g=m.condition,y=v(m,["condition"]),x=U(g),k=Ie[p];if(k){var w=k.vgProp,A=k.part,D=[].concat(b(x.map((function(e){var n=e.test,t=v(e,["test"]);return u({test:xd(null,n)},t)}))),[y]);wd(d,A,w,D),delete d[p]}else if(null===k){var C={signal:x.map((function(e){var n=e.test,t=v(e,["test"]);return"".concat(xd(null,n)," ? ").concat(Ro(t)," : ")})).join("")+Ro(y)};d[p]=C}}else if(Tr(m)){var S=Ie[p];if(S){var E=S.vgProp,B=S.part;wd(d,B,E,m),delete d[p]}}}if("grid"===n){if(!d.grid)return;if(d.encode){var O=d.encode.grid;d.encode=u({},O?{grid:O}:{}),xe(d.encode)&&delete d.encode}return u(u({scale:l,orient:o},d),{},{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:Me(f,0)})}if(r.header||!e.mainExtracted){if(void 0!==c){var _,z,j=c;(null===(_=d.encode)||void 0===_||null===(z=_.labels)||void 0===z?void 0:z.update)&&Tr(d.encode.labels.update.text)&&(j=je(c,"datum.label",d.encode.labels.update.text.signal)),wd(d,"labels","text",{signal:j})}if(null===d.labelAlign&&delete d.labelAlign,d.encode){var P,N=F(Ge);try{for(N.s();!(P=N.n()).done;){var M=P.value;e.hasAxisPart(M)||delete d.encode[M]}}catch(e){N.e(e)}finally{N.f()}xe(d.encode)&&delete d.encode}var T=kd(s,t);return u(u(u(u({scale:l,orient:o,grid:!1},T?{title:T}:{}),d),!1===t.aria?{aria:!1}:{}),{},{zindex:Me(f,0)})}}}function Dd(e){var n,t=e.component.axes,r=[],i=F(ct);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(t[a]){var o,u=F(t[a]);try{for(u.s();!(o=u.n()).done;){var l=o.value;if(!l.get("disable")&&!l.get("gridScale")){var c="x"===a?"height":"width",s=e.getSizeSignalRef(c).signal;c!==s&&r.push({name:c,update:s})}}}catch(e){u.e(e)}finally{u.f()}}}}catch(e){i.e(e)}finally{i.f()}return r}function Fd(e,n,t,r){return Object.assign.apply(null,[{}].concat(b(e.map((function(e){if("axisOrient"===e){var i,a="x"===t?"bottom":"left",o=n["x"===t?"axisBottom":"axisLeft"]||{},u=n["x"===t?"axisTop":"axisRight"]||{},l={},c=F(new Set([].concat(b(ke(o)),b(ke(u)))).values());try{for(c.s();!(i=c.n()).done;){var s=i.value;l[s]={signal:"".concat(r.signal,' === "').concat(a,'" ? ').concat(Wo(o[s])," : ").concat(Wo(u[s]))}}}catch(e){c.e(e)}finally{c.f()}return l}return n[e]})))))}function Cd(e,n,t,r){var i="band"===n?["axisDiscrete","axisBand"]:"point"===n?["axisDiscrete","axisPoint"]:n in Si?["axisQuantitative"]:"time"===n||"utc"===n?["axisTemporal"]:[],a="x"===e?"axisX":"axisY",o=Tr(t)?"axisOrient":"axis"+Ee(t),u=[].concat(i,b(i.map((function(e){return a+e.substr(4)})))),l=["axis",o,a];return{vlOnlyAxisConfig:Fd(u,r,e,t),vgAxisConfig:Fd(l,r,e,t),axisConfigStyle:Sd([].concat(l,b(u)),r)}}function Sd(e,n){var t,r=[{}],i=F(e);try{for(i.s();!(t=i.n()).done;){var a,o=null===(a=n[t.value])||void 0===a?void 0:a.style;if(o){var u,l=F(o=U(o));try{for(l.s();!(u=l.n()).done;){var c=u.value;r.push(n.style[c])}}catch(e){l.e(e)}finally{l.f()}}}}catch(e){i.e(e)}finally{i.f()}return Object.assign.apply(null,r)}function Ed(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=Vo(e,t,n);if(void 0!==i)return{configFrom:"style",configValue:i};for(var a=0,o=["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"];a<o.length;a++){var u,l=o[a];if(void 0!==(null===(u=r[l])||void 0===u?void 0:u[e]))return{configFrom:l,configValue:r[l][e]}}return{}}var Bd={scale:function(e){var n=e.model,t=e.channel;return n.scaleName(t)},format:function(e){var n=e.fieldOrDatumDef,t=e.config,r=e.axis,i=r.format,a=r.formatType;return Ca(n,n.type,i,a,t,!0)},formatType:function(e){var n=e.axis,t=e.fieldOrDatumDef,r=e.scaleType,i=n.formatType;return Sa(i,t,r)},grid:function(e){var n,t=e.fieldOrDatumDef,r=e.axis,i=e.scaleType;return(!Ja(t)||!Ft(t.bin))&&(null!==(n=r.grid)&&void 0!==n?n:function(e,n){return!_i(e)&&Ja(n)&&!Dt(null==n?void 0:n.bin)}(i,t))},gridScale:function(e){return function(e,n){var t="x"===n?"y":"x";if(e.getScaleComponent(t))return e.scaleName(t);return}(e.model,e.channel)},labelAlign:function(e){var n=e.axis,t=e.labelAngle,r=e.orient,i=e.channel;return n.labelAlign||zd(t,r,i)},labelAngle:function(e){return e.labelAngle},labelBaseline:function(e){var n=e.axis,t=e.labelAngle,r=e.orient,i=e.channel;return n.labelBaseline||_d(t,r,i)},labelFlush:function(e){var n,t=e.axis,r=e.fieldOrDatumDef,i=e.channel;return null!==(n=t.labelFlush)&&void 0!==n?n:function(e,n){if("x"===n&&se(["quantitative","temporal"],e))return!0;return}(r.type,i)},labelOverlap:function(e){var n,t=e.axis,r=e.fieldOrDatumDef,i=e.scaleType;return null!==(n=t.labelOverlap)&&void 0!==n?n:function(e,n,t,r){if(t&&!T(r)||"nominal"!==e&&"ordinal"!==e)return"log"!==n&&"symlog"!==n||"greedy";return}(r.type,i,Ja(r)&&!!r.timeUnit,Ja(r)?r.sort:void 0)},orient:function(e){return e.orient},tickCount:function(e){var n,t=e.channel,r=e.model,i=e.axis,a=e.fieldOrDatumDef,o=e.scaleType,u="x"===t?"width":"y"===t?"height":void 0,l=u?r.getSizeSignalRef(u):void 0;return null!==(n=i.tickCount)&&void 0!==n?n:function(e){var n=e.fieldOrDatumDef,t=e.scaleType,r=e.size;if(!e.values&&!_i(t)&&"log"!==t){if(Ja(n)){var i;if(Dt(n.bin))return{signal:"ceil(".concat(r.signal,"/10)")};if(n.timeUnit&&se(["month","hours","day","quarter"],null===(i=Nr(n.timeUnit))||void 0===i?void 0:i.unit))return}return{signal:"ceil(".concat(r.signal,"/40)")}}return}({fieldOrDatumDef:a,scaleType:o,size:l,values:i.values})},title:function(e){var n=e.axis,t=e.model,r=e.channel;if(void 0!==n.title)return n.title;var i=jd(t,r);if(void 0!==i)return i;var a=t.typedFieldDef(r),o="x"===r?"x2":"y2",u=t.fieldDef(o);return Jo(a?[Wa(a)]:[],Ja(u)?[Wa(u)]:[])},values:function(e){return function(e,n){var t=e.values;if(M(t))return zo(n,t);if(Tr(t))return t;return}(e.axis,e.fieldOrDatumDef)},zindex:function(e){var n,t=e.axis,r=e.fieldOrDatumDef,i=e.mark;return null!==(n=t.zindex)&&void 0!==n?n:function(e,n){if("rect"===e&&co(n))return 1;return 0}(i,r)}};function Od(e){return"(((".concat(e.signal," % 360) + 360) % 360)")}function _d(e,n,t,r){if(void 0!==e){if("x"===t){if(Tr(e)){var i=Od(e),a=Tr(n)?"(".concat(n.signal,' === "top")'):"top"===n;return{signal:"(45 < ".concat(i," && ").concat(i," < 135) || (225 < ").concat(i," && ").concat(i,' < 315) ? "middle" :')+"(".concat(i," <= 45 || 315 <= ").concat(i,") === ").concat(a,' ? "bottom" : "top"')}}if(45<e&&e<135||225<e&&e<315)return"middle";if(Tr(n)){var o=e<=45||315<=e?"===":"!==";return{signal:"".concat(n.signal," ").concat(o,' "top" ? "bottom" : "top"')}}return(e<=45||315<=e)==("top"===n)?"bottom":"top"}if(Tr(e)){var u=Od(e),l=Tr(n)?"(".concat(n.signal,' === "left")'):"left"===n,c=r?'"middle"':"null";return{signal:"".concat(u," <= 45 || 315 <= ").concat(u," || (135 <= ").concat(u," && ").concat(u," <= 225) ? ").concat(c," : (45 <= ").concat(u," && ").concat(u," <= 135) === ").concat(l,' ? "top" : "bottom"')}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(Tr(n)){var s=45<=e&&e<=135?"===":"!==";return{signal:"".concat(n.signal," ").concat(s,' "left" ? "top" : "bottom"')}}return(45<=e&&e<=135)==("left"===n)?"top":"bottom"}}function zd(e,n,t){if(void 0!==e){var r="x"===t,i=r?0:90,a=r?"bottom":"left";if(Tr(e)){var o=Od(e),u=Tr(n)?"(".concat(n.signal,' === "').concat(a,'")'):n===a;return{signal:"(".concat(i?"("+o+" + 90)":o," % 180 === 0) ? ").concat(r?null:'"center"'," :")+"(".concat(i," < ").concat(o," && ").concat(o," < ").concat(180+i,") === ").concat(u,' ? "left" : "right"')}}if((e+i)%180==0)return r?null:"center";if(Tr(n)){var l=i<e&&e<180+i?"===":"!==",c="".concat(n.signal," ").concat(l,' "').concat(a,'"');return{signal:"".concat(c,' ? "left" : "right"')}}return(i<e&&e<180+i)==(n===a)?"left":"right"}}function jd(e,n){var t="x"===n?"x2":"y2",r=e.fieldDef(n),i=e.fieldDef(t),a=r?r.title:void 0,o=i?i.title:void 0;return a&&o?Xo(a,o):a||(o||(void 0!==a?a:void 0!==o?o:void 0))}var Pd=function(e){l(r,e);var n=m(r);function r(e,i){var o;return t(this,r),(o=n.call(this,e)).transform=i,a(p(o),"_dependentFields",void 0),o._dependentFields=md(o.transform.calculate),o}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.transform))}}]),i(r,[{key:"producedFields",value:function(){return new Set([this.transform.as])}},{key:"dependentFields",value:function(){return this._dependentFields}},{key:"assemble",value:function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}},{key:"hash",value:function(){return"Calculate ".concat(le(this.transform))}}],[{key:"parseAllForSortIndex",value:function(e,n){return n.forEachFieldDef((function(n,t){if(to(n)&&Ta(n.sort)){var i=n.field,a=n.timeUnit,o=n.sort,u=o.map((function(e,n){return"".concat(ei({field:i,timeUnit:a,equal:e})," ? ").concat(n," : ")})).join("")+o.length;e=new r(e,{calculate:u,as:Nd(n,t,{forAs:!0})})}})),e}}]),r}(us);function Nd(e,n,t){return lo(e,u({prefix:n,suffix:"sort_index"},null!=t?t:{}))}function Md(e,n){return se(["top","bottom"],n)?"column":se(["left","right"],n)||"row"===e?"row":"column"}function Td(e,n,t,r){var i="row"===r?t.headerRow:"column"===r?t.headerColumn:t.headerFacet;return Me((n||{})[e],i[e],t.header[e])}function Ld(e,n,t,r){var i,a={},o=F(e);try{for(o.s();!(i=o.n()).done;){var u=i.value,l=Td(u,n||{},t,r);void 0!==l&&(a[u]=l)}}catch(e){o.e(e)}finally{o.f()}return a}var qd=["row","column"],Rd=["header","footer"];function Wd(e,n){var t=e.component.layoutHeaders[n].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[n].facetFieldDef?e.component.layoutHeaders[n].facetFieldDef:void 0,a=Ld(["titleAnchor","titleAngle","titleOrient"],i.header,r,n),o=a.titleAnchor,l=a.titleAngle,c=Md(n,a.titleOrient),s=We(l);return{name:"".concat(n,"-title"),type:"group",role:"".concat(c,"-title"),title:u(u(u(u({text:t},"row"===n?{orient:"left"}:{}),{},{style:"guide-title"},Id(s,c)),Ud(c,s,o)),Qd(r,i,n,ju,_u))}}function Ud(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"middle";switch(t){case"start":return{align:"left"};case"end":return{align:"right"}}var r=zd(n,"row"===e?"left":"top","row"===e?"y":"x");return r?{align:r}:{}}function Id(e,n){var t=_d(e,"row"===n?"left":"top","row"===n?"y":"x",!0);return t?{baseline:t}:{}}function Hd(e,n){var t,r=e.component.layoutHeaders[n],i=[],a=F(Rd);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(r[o]){var u,l=F(r[o]);try{for(l.s();!(u=l.n()).done;){var c=Yd(e,n,o,r,u.value);null!=c&&i.push(c)}}catch(e){l.e(e)}finally{l.f()}}}}catch(e){a.e(e)}finally{a.f()}return i}function Gd(e,n){var t,r=e.sort;return Ma(r)?{field:lo(r,{expr:"datum"}),order:null!==(t=r.order)&&void 0!==t?t:"ascending"}:M(r)?{field:Nd(e,n,{expr:"datum"}),order:"ascending"}:{field:lo(e,{expr:"datum"}),order:null!=r?r:"ascending"}}function Vd(e,n,t){var r=Ld(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,t,n),i=r.format,a=r.formatType,o=r.labelAngle,l=r.labelAnchor,c=r.labelOrient,s=r.labelExpr,f=Aa({fieldOrDatumDef:e,format:i,formatType:a,expr:"parent",config:t}).signal,d=Md(n,c);return u(u(u(u({text:{signal:s?je(je(s,"datum.label",f),"datum.value",lo(e,{expr:"parent"})):f}},"row"===n?{orient:"left"}:{}),{},{style:"guide-label",frame:"group"},Id(o,d)),Ud(d,o,l)),Qd(t,e,n,Pu,zu))}function Yd(e,n,t,r,i){if(i){var o=null,l=r.facetFieldDef,c=e.config?e.config:void 0;if(l&&i.labels){var s=Ld(["labelOrient"],l.header,c,n).labelOrient;("row"===n&&!se(["top","bottom"],s)||"column"===n&&!se(["left","right"],s))&&(o=Vd(l,n,c))}var f=Yp(e)&&!La(e.facet),d=i.axes,v=(null==d?void 0:d.length)>0;if(o||v){var p="row"===n?"height":"width";return u(u(u(u(u({name:e.getName("".concat(n,"_").concat(t)),type:"group",role:"".concat(n,"-").concat(t)},r.facetFieldDef?{from:{data:e.getName(n+"_domain")},sort:Gd(l,n)}:{}),v&&f?{from:{data:e.getName("facet_domain_".concat(n))}}:{}),o?{title:o}:{}),i.sizeSignal?{encode:{update:a({},p,i.sizeSignal)}}:{}),v?{axes:d}:{})}}return null}var Jd={column:{start:0,end:1},row:{start:1,end:0}};function Xd(e,n){return Jd[n][e]}function Qd(e,n,t,r,i){var a,o={},u=F(r);try{for(u.s();!(a=u.n()).done;){var l=a.value;if(i[l]){var c=Td(l,null==n?void 0:n.header,e,t);void 0!==c&&(o[i[l]]=c)}}}catch(e){u.e(e)}finally{u.f()}return o}function $d(e){return[].concat(b(Kd(e,"width")),b(Kd(e,"height")),b(Kd(e,"childWidth")),b(Kd(e,"childHeight")))}function Kd(e,n){var t="width"===n?"x":"y",r=e.component.layoutSize.get(n);if(!r||"merged"===r)return[];var i=e.getSizeSignalRef(n).signal;if("step"===r){var a=e.getScaleComponent(t);if(a){var o=a.get("type"),u=a.get("range");if(_i(o)&&Lr(u)){var l=e.scaleName(t);if(Yp(e.parent))if("independent"===e.parent.component.resolve.scale[t])return[Zd(l,u)];return[Zd(l,u),{name:i,update:ev(l,a,"domain('".concat(l,"').length"))}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==r){var c=i.endsWith("width"),s=c?"containerSize()[0]":"containerSize()[1]",f=Qu(e.config.view,c?"width":"height"),d="isFinite(".concat(s,") ? ").concat(s," : ").concat(f);return[{name:i,init:d,on:[{update:d,events:"window:resize"}]}]}return[{name:i,value:r}]}function Zd(e,n){return{name:e+"_step",value:n.step}}function ev(e,n,t){var r=n.get("type"),i=n.get("padding"),a=Me(n.get("paddingOuter"),i),o=n.get("paddingInner");return o="band"===r?void 0!==o?o:i:1,"bandspace(".concat(t,", ").concat(Wo(o),", ").concat(Wo(a),") * ").concat(e,"_step")}function nv(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function tv(e,n){return ke(e).reduce((function(t,r){var i=e[r];return u(u({},t),jc(n,i,r,(function(e){return qo(e.value)})))}),{})}function rv(e,n){if(Xp(n)||Yp(n))return"shared";if(Jp(n))return st(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function iv(e,n){var t=e.scale[n],r=st(n)?"axis":"legend";return"independent"===t?("shared"===e[r][n]&&gr(function(e){return'Setting the scale to be independent for "'.concat(e,'" means we also have to set the guide (axis or legend) to be independent.')}(n)),"independent"):e[r][n]||"shared"}var av=u(u({},{aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1}),{},{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),ov=ke(av),uv=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.apply(this,arguments)}return r}(Hl),lv={symbols:function(e,n){var t,r,i,a,o=n.fieldOrDatumDef,l=n.model,c=n.channel,s=n.legendCmpt;if("symbol"!==n.legendType)return;var f=l.markDef,d=l.encoding,v=l.config,p=l.mark,h=f.filled&&"trail"!==p,m=u(u({},function(e,n,t){var r,i=F(t);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=Ho(a,n.markDef,n.config);void 0!==o&&(e[a]=qo(o))}}catch(e){i.e(e)}finally{i.f()}return e}({},l,ua)),Wc(l,{filled:h})),g=null!==(t=s.get("symbolOpacity"))&&void 0!==t?t:v.legend.symbolOpacity,y=null!==(r=s.get("symbolFillColor"))&&void 0!==r?r:v.legend.symbolFillColor,b=null!==(i=s.get("symbolStrokeColor"))&&void 0!==i?i:v.legend.symbolStrokeColor,x=void 0===g?null!==(a=cv(d.opacity))&&void 0!==a?a:f.opacity:void 0;if(m.fill){var k;if("fill"===c||h&&c===wn)delete m.fill;else if(m.fill.field)if(y)delete m.fill;else m.fill=qo(null!==(k=v.legend.symbolBaseFillColor)&&void 0!==k?k:"black"),m.fillOpacity=qo(null!=x?x:1);else if(M(m.fill)){var w,A,D,C=null!==(w=null!==(A=sv(null!==(D=d.fill)&&void 0!==D?D:d.color))&&void 0!==A?A:f.fill)&&void 0!==w?w:h&&f.color;C&&(m.fill=qo(C))}}if(m.stroke)if("stroke"===c||!h&&c===wn)delete m.stroke;else if(m.stroke.field||b)delete m.stroke;else if(M(m.stroke)){var S=Me(sv(d.stroke||d.color),f.stroke,h?f.color:void 0);S&&(m.stroke={value:S})}if(c!==En){var E=Ja(o)&&dv(l,s,o);E?m.opacity=[u({test:E},qo(null!=x?x:1)),qo(v.legend.unselectedOpacity)]:x&&(m.opacity=qo(x))}return xe(m=u(u({},m),e))?void 0:m},gradient:function(e,n){var t,r=n.model,i=n.legendType,a=n.legendCmpt;if("gradient"!==i)return;var o=r.config,l=r.markDef,c=r.encoding,s={},f=void 0===(null!==(t=a.get("gradientOpacity"))&&void 0!==t?t:o.legend.gradientOpacity)?cv(c.opacity)||l.opacity:void 0;f&&(s.opacity=qo(f));return xe(s=u(u({},s),e))?void 0:s},labels:function(e,n){var t=n.fieldOrDatumDef,r=n.model,i=n.channel,a=n.legendCmpt,o=r.legend(i)||{},l=r.config,c=Ja(t)?dv(r,a,t):void 0,s=c?[{test:c,value:1},{value:l.legend.unselectedOpacity}]:void 0,f=o.format,d=o.formatType,v=ka(d)?Fa({fieldOrDatumDef:t,field:"datum.value",format:f,formatType:d,config:l}):void 0,p=u(u(u({},s?{opacity:s}:{}),v?{text:v}:{}),e);return xe(p)?void 0:p},entries:function(e,n){var t=n.legendCmpt.get("selections");return(null==t?void 0:t.length)?u(u({},e),{},{fill:{value:"transparent"}}):e}};function cv(e){return fv(e,(function(e,n){return Math.max(e,n.value)}))}function sv(e){return fv(e,(function(e,n){return Me(e,n.value)}))}function fv(e,n){return function(e){var n=e&&e.condition;return!!n&&(M(n)||no(n))}(e)?U(e.condition).reduce(n,e.value):no(e)?e.value:void 0}function dv(e,n,t){var r=n.get("selections");if(null==r?void 0:r.length){var i=J(t.field);return r.map((function(e){var n=J(Fe(e)+Rs);return"(!length(data(".concat(n,")) || (").concat(e,"[").concat(i,"] && indexof(").concat(e,"[").concat(i,"], datum.value) >= 0))")})).join(" || ")}}var vv={direction:function(e){return e.direction},format:function(e){var n=e.fieldOrDatumDef,t=e.legend,r=e.config,i=t.format,a=t.formatType;return Ca(n,n.type,i,a,r,!1)},formatType:function(e){var n=e.legend,t=e.fieldOrDatumDef,r=e.scaleType,i=n.formatType;return Sa(i,t,r)},gradientLength:function(e){var n,t,r=e.legend,i=e.legendConfig;return null!==(n=null!==(t=r.gradientLength)&&void 0!==t?t:i.gradientLength)&&void 0!==n?n:function(e){var n=e.legendConfig,t=e.model,r=e.direction,i=e.orient,a=e.scaleType,o=n.gradientHorizontalMaxLength,u=n.gradientHorizontalMinLength,l=n.gradientVerticalMaxLength,c=n.gradientVerticalMinLength;if(ji(a))return"horizontal"===r?"top"===i||"bottom"===i?mv(t,"width",u,o):u:mv(t,"height",c,l);return}(e)},labelOverlap:function(e){var n,t,r=e.legend,i=e.legendConfig,a=e.scaleType;return null!==(n=null!==(t=r.labelOverlap)&&void 0!==t?t:i.labelOverlap)&&void 0!==n?n:function(e){if(se(["quantile","threshold","log","symlog"],e))return"greedy";return}(a)},symbolType:function(e){var n,t=e.legend,r=e.markDef,i=e.channel,a=e.encoding;return null!==(n=t.symbolType)&&void 0!==n?n:function(e,n,t,r){if("shape"!==n){var i,a=null!==(i=sv(t))&&void 0!==i?i:r;if(a)return a}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(r.type,i,a.shape,r.shape)},title:function(e){return go(e.fieldOrDatumDef,e.config,{allowDisabling:!0})},type:function(e){var n=e.legendType,t=e.scaleType;if(Vn(e.channel)&&ji(t)){if("gradient"===n)return}else if("symbol"===n)return;return n},values:function(e){var n=e.fieldOrDatumDef;return function(e,n){var t=e.values;if(M(t))return zo(n,t);if(Tr(t))return t;return}(e.legend,n)}};function pv(e){return Me(e.legend.type,function(e){var n=e.channel,t=e.timeUnit,r=e.scaleType;if(Vn(n)){if(se(["quarter","month","day"],t))return"symbol";if(ji(r))return"gradient"}return"symbol"}(e))}function hv(e){var n,t,r=e.legendConfig,i=e.legendType,a=e.orient;return null!==(n=null!==(t=e.legend.direction)&&void 0!==t?t:r[i?"gradientDirection":"symbolDirection"])&&void 0!==n?n:function(e,n){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===n?"horizontal":void 0}}(a,i)}function mv(e,n,t,r){var i=e.getSizeSignalRef(n).signal;return{signal:"clamp(".concat(i,", ").concat(t,", ").concat(r,")")}}function gv(e){var n=Vp(e)?function(e){for(var n=e.encoding,t={},r=0,i=[wn].concat(b(Mu));r<i.length;r++){var a=i[r],o=Ao(n[a]);o&&e.getScaleComponent(a)&&(a===Fn&&Ja(o)&&o.type===ui||(t[a]=bv(e,a)))}return t}(e):function(e){var n,t=e.component,r=t.legends,i=t.resolve,a=F(e.children);try{for(a.s();!(n=a.n()).done;){var o=n.value;gv(o);var u,l=F(ke(o.component.legends));try{for(l.s();!(u=l.n()).done;){var c=u.value;i.legend[c]=iv(e.component.resolve,c),"shared"===i.legend[c]&&(r[c]=xv(r[c],o.component.legends[c]),r[c]||(i.legend[c]="independent",delete r[c]))}}catch(e){l.e(e)}finally{l.f()}}}catch(e){a.e(e)}finally{a.f()}var s,f=F(ke(r));try{for(f.s();!(s=f.n()).done;){var d,v=s.value,p=F(e.children);try{for(p.s();!(d=p.n()).done;){var h=d.value;h.component.legends[v]&&("shared"===i.legend[v]&&delete h.component.legends[v])}}catch(e){p.e(e)}finally{p.f()}}}catch(e){f.e(e)}finally{f.f()}return r}(e);return e.component.legends=n,n}function yv(e,n,t,r){switch(n){case"disable":return void 0!==t;case"values":return!!(null==t?void 0:t.values);case"title":if("title"===n&&e===(null==r?void 0:r.title))return!0}return e===(t||{})[n]}function bv(e,n){var t,r,i,o=e.legend(n),l=e.markDef,c=e.encoding,s=e.config,f=s.legend,d=new uv({},function(e,n){var t=e.scaleName(n);if("trail"===e.mark){if("color"===n)return{stroke:t};if("size"===n)return{strokeWidth:t}}return"color"===n?e.markDef.filled?{fill:t}:{stroke:t}:a({},n,t)}(e,n));!function(e,n,t){var r,i=null===(r=e.fieldDef(n))||void 0===r?void 0:r.field;Gs(e,(function(e){var r,a=null!==(r=e.project.hasField[i])&&void 0!==r?r:e.project.hasChannel[n];if(a&&bs.has(e)){var o,u=null!==(o=t.get("selections"))&&void 0!==o?o:[];u.push(e.name),t.set("selections",u,!1),a.hasLegend=!0}}))}(e,n,d);var v=void 0!==o?!o:f.disable;if(d.set("disable",v,void 0!==o),v)return d;o=o||{};var p,h=e.getScaleComponent(n).get("type"),m=Ao(c[n]),g=Ja(m)?null===(t=Nr(m.timeUnit))||void 0===t?void 0:t.unit:void 0,y=o.orient||s.legend.orient||"right",b=pv({legend:o,channel:n,timeUnit:g,scaleType:h}),x={legend:o,channel:n,model:e,markDef:l,encoding:c,fieldOrDatumDef:m,legendConfig:f,config:s,scaleType:h,orient:y,legendType:b,direction:hv({legend:o,legendType:b,orient:y,legendConfig:f})},k=F(ov);try{for(k.s();!(p=k.n()).done;){var w=p.value;if(!("gradient"===b&&w.startsWith("symbol")||"symbol"===b&&w.startsWith("gradient"))){var A=w in vv?vv[w](x):o[w];if(void 0!==A){var D=yv(A,w,o,e.fieldDef(n));(D||void 0===s.legend[w])&&d.set(w,A,D)}}}}catch(e){k.e(e)}finally{k.f()}for(var C,S=null!==(r=null===(i=o)||void 0===i?void 0:i.encoding)&&void 0!==r?r:{},E=d.get("selections"),B={},O={fieldOrDatumDef:m,model:e,channel:n,legendCmpt:d,legendType:b},_=0,z=["labels","legend","title","symbols","gradient","entries"];_<z.length;_++){var j,P=z[_],N=tv(null!==(j=S[P])&&void 0!==j?j:{},e),M=P in lv?lv[P](N,O):N;void 0===M||xe(M)||(B[P]=u(u(u({},(null==E?void 0:E.length)&&Ja(m)?{name:"".concat(Fe(m.field),"_legend_").concat(P)}:{}),(null==E?void 0:E.length)?{interactive:!!E}:{}),{},{update:M}))}xe(B)||d.set("encode",B,!!(null===(C=o)||void 0===C?void 0:C.encoding));return d}function xv(e,n){if(!e)return n.clone();var t=e.getWithExplicit("orient"),r=n.getWithExplicit("orient");if(!t.explicit||!r.explicit||t.value===r.value){var i,a,o,u,l,c=!1,s=F(ov);try{var f=function(){var t=i.value,r=Xl(e.getWithExplicit(t),n.getWithExplicit(t),t,"legend",(function(e,n){switch(t){case"symbolType":return function(e,n){if("circle"===n.value)return n;return e}(e,n);case"title":return Qo(e,n);case"type":return c=!0,Vl("symbol")}return Jl(e,n,t,"legend")}));e.setWithExplicit(t,r)};for(s.s();!(i=s.n()).done;)f()}catch(e){s.e(e)}finally{s.f()}if(c)(null===(a=e.implicit)||void 0===a||null===(o=a.encode)||void 0===o?void 0:o.gradient)&&Se(e.implicit,["encode","gradient"]),(null===(u=e.explicit)||void 0===u||null===(l=u.encode)||void 0===l?void 0:l.gradient)&&Se(e.explicit,["encode","gradient"]);return e}}function kv(e){var n,t=e.component.legends,r={},i=F(ke(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,o=e.getScaleComponent(a),u=ue(o.get("domains"));if(r[u]){var l,c=F(r[u]);try{for(c.s();!(l=c.n()).done;){xv(l.value,t[a])||r[u].push(t[a])}}catch(e){c.e(e)}finally{c.f()}}else r[u]=[t[a].clone()]}}catch(e){i.e(e)}finally{i.f()}return we(r).flat().map((function(n){return function(e,n){var t,r=e.combine(),i=r.disable,a=r.labelExpr,o=(r.selections,v(r,["disable","labelExpr","selections"]));if(i)return;!1===n.aria&&null==o.aria&&(o.aria=!1);if(null===(t=o.encode)||void 0===t?void 0:t.symbols){var u=o.encode.symbols.update;!u.fill||"transparent"===u.fill.value||u.stroke||o.stroke||(u.stroke={value:"transparent"});var l,c=F(Mu);try{for(c.s();!(l=c.n()).done;){var s=l.value;o[s]&&delete u[s]}}catch(e){c.e(e)}finally{c.f()}}o.title||delete o.title;if(void 0!==a){var f,d,p=a;(null===(f=o.encode)||void 0===f||null===(d=f.labels)||void 0===d?void 0:d.update)&&Tr(o.encode.labels.update.text)&&(p=je(a,"datum.label",o.encode.labels.update.text.signal)),function(e,n,t,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[n]=null!==(a=e.encode[n])&&void 0!==a?a:{},e.encode[n].update=null!==(o=e.encode[n].update)&&void 0!==o?o:{},e.encode[n].update[t]=r}(o,"labels","text",{signal:p})}return o}(n,e.config)})).filter((function(e){return void 0!==e}))}function wv(e){return Xp(e)||Jp(e)?function(e){return e.children.reduce((function(e,n){return e.concat(n.assembleProjections())}),Av(e))}(e):Av(e)}function Av(e){var n=e.component.projection;if(!n||n.merged)return[];var t=n.combine(),r=t.name;if(n.data){var i={signal:"[".concat(n.size.map((function(e){return e.signal})).join(", "),"]")},a=n.data.reduce((function(n,t){var r=Tr(t)?t.signal:"data('".concat(e.lookupDataSource(t),"')");return se(n,r)||n.push(r),n}),[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[u({name:r,size:i,fit:{signal:a.length>1?"[".concat(a.join(", "),"]"):a[0]}},t)]}return[u(u({name:r},{translate:{signal:"[width / 2, height / 2]"}}),t)]}var Dv=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"],Fv=function(e){l(r,e);var n=m(r);function r(e,i,o,l){var c;return t(this,r),(c=n.call(this,u({},i),{name:e})).specifiedProjection=i,c.size=o,c.data=l,a(p(c),"merged",!1),c}return i(r,[{key:"isFit",get:function(){return!!this.data}}]),r}(Hl);function Cv(e){e.component.projection=Vp(e)?function(e){if(e.hasProjection){var n,t=e.specifiedProjection,r=!(t&&(null!=t.scale||null!=t.translate)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=r?function(e){for(var n=[],t=e.encoding,r=0,i=[[bn,yn],[kn,xn]];r<i.length;r++){var a=i[r];(Ao(t[a[0]])||Ao(t[a[1]]))&&n.push({signal:e.getName("geojson_".concat(n.length))})}e.channelHasField(Fn)&&e.typedFieldDef(Fn).type===ui&&n.push({signal:e.getName("geojson_".concat(n.length))});0===n.length&&n.push(e.requestDataName(Ql.Main));return n}(e):void 0;return new Fv(e.projectionName(!0),u(u({},null!==(n=e.config.projection)&&void 0!==n?n:{}),null!=t?t:{}),i,a)}return}(e):function(e){if(0===e.children.length)return;var n,t,r=F(e.children);try{for(r.s();!(t=r.n()).done;){Cv(t.value)}}catch(e){r.e(e)}finally{r.f()}var i=de(e.children,(function(e){var t=e.component.projection;if(t){if(n){var r=function(e,n){var t=de(Dv,(function(t){return!H(e.explicit,t)&&!H(n.explicit,t)||!(!H(e.explicit,t)||!H(n.explicit,t)||ue(e.get(t))!==ue(n.get(t)))}));if(ue(e.size)===ue(n.size)){if(t)return e;if(ue(e.explicit)===ue({}))return n;if(ue(n.explicit)===ue({}))return e}return null}(n,t);return r&&(n=r),!!r}return n=t,!0}return!0}));if(n&&i){var a,o=e.projectionName(!0),u=new Fv(o,n.specifiedProjection,n.size,ie(n.data)),l=F(e.children);try{for(l.s();!(a=l.n()).done;){var c=a.value,s=c.component.projection;if(s){var f;if(s.isFit)(f=u.data).push.apply(f,b(c.component.projection.data));c.renameProjection(s.get("name"),o),s.merged=!0}}}catch(e){l.e(e)}finally{l.f()}return u}return}(e)}function Sv(e,n){return"".concat(At(e),"_").concat(n)}function Ev(e,n,t){var r,i=Sv(null!==(r=So(t,void 0))&&void 0!==r?r:{},n);return e.getName("".concat(i,"_bins"))}function Bv(e,n,t){var r,i;r=function(e){return"as"in e}(e)?Y(e.as)?[e.as,"".concat(e.as,"_end")]:[e.as[0],e.as[1]]:[lo(e,{forAs:!0}),lo(e,{binSuffix:"end",forAs:!0})];var a=u({},So(n,void 0)),o=Sv(a,e.field),l=function(e,n){return{signal:e.getName("".concat(n,"_bins")),extentSignal:e.getName("".concat(n,"_extent"))}}(t,o),c=l.signal,s=l.extentSignal;if(St(a.extent)){var f=a.extent,d=f.selection;i=bd(t.getSelectionComponent(Fe(d),d),f),delete a.extent}return{key:o,binComponent:u(u(u({bin:a,field:e.field,as:[r]},c?{signal:c}:{}),s?{extentSignal:s}:{}),i?{span:i}:{})}}var Ov=function(e){l(r,e);var n=m(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e)).bins=i,a}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.bins))}}]),i(r,[{key:"merge",value:function(e,n){var t,r=F(ke(e.bins));try{for(r.s();!(t=r.n()).done;){var i=t.value;i in this.bins?(n(e.bins[i].signal,this.bins[i].signal),this.bins[i].as=he([].concat(b(this.bins[i].as),b(e.bins[i].as)),le)):this.bins[i]=e.bins[i]}}catch(e){r.e(e)}finally{r.f()}var a,o=F(e.children);try{for(o.s();!(a=o.n()).done;){var u=a.value;e.removeChild(u),u.parent=this}}catch(e){o.e(e)}finally{o.f()}e.remove()}},{key:"producedFields",value:function(){return new Set(we(this.bins).map((function(e){return e.as})).flat(2))}},{key:"dependentFields",value:function(){return new Set(we(this.bins).map((function(e){return e.field})))}},{key:"hash",value:function(){return"Bin ".concat(le(this.bins))}},{key:"assemble",value:function(){return we(this.bins).flatMap((function(e){var n,t=[],r=x(n=e.as)||k(n)||w(n)||D(),i=r[0],a=r.slice(1),o=e.bin,l=o.extent,c=v(o,["extent"]),s=u(u(u({type:"bin",field:ze(e.field),as:i,signal:e.signal},St(l)?{extent:null}:{extent:l}),e.span?{span:{signal:"span(".concat(e.span,")")}}:{}),c);!l&&e.extentSignal&&(t.push({type:"extent",field:ze(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);var f,d=F(a);try{for(d.s();!(f=d.n()).done;)for(var p=f.value,h=0;h<2;h++)t.push({type:"formula",expr:lo({field:i[h]},{expr:"datum"}),as:p[h]})}catch(e){d.e(e)}finally{d.f()}return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))}}],[{key:"makeFromEncoding",value:function(e,n){var t=n.reduceFieldDef((function(e,t,r){if(eo(t)&&Dt(t.bin)){var i=Bv(t,t.bin,n),a=i.key,o=i.binComponent;e[a]=u(u(u({},o),e[a]),function(e,n,t,r){if(jo(n,t)){var i,a,o=Vp(e)&&null!==(i=null!==(a=e.axis(t))&&void 0!==a?a:e.legend(t))&&void 0!==i?i:{},u=lo(n,{expr:"datum"}),l=lo(n,{expr:"datum",binSuffix:"end"});return{formulaAs:lo(n,{binSuffix:"range",forAs:!0}),formula:_a(u,l,o.format,o.formatType,r)}}return{}}(n,t,r,n.config))}return e}),{});return xe(t)?null:new r(e,t)}},{key:"makeFromTransform",value:function(e,n,t){var i=Bv(n,n.bin,t);return new r(e,a({},i.key,i.binComponent))}}]),r}(us);function _v(e,n,t,r){var i=Vp(r)?r.encoding[it(n)]:void 0;if(eo(t)&&Vp(r)&&Ha(n,t,i,r.stack,r.markDef,r.config))e.add(lo(t,{})),e.add(lo(t,{suffix:"end"})),t.bin&&jo(t,n)&&e.add(lo(t,{binSuffix:"range"}));else if(n in In){var a=function(e){switch(e){case yn:return"y";case xn:return"y2";case bn:return"x";case kn:return"x2"}}(n);e.add(r.getName(a))}else e.add(lo(t));return e}var zv=function(e){l(r,e);var n=m(r);function r(e,i,a){var o;return t(this,r),(o=n.call(this,e)).dimensions=i,o.measures=a,o}return i(r,[{key:"clone",value:function(){return new r(null,new Set(this.dimensions),ie(this.measures))}}]),i(r,[{key:"merge",value:function(e){return me(this.dimensions,e.dimensions)?(function(e,n){var t,r=F(ke(n));try{for(r.s();!(t=r.n()).done;){var i,o=t.value,u=n[o],l=F(ke(u));try{for(l.s();!(i=l.n()).done;){var c,s=i.value;o in e?e[o][s]=new Set([].concat(b(null!==(c=e[o][s])&&void 0!==c?c:[]),b(u[s]))):e[o]=a({},s,u[s])}}catch(e){l.e(e)}finally{l.f()}}}catch(e){r.e(e)}finally{r.f()}}(this.measures,e.measures),!0):(function(){var e;(e=pr).debug.apply(e,arguments)}("different dimensions, cannot merge"),!1)}},{key:"addDimensions",value:function(e){e.forEach(this.dimensions.add,this.dimensions)}},{key:"dependentFields",value:function(){return new Set([].concat(b(this.dimensions),b(ke(this.measures))))}},{key:"producedFields",value:function(){var e,n=new Set,t=F(ke(this.measures));try{for(t.s();!(e=t.n()).done;){var r,i=e.value,a=F(ke(this.measures[i]));try{for(a.s();!(r=a.n()).done;){var o=r.value,u=this.measures[i][o];0===u.size?n.add("".concat(o,"_").concat(i)):u.forEach(n.add,n)}}catch(e){a.e(e)}finally{a.f()}}}catch(e){t.e(e)}finally{t.f()}return n}},{key:"hash",value:function(){return"Aggregate ".concat(le({dimensions:this.dimensions,measures:this.measures}))}},{key:"assemble",value:function(){var e,n=[],t=[],r=[],i=F(ke(this.measures));try{for(i.s();!(e=i.n()).done;){var a,o=e.value,u=F(ke(this.measures[o]));try{for(u.s();!(a=u.n()).done;){var l,c=a.value,s=F(this.measures[o][c]);try{for(s.s();!(l=s.n()).done;){var f=l.value;r.push(f),n.push(c),t.push("*"===o?null:ze(o))}}catch(e){s.e(e)}finally{s.f()}}}catch(e){u.e(e)}finally{u.f()}}}catch(e){i.e(e)}finally{i.f()}return{type:"aggregate",groupby:b(this.dimensions).map(ze),ops:n,fields:t,as:r}}},{key:"groupBy",get:function(){return this.dimensions}}],[{key:"makeFromEncoding",value:function(e,n){var t=!1;n.forEachFieldDef((function(e){e.aggregate&&(t=!0)}));var i={},a=new Set;return t?(n.forEachFieldDef((function(e,t){var r=e.aggregate,o=e.field;if(r)if("count"===r){var u;i["*"]=null!==(u=i["*"])&&void 0!==u?u:{},i["*"].count=new Set([lo(e,{forAs:!0})])}else{if(Ze(r)||en(r)){var l,c=Ze(r)?"argmin":"argmax",s=r[c];i[s]=null!==(l=i[s])&&void 0!==l?l:{},i[s][c]=new Set([lo({op:c,field:s},{forAs:!0})])}else{var f;i[o]=null!==(f=i[o])&&void 0!==f?f:{},i[o][r]=new Set([lo(e,{forAs:!0})])}var d;if(yt(t)&&"unaggregated"===n.scaleDomain(t))i[o]=null!==(d=i[o])&&void 0!==d?d:{},i[o].min=new Set([lo({field:o,aggregate:"min"},{forAs:!0})]),i[o].max=new Set([lo({field:o,aggregate:"max"},{forAs:!0})])}else _v(a,t,e,n)})),a.size+ke(i).length===0?null:new r(e,a,i)):null}},{key:"makeFromTransform",value:function(e,n){var t,i,a=new Set,o={},u=F(n.aggregate);try{for(u.s();!(i=u.n()).done;){var l,c,s=i.value,f=s.op,d=s.field,v=s.as;if(f)if("count"===f)o["*"]=null!==(l=o["*"])&&void 0!==l?l:{},o["*"].count=new Set([v||lo(s,{forAs:!0})]);else o[d]=null!==(c=o[d])&&void 0!==c?c:{},o[d][f]=new Set([v||lo(s,{forAs:!0})])}}catch(e){u.e(e)}finally{u.f()}var p,h=F(null!==(t=n.groupby)&&void 0!==t?t:[]);try{for(h.s();!(p=h.n()).done;){var m=p.value;a.add(m)}}catch(e){h.e(e)}finally{h.f()}return a.size+ke(o).length===0?null:new r(e,a,o)}}]),r}(us),jv=function(e){l(r,e);var n=m(r);function r(e,i,o,l){var c;t(this,r),(c=n.call(this,e)).model=i,c.name=o,c.data=l,a(p(c),"column",void 0),a(p(c),"row",void 0),a(p(c),"facet",void 0),a(p(c),"childModel",void 0);var s,f=F(Jn);try{for(f.s();!(s=f.n()).done;){var d=s.value,v=i.facet[d];if(v){var h=v.bin,m=v.sort;c[d]=u({name:i.getName("".concat(d,"_domain")),fields:[lo(v)].concat(b(Dt(h)?[lo(v,{binSuffix:"end"})]:[]))},Ma(m)?{sortField:m}:M(m)?{sortIndexField:Nd(v,d)}:{})}}}catch(e){f.e(e)}finally{f.f()}return c.childModel=i.child,c}return i(r,[{key:"hash",value:function(){var e,n="Facet",t=F(Jn);try{for(t.s();!(e=t.n()).done;){var r=e.value;this[r]&&(n+=" ".concat(r.charAt(0),":").concat(le(this[r])))}}catch(e){t.e(e)}finally{t.f()}return n}},{key:"dependentFields",value:function(){var e,n=new Set(this.fields),t=F(Jn);try{for(t.s();!(e=t.n()).done;){var r=e.value;this[r]&&(this[r].sortField&&n.add(this[r].sortField.field),this[r].sortIndexField&&n.add(this[r].sortIndexField))}}catch(e){t.e(e)}finally{t.f()}return n}},{key:"producedFields",value:function(){return new Set}},{key:"getSource",value:function(){return this.name}},{key:"getChildIndependentFieldsWithStep",value:function(){var e,n={},t=F(ct);try{for(t.s();!(e=t.n()).done;){var r=e.value,i=this.childModel.component.scales[r];if(i&&!i.merged){var a=i.get("type"),o=i.get("range");if(_i(a)&&Lr(o)){var u=Fp(Cp(this.childModel,r));u?n[r]=u:gr(Pt(r))}}}}catch(e){t.e(e)}finally{t.f()}return n}},{key:"assembleRowColumnHeaderData",value:function(e,n,t){var r={row:"y",column:"x"}[e],i=[],a=[],o=[];t&&t[r]&&(n?(i.push("distinct_".concat(t[r])),a.push("max")):(i.push(t[r]),a.push("distinct")),o.push("distinct_".concat(t[r])));var l=this[e],c=l.sortField,s=l.sortIndexField;if(c){var f=c.op,d=void 0===f?za:f,v=c.field;i.push(v),a.push(d),o.push(lo(c,{forAs:!0}))}else s&&(i.push(s),a.push("max"),o.push(s));return{name:this[e].name,source:null!=n?n:this.data,transform:[u({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}}},{key:"assembleFacetHeaderData",value:function(e){var n,t=this.model.layout.columns,r=this.model.component.layoutHeaders,i=[],a={},o=F(qd);try{for(o.s();!(n=o.n()).done;){var u,l=n.value,c=F(Rd);try{for(c.s();!(u=c.n()).done;){var s,f,d=u.value,v=F(null!==(s=r[l]&&r[l][d])&&void 0!==s?s:[]);try{for(v.s();!(f=v.n()).done;){var p;if((null===(p=f.value.axes)||void 0===p?void 0:p.length)>0){a[l]=!0;break}}}catch(e){v.e(e)}finally{v.f()}}}catch(e){c.e(e)}finally{c.f()}if(a[l]){var h='length(data("'.concat(this.facet.name,'"))'),m="row"===l?t?{signal:"ceil(".concat(h," / ").concat(t,")")}:1:t?{signal:"min(".concat(h,", ").concat(t,")")}:{signal:h};i.push({name:"".concat(this.facet.name,"_").concat(l),transform:[{type:"sequence",start:0,stop:m}]})}}}catch(e){o.e(e)}finally{o.f()}var g=a.row,y=a.column;return(g||y)&&i.unshift(this.assembleRowColumnHeaderData("facet",null,e)),i}},{key:"assemble",value:function(){var e=[],n=null,t=this.getChildIndependentFieldsWithStep(),r=this.column,i=this.row,a=this.facet;if(r&&i&&(t.x||t.y)){var o,u;n="cross_".concat(this.column.name,"_").concat(this.row.name);var l=[].concat(null!==(o=t.x)&&void 0!==o?o:[],null!==(u=t.y)&&void 0!==u?u:[]),c=l.map((function(){return"distinct"}));e.push({name:n,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:c}]})}for(var s=0,f=[ln,un];s<f.length;s++){var d=f[s];this[d]&&e.push(this.assembleRowColumnHeaderData(d,n,t))}if(a){var v=this.assembleFacetHeaderData(t);v&&e.push.apply(e,b(v))}return e}},{key:"fields",get:function(){var e,n=[],t=F(Jn);try{for(t.s();!(e=t.n()).done;){var r,i=e.value;(null===(r=this[i])||void 0===r?void 0:r.fields)&&n.push.apply(n,b(this[i].fields))}}catch(e){t.e(e)}finally{t.f()}return n}}]),r}(us);function Pv(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function Nv(e,n){var t=Be(e);if("number"===n)return"toNumber(".concat(t,")");if("boolean"===n)return"toBoolean(".concat(t,")");if("string"===n)return"toString(".concat(t,")");if("date"===n)return"toDate(".concat(t,")");if("flatten"===n)return t;if(0===n.indexOf("date:")){var r=Pv(n.slice(5,n.length));return"timeParse(".concat(t,",'").concat(r,"')")}if(0===n.indexOf("utc:")){var i=Pv(n.slice(4,n.length));return"utcParse(".concat(t,",'").concat(i,"')")}return gr('Unrecognized parse "'.concat(n,'".')),null}function Mv(e){var n={};return ne(e.filter,(function(e){if($r(e)){var t=null;if(Ir(e))t=To(e.equal);else if(Gr(e))t=To(e.lte);else if(Hr(e))t=To(e.lt);else if(Vr(e))t=To(e.gt);else if(Yr(e))t=To(e.gte);else if(Jr(e))t=e.range[0];else if(Xr(e)){var r;t=(null!==(r=e.oneOf)&&void 0!==r?r:e.in)[0]}t&&(yr(t)?n[e.field]="date":V(t)?n[e.field]="number":Y(t)&&(n[e.field]="string")),e.timeUnit&&(n[e.field]="date")}})),n}function Tv(e){var n={};function t(e){var t;Oo(e)?n[e.field]="date":"quantitative"===e.type&&(Y(t=e.aggregate)&&se(["min","max"],t))?n[e.field]="number":Ne(e.field)>1?e.field in n||(n[e.field]="flatten"):to(e)&&Ma(e.sort)&&Ne(e.sort.field)>1&&(e.sort.field in n||(n[e.sort.field]="flatten"))}if((Vp(e)||Yp(e))&&e.forEachFieldDef((function(n,r){if(eo(n))t(n);else{var i=tt(r),a=e.fieldDef(i);t(u(u({},n),{},{type:a.type}))}})),Vp(e)){var r=e.mark,i=e.markDef,a=e.encoding;if(ra(r)&&!e.encoding.order){var o=a["horizontal"===i.orient?"y":"x"];Ja(o)&&"quantitative"===o.type&&!(o.field in n)&&(n[o.field]="number")}}return n}var Lv=function(e){l(r,e);var n=m(r);function r(e,i){var o;return t(this,r),a(p(o=n.call(this,e)),"_parse",void 0),o._parse=i,o}return i(r,[{key:"clone",value:function(){return new r(null,ie(this._parse))}}]),i(r,[{key:"hash",value:function(){return"Parse ".concat(le(this._parse))}},{key:"merge",value:function(e){this._parse=u(u({},this._parse),e.parse),e.remove()}},{key:"assembleFormatParse",value:function(){var e,n={},t=F(ke(this._parse));try{for(t.s();!(e=t.n()).done;){var r=e.value,i=this._parse[r];1===Ne(r)&&(n[r]=i)}}catch(e){t.e(e)}finally{t.f()}return n}},{key:"producedFields",value:function(){return new Set(ke(this._parse))}},{key:"dependentFields",value:function(){return new Set(ke(this._parse))}},{key:"assembleTransforms",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ke(this._parse).filter((function(e){return!n||Ne(e)>1})).map((function(n){var t=Nv(n,e._parse[n]);return t?{type:"formula",expr:t,as:Pe(n)}:null})).filter((function(e){return null!==e}))}},{key:"parse",get:function(){return this._parse}}],[{key:"makeExplicit",value:function(e,n,t){var r={},i=n.data;return!nc(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},t)}},{key:"makeWithAncestors",value:function(e,n,t,i){var a,o=F(ke(t));try{for(o.s();!(a=o.n()).done;){var u=a.value,l=i.getWithExplicit(u);void 0!==l.value&&(l.explicit||l.value===t[u]||"derived"===l.value||"flatten"===t[u]?delete t[u]:gr(Rt(u,t[u],l.value)))}}catch(e){o.e(e)}finally{o.f()}var c,s=F(ke(n));try{for(s.s();!(c=s.n()).done;){var f=c.value,d=i.get(f);void 0!==d&&(d===n[f]?delete n[f]:gr(Rt(f,n[f],d)))}}catch(e){s.e(e)}finally{s.f()}var v=new Hl(n,t);i.copyAll(v);var p,h={},m=F(ke(v.combine()));try{for(m.s();!(p=m.n()).done;){var g=p.value,y=v.get(g);null!==y&&(h[g]=y)}}catch(e){m.e(e)}finally{m.f()}return 0===ke(h).length||i.parseNothing?null:new r(e,h)}}]),r}(us),qv=function(e){l(r,e);var n=m(r);function r(e){return t(this,r),n.call(this,e)}return i(r,[{key:"clone",value:function(){return new r(null)}}]),i(r,[{key:"dependentFields",value:function(){return new Set}},{key:"producedFields",value:function(){return new Set([Lu])}},{key:"hash",value:function(){return"Identifier"}},{key:"assemble",value:function(){return{type:"identifier",as:Lu}}}]),r}(us),Rv=function(e){l(r,e);var n=m(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e)).params=i,a}return i(r,[{key:"clone",value:function(){return new r(null,this.params)}}]),i(r,[{key:"dependentFields",value:function(){return new Set}},{key:"producedFields",value:function(){}},{key:"hash",value:function(){return"Graticule ".concat(le(this.params))}},{key:"assemble",value:function(){return u({type:"graticule"},!0===this.params?{}:this.params)}}]),r}(us),Wv=function(e){l(r,e);var n=m(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e)).params=i,a}return i(r,[{key:"clone",value:function(){return new r(null,this.params)}}]),i(r,[{key:"dependentFields",value:function(){return new Set}},{key:"producedFields",value:function(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}},{key:"hash",value:function(){return"Hash ".concat(le(this.params))}},{key:"assemble",value:function(){return u({type:"sequence"},this.params)}}]),r}(us),Uv=function(e){l(r,e);var n=m(r);function r(e){var i,o,l;if(t(this,r),a(p(o=n.call(this,null)),"_data",void 0),a(p(o),"_name",void 0),a(p(o),"_generator",void 0),nc(e=null!==(i=e)&&void 0!==i?i:{name:"source"})||(l=e.format?u({},oe(e.format,["parse"])):{}),Zl(e))o._data={values:e.values};else if(Kl(e)){if(o._data={url:e.url},!l.type){var c=/(?:\.([^.]+))?$/.exec(e.url)[1];se(["json","csv","tsv","dsv","topojson"],c)||(c="json"),l.type=c}}else rc(e)?o._data={values:[{type:"Sphere"}]}:(ec(e)||nc(e))&&(o._data={});return o._generator=nc(e),e.name&&(o._name=e.name),l&&!xe(l)&&(o._data.format=l),o}return i(r,[{key:"dependentFields",value:function(){return new Set}},{key:"producedFields",value:function(){}},{key:"hasName",value:function(){return!!this._name}},{key:"remove",value:function(){throw new Error("Source nodes are roots and cannot be removed.")}},{key:"hash",value:function(){throw new Error("Cannot hash sources")}},{key:"assemble",value:function(){return u(u({name:this._name},this._data),{},{transform:[]})}},{key:"data",get:function(){return this._data}},{key:"isGenerator",get:function(){return this._generator}},{key:"dataName",get:function(){return this._name},set:function(e){this._name=e}},{key:"parent",set:function(e){throw new Error("Source nodes have to be roots.")}}]),r}(us);function Iv(e){return e instanceof Uv||e instanceof Rv||e instanceof Wv}var Hv=new WeakMap,Gv=function(){function e(){t(this,e),Hv.set(this,{writable:!0,value:void 0}),S(this,Hv,!1)}return i(e,[{key:"setModified",value:function(){S(this,Hv,!0)}},{key:"modifiedFlag",get:function(){return function(e,n){var t=n.get(e);if(!t)throw new TypeError("attempted to get private field on non-instance");return t.get?t.get.call(e):t.value}(this,Hv)}}]),e}(),Vv=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.apply(this,arguments)}return i(r,[{key:"getNodeDepths",value:function(e,n,t){t.set(e,n);var r,i=F(e.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.getNodeDepths(a,n+1,t)}}catch(e){i.e(e)}finally{i.f()}return t}},{key:"optimize",value:function(e){var n,t=F(b(this.getNodeDepths(e,0,new Map).entries()).sort((function(e,n){return n[1]-e[1]})));try{for(t.s();!(n=t.n()).done;){var r=n.value;this.run(r[0])}}catch(e){t.e(e)}finally{t.f()}return this.modifiedFlag}}]),r}(Gv),Yv=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.apply(this,arguments)}return i(r,[{key:"optimize",value:function(e){this.run(e);var n,t=F(e.children);try{for(t.s();!(n=t.n()).done;){var r=n.value;this.optimize(r)}}catch(e){t.e(e)}finally{t.f()}return this.modifiedFlag}}]),r}(Gv),Jv=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.apply(this,arguments)}return i(r,[{key:"mergeNodes",value:function(e,n){var t,r=n.shift(),i=F(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;e.removeChild(a),a.parent=r,a.remove()}}catch(e){i.e(e)}finally{i.f()}}},{key:"run",value:function(e){for(var n=e.children.map((function(e){return e.hash()})),t={},r=0;r<n.length;r++)void 0===t[n[r]]?t[n[r]]=[e.children[r]]:t[n[r]].push(e.children[r]);var i,a=F(ke(t));try{for(a.s();!(i=a.n()).done;){var o=i.value;t[o].length>1&&(this.setModified(),this.mergeNodes(e,t[o]))}}catch(e){a.e(e)}finally{a.f()}}}]),r}(Yv),Xv=function(e){l(r,e);var n=m(r);function r(e){var i;return t(this,r),a(p(i=n.call(this)),"requiresSelectionId",void 0),i.requiresSelectionId=e&&Js(e),i}return i(r,[{key:"run",value:function(e){e instanceof qv&&(this.requiresSelectionId&&(Iv(e.parent)||e.parent instanceof zv||e.parent instanceof Lv)||(this.setModified(),e.remove()))}}]),r}(Yv),Qv=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.apply(this,arguments)}return i(r,[{key:"optimize",value:function(e){return this.run(e,new Set),this.modifiedFlag}},{key:"run",value:function(e,n){var t=new Set;e instanceof cs&&ge(t=e.producedFields(),n)&&(this.setModified(),e.removeFormulas(n),0===e.producedFields.length&&e.remove());var r,i=F(e.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.run(a,new Set([].concat(b(n),b(t))))}}catch(e){i.e(e)}finally{i.f()}}}]),r}(Gv),$v=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.call(this)}return i(r,[{key:"run",value:function(e){e instanceof ls&&!e.isRequired()&&(this.setModified(),e.remove())}}]),r}(Yv),Kv=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.apply(this,arguments)}return i(r,[{key:"run",value:function(e){if(!(Iv(e)||e.numChildren()>1)){var n,t=F(e.children);try{for(t.s();!(n=t.n()).done;){var r=n.value;if(r instanceof Lv)if(e instanceof Lv)this.setModified(),e.merge(r);else{if(be(e.producedFields(),r.dependentFields()))continue;this.setModified(),r.swapWithParent()}}}catch(e){t.e(e)}finally{t.f()}}}}]),r}(Vv),Zv=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.apply(this,arguments)}return i(r,[{key:"run",value:function(e){var n=b(e.children),t=e.children.filter((function(e){return e instanceof Lv}));if(e.numChildren()>1&&t.length>=1){var r,i={},a=new Set,o=F(t);try{for(o.s();!(r=o.n()).done;){var u,l=r.value.parse,c=F(ke(l));try{for(c.s();!(u=c.n()).done;){var s=u.value;s in i?i[s]!==l[s]&&a.add(s):i[s]=l[s]}}catch(e){c.e(e)}finally{c.f()}}}catch(e){o.e(e)}finally{o.f()}var f,d=F(a);try{for(d.s();!(f=d.n()).done;){delete i[f.value]}}catch(e){d.e(e)}finally{d.f()}if(!xe(i)){this.setModified();var v,p=new Lv(e,i),h=F(n);try{for(h.s();!(v=h.n()).done;){var m=v.value;if(m instanceof Lv){var g,y=F(ke(i));try{for(y.s();!(g=y.n()).done;){var x=g.value;delete m.parse[x]}}catch(e){y.e(e)}finally{y.f()}}e.removeChild(m),m.parent=p,m instanceof Lv&&0===ke(m.parse).length&&m.remove()}}catch(e){h.e(e)}finally{h.f()}}}}}]),r}(Vv),ep=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.apply(this,arguments)}return i(r,[{key:"run",value:function(e){e instanceof ls||e.numChildren()>0||e instanceof jv||e instanceof Uv||(this.setModified(),e.remove())}}]),r}(Vv),np=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.apply(this,arguments)}return i(r,[{key:"run",value:function(e){var n,t=e.children.filter((function(e){return e instanceof cs})),r=t.pop(),i=F(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;this.setModified(),r.merge(a)}}catch(e){i.e(e)}finally{i.f()}}}]),r}(Vv),tp=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.apply(this,arguments)}return i(r,[{key:"run",value:function(e){var n,t={},r=F(e.children.filter((function(e){return e instanceof zv})));try{for(r.s();!(n=r.n()).done;){var i=n.value,a=le(i.groupBy);a in t||(t[a]=[]),t[a].push(i)}}catch(e){r.e(e)}finally{r.f()}var o,u=F(ke(t));try{for(u.s();!(o=u.n()).done;){var l=t[o.value];if(l.length>1){var c,s=l.pop(),f=F(l);try{for(f.s();!(c=f.n()).done;){var d=c.value;s.merge(d)&&(e.removeChild(d),d.parent=s,d.remove(),this.setModified())}}catch(e){f.e(e)}finally{f.f()}}}}catch(e){u.e(e)}finally{u.f()}}}]),r}(Vv),rp=function(e){l(r,e);var n=m(r);function r(e){var i;return t(this,r),(i=n.call(this)).model=e,i}return i(r,[{key:"run",value:function(e){var n,t=!(Iv(e)||e instanceof gd||e instanceof Lv||e instanceof qv),r=[],i=[],a=F(e.children);try{for(a.s();!(n=a.n()).done;){var o=n.value;o instanceof Ov&&(t&&!be(e.producedFields(),o.dependentFields())?r.push(o):i.push(o))}}catch(e){a.e(e)}finally{a.f()}if(r.length>0){var u,l=r.pop(),c=F(r);try{for(c.s();!(u=c.n()).done;){var s=u.value;l.merge(s,this.model.renameSignal.bind(this.model))}}catch(e){c.e(e)}finally{c.f()}this.setModified(),e instanceof Ov?e.merge(l,this.model.renameSignal.bind(this.model)):l.swapWithParent()}if(i.length>1){var f,d=i.pop(),v=F(i);try{for(v.s();!(f=v.n()).done;){var p=f.value;d.merge(p,this.model.renameSignal.bind(this.model))}}catch(e){v.e(e)}finally{v.f()}this.setModified()}}}]),r}(Vv),ip=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.apply(this,arguments)}return i(r,[{key:"run",value:function(e){var n=b(e.children);if(fe(n,(function(e){return e instanceof ls}))&&!(e.numChildren()<=1)){var t,r,i=[],a=F(n);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o instanceof ls){for(var u=o;1===u.numChildren();){var l=y(u.children,1)[0];if(!(l instanceof ls))break;u=l}i.push.apply(i,b(u.children)),t?(e.removeChild(o),o.parent=t.parent,t.parent.removeChild(t),t.parent=u,this.setModified()):t=u}else i.push(o)}}catch(e){a.e(e)}finally{a.f()}if(i.length){this.setModified();var c,s=F(i);try{for(s.s();!(c=s.n()).done;){var f=c.value;f.parent.removeChild(f),f.parent=t}}catch(e){s.e(e)}finally{s.f()}}}}}]),r}(Vv),ap=function(e){l(r,e);var n=m(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e)).transform=i,a}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.transform))}}]),i(r,[{key:"addDimensions",value:function(e){this.transform.groupby=he(this.transform.groupby.concat(e),(function(e){return e}))}},{key:"dependentFields",value:function(){var e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map((function(e){return e.field})).filter((function(e){return void 0!==e})).forEach(e.add,e),e}},{key:"producedFields",value:function(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}},{key:"getDefaultName",value:function(e){var n;return null!==(n=e.as)&&void 0!==n?n:lo(e)}},{key:"hash",value:function(){return"JoinAggregateTransform ".concat(le(this.transform))}},{key:"assemble",value:function(){var e,n=[],t=[],r=[],i=F(this.transform.joinaggregate);try{for(i.s();!(e=i.n()).done;){var a=e.value;t.push(a.op),r.push(this.getDefaultName(a)),n.push(void 0===a.field?null:a.field)}}catch(e){i.e(e)}finally{i.f()}var o=this.transform.groupby;return u({type:"joinaggregate",as:r,ops:t,fields:n},void 0!==o?{groupby:o}:{})}}]),r}(us);var op=function(e){l(r,e);var n=m(r);function r(e,i){var o;return t(this,r),a(p(o=n.call(this,e)),"_stack",void 0),o._stack=i,o}return i(r,[{key:"clone",value:function(){return new r(null,ie(this._stack))}}]),i(r,[{key:"addDimensions",value:function(e){var n;(n=this._stack.facetby).push.apply(n,b(e))}},{key:"dependentFields",value:function(){var e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}},{key:"producedFields",value:function(){return new Set(this._stack.as)}},{key:"hash",value:function(){return"Stack ".concat(le(this._stack))}},{key:"getGroupbyFields",value:function(){var e=this._stack,n=e.dimensionFieldDef,t=e.impute,r=e.groupby;return n?n.bin?t?[lo(n,{binSuffix:"mid"})]:[lo(n,{}),lo(n,{binSuffix:"end"})]:[lo(n)]:null!=r?r:[]}},{key:"assemble",value:function(){var e=[],n=this._stack,t=n.facetby,r=n.dimensionFieldDef,i=n.stackField,a=n.stackby,o=n.sort,u=n.offset,l=n.impute,c=n.as;if(l&&r){var s=r.band,f=void 0===s?.5:s;r.bin&&e.push({type:"formula",expr:"".concat(f,"*")+lo(r,{expr:"datum"})+"+".concat(1-f,"*")+lo(r,{expr:"datum",binSuffix:"end"}),as:lo(r,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:i,groupby:[].concat(b(a),b(t)),key:lo(r,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[].concat(b(this.getGroupbyFields()),b(t)),field:i,sort:o,as:c,offset:u}),e}},{key:"stack",get:function(){return this._stack}}],[{key:"makeFromTransform",value:function(e,n){var t=n.stack,i=n.groupby,a=n.as,o=n.offset,u=void 0===o?"zero":o,l=[],c=[];if(void 0!==n.sort){var s,f=F(n.sort);try{for(f.s();!(s=f.n()).done;){var d=s.value;l.push(d.field),c.push(Me(d.order,"ascending"))}}catch(e){f.e(e)}finally{f.f()}}return new r(e,{stackField:t,groupby:i,offset:u,sort:{field:l,order:c},facetby:[],as:function(e){return M(e)&&e.every((function(e){return Y(e)}))&&e.length>1}(a)?a:Y(a)?[a,a+"_end"]:[n.stack+"_start",n.stack+"_end"]})}},{key:"makeFromEncoding",value:function(e,n){var t=n.stack,i=n.encoding;if(!t)return null;var a,o=t.groupbyChannel,u=t.fieldChannel,l=t.offset,c=t.impute;o&&(a=wo(i[o]));var s,f=function(e){return e.stack.stackBy.reduce((function(e,n){var t=lo(n.fieldDef);return t&&e.push(t),e}),[])}(n),d=n.encoding.order;return s=M(d)||Ja(d)?Yo(d):f.reduce((function(e,n){return e.field.push(n),e.order.push("y"===u?"descending":"ascending"),e}),{field:[],order:[]}),new r(e,{dimensionFieldDef:a,stackField:n.vgField(u),facetby:[],stackby:f,sort:s,offset:l,impute:c,as:[n.vgField(u,{suffix:"start",forAs:!0}),n.vgField(u,{suffix:"end",forAs:!0})]})}}]),r}(us),up=function(e){l(r,e);var n=m(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e)).transform=i,a}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.transform))}}]),i(r,[{key:"addDimensions",value:function(e){this.transform.groupby=he(this.transform.groupby.concat(e),(function(e){return e}))}},{key:"dependentFields",value:function(){var e,n,t=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(t.add,t),(null!==(n=this.transform.sort)&&void 0!==n?n:[]).forEach((function(e){return t.add(e.field)})),this.transform.window.map((function(e){return e.field})).filter((function(e){return void 0!==e})).forEach(t.add,t),t}},{key:"producedFields",value:function(){return new Set(this.transform.window.map(this.getDefaultName))}},{key:"getDefaultName",value:function(e){var n;return null!==(n=e.as)&&void 0!==n?n:lo(e)}},{key:"hash",value:function(){return"WindowTransform ".concat(le(this.transform))}},{key:"assemble",value:function(){var e,n=[],t=[],r=[],i=[],a=F(this.transform.window);try{for(a.s();!(e=a.n()).done;){var o=e.value;t.push(o.op),r.push(this.getDefaultName(o)),i.push(void 0===o.param?null:o.param),n.push(void 0===o.field?null:o.field)}}catch(e){a.e(e)}finally{a.f()}var l=this.transform.frame,c=this.transform.groupby;if(l&&null===l[0]&&null===l[1]&&t.every((function(e){return nn(e)})))return u({type:"joinaggregate",as:r,ops:t,fields:n},void 0!==c?{groupby:c}:{});var s=[],f=[];if(void 0!==this.transform.sort){var d,v=F(this.transform.sort);try{for(v.s();!(d=v.n()).done;){var p,h=d.value;s.push(h.field),f.push(null!==(p=h.order)&&void 0!==p?p:"ascending")}}catch(e){v.e(e)}finally{v.f()}}var m={field:s,order:f},g=this.transform.ignorePeers;return u(u(u({type:"window",params:i,as:r,ops:t,fields:n,sort:m},void 0!==g?{ignorePeers:g}:{}),void 0!==c?{groupby:c}:{}),void 0!==l?{frame:l}:{})}}]),r}(us);function lp(e){if(e instanceof jv)if(1!==e.numChildren()||e.children[0]instanceof ls){var n=e.model.component.data.main;cp(n);var t,r=(o=e,function e(n){if(!(n instanceof jv)){var t=n.clone();if(t instanceof ls){var r=sp+t.getSource();t.setSource(r),o.model.component.data.outputNodes[r]=t}else(t instanceof zv||t instanceof op||t instanceof up||t instanceof ap)&&t.addDimensions(o.fields);var i,a=F(n.children.flatMap(e));try{for(a.s();!(i=a.n()).done;)i.value.parent=t}catch(e){a.e(e)}finally{a.f()}return[t]}return n.children.flatMap(e)}),i=F(e.children.map(r).flat());try{for(i.s();!(t=i.n()).done;){t.value.parent=n}}catch(e){i.e(e)}finally{i.f()}}else{var a=e.children[0];(a instanceof zv||a instanceof op||a instanceof up||a instanceof ap)&&a.addDimensions(e.fields),a.swapWithParent(),lp(e)}else e.children.map(lp);var o}function cp(e){if(e instanceof ls&&e.type===Ql.Main&&1===e.numChildren()){var n=e.children[0];n instanceof jv||(n.swapWithParent(),cp(e))}}var sp="scale_";function fp(e){var n,t=F(e);try{for(t.s();!(n=t.n()).done;){var r,i=n.value,a=F(i.children);try{for(a.s();!(r=a.n()).done;){if(r.value.parent!==i)return!1}}catch(e){a.e(e)}finally{a.f()}if(!fp(i.children))return!1}}catch(e){t.e(e)}finally{t.f()}return!0}function dp(e,n){var t,r=!1,i=F(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;r=e.optimize(a)||r}}catch(e){i.e(e)}finally{i.f()}return r}function vp(e,n,t){var r=e.sources,i=!1;return i=dp(new $v,r)||i,i=dp(new Xv(n),r)||i,r=r.filter((function(e){return e.numChildren()>0})),i=dp(new ep,r)||i,r=r.filter((function(e){return e.numChildren()>0})),t||(i=dp(new Kv,r)||i,i=dp(new rp(n),r)||i,i=dp(new Qv,r)||i,i=dp(new Zv,r)||i,i=dp(new tp,r)||i,i=dp(new np,r)||i,i=dp(new Jv,r)||i,i=dp(new ip,r)||i),e.sources=r,i}function pp(e,n){fp(e.sources);for(var t=0,r=0,i=0;i<5&&vp(e,n,!0);i++)t++;e.sources.map(lp);for(var a=0;a<5&&vp(e,n,!1);a++)r++;fp(e.sources),5===Math.max(t,r)&&gr("Maximum optimization runs(".concat(5,") reached."))}var hp=function(){function e(n){t(this,e),a(this,"signal",void 0),Object.defineProperty(this,"signal",{enumerable:!0,get:n})}return i(e,null,[{key:"fromName",value:function(n,t){return new e((function(){return n(t)}))}}]),e}();function mp(e){Vp(e)?function(e){var n,t=e.component.scales,r=F(ke(t));try{for(r.s();!(n=r.n()).done;){var i=n.value,a=gp(e,i);if(t[i].setWithExplicit("domains",a),kp(e,i),e.component.data.isFaceted){for(var o=e;!Yp(o)&&o.parent;)o=o.parent;if("shared"===o.component.resolve.scale[i]){var u,l=F(a.value);try{for(l.s();!(u=l.n()).done;){var c=u.value;qr(c)&&(c.data=sp+c.data.replace(sp,""))}}catch(e){l.e(e)}finally{l.f()}}}}}catch(e){r.e(e)}finally{r.f()}}(e):function(e){var n,t=F(e.children);try{for(t.s();!(n=t.n()).done;){mp(n.value)}}catch(e){t.e(e)}finally{t.f()}var r,i=e.component.scales,a=F(ke(i));try{for(a.s();!(r=a.n()).done;){var o,u=r.value,l=void 0,c=null,s=F(e.children);try{for(s.s();!(o=s.n()).done;){var f=o.value.component.scales[u];if(f){l=void 0===l?f.getWithExplicit("domains"):Xl(l,f.getWithExplicit("domains"),"domains","scale",Ap);var d=f.get("selectionExtent");c&&d&&c.selection!==d.selection&&gr(Lt),c=d}}}catch(e){s.e(e)}finally{s.f()}i[u].setWithExplicit("domains",l),c&&i[u].set("selectionExtent",c,!0)}}catch(e){a.e(e)}finally{a.f()}}(e)}function gp(e,n){var t=e.getScaleComponent(n).get("type"),r=e.encoding,i=function(e,n,t,r){if("unaggregated"===e){var i=wp(n,t),a=i.valid,o=i.reason;if(!a)return void gr(o)}else if(void 0===e&&r.useUnaggregatedDomain&&wp(n,t).valid)return"unaggregated";return e}(e.scaleDomain(n),e.typedFieldDef(n),t,e.config.scale);return i!==e.scaleDomain(n)&&(e.specifiedScales[n]=u(u({},e.specifiedScales[n]),{},{domain:i})),"x"===n&&Ao(r.x2)?Ao(r.x)?Xl(bp(t,i,e,"x"),bp(t,i,e,"x2"),"domain","scale",Ap):bp(t,i,e,"x2"):"y"===n&&Ao(r.y2)?Ao(r.y)?Xl(bp(t,i,e,"y"),bp(t,i,e,"y2"),"domain","scale",Ap):bp(t,i,e,"y2"):bp(t,i,e,n)}function yp(e,n,t){var r,i=null===(r=Nr(t))||void 0===r?void 0:r.unit;return"temporal"===n||i?function(e,n,t){return e.map((function(e){var r=_o(e,{timeUnit:t,type:n});return{signal:"{data: ".concat(r,"}")}}))}(e,n,i):[e]}function bp(e,n,t,r){var i=Ao(t.encoding[r]),a=i.type,o=i.timeUnit;if(function(e){return e&&e.unionWith}(n)){var u=bp(e,void 0,t,r),l=yp(n.unionWith,a,o);return Gl([].concat(b(u.value),b(l)))}if(Tr(n))return Gl([n]);if(n&&"unaggregated"!==n&&!Ni(n))return Gl(yp(n,a,o));var c=t.stack;if(c&&r===c.fieldChannel){if("normalize"===c.offset)return Vl([[0,1]]);var s=t.requestDataName(Ql.Main);return Vl([{data:s,field:t.vgField(r,{suffix:"start"})},{data:s,field:t.vgField(r,{suffix:"end"})}])}var f=yt(r)&&Ja(i)?function(e,n,t){if(!_i(t))return;var r=e.fieldDef(n),i=r.sort;if(Ta(i))return{op:"min",field:Nd(r,n),order:"ascending"};var a=e.stack,o=a?[].concat(b(a.groupbyField?[a.groupbyField]:[]),b(a.stackBy.map((function(e){return e.fieldDef.field})))):void 0;if(Ma(i))return xp(i,a&&!se(o,i.field));if(Na(i)){var u=i.encoding,l=i.order,c=e.fieldDef(u),s=c.aggregate,f=c.field,d=a&&!se(o,f);if(Ze(s)||en(s))return xp({field:lo(c),order:l},d);if(nn(s)||!s)return xp({op:s,field:f,order:l},d)}else{if("descending"===i)return{op:"min",field:e.vgField(n),order:"descending"};if(se(["ascending",void 0],i))return!0}return}(t,r,e):void 0;if(Qa(i))return Vl(yp([i.datum],a,o));var d=i;if("unaggregated"===n){var v=t.requestDataName(Ql.Main),p=i.field;return Vl([{data:v,field:lo({field:p,aggregate:"min"})},{data:v,field:lo({field:p,aggregate:"max"})}])}if(Dt(d.bin)){if(_i(e))return Vl("bin-ordinal"===e?[]:[{data:De(f)?t.requestDataName(Ql.Main):t.requestDataName(Ql.Raw),field:t.vgField(r,jo(d,r)?{binSuffix:"range"}:{}),sort:!0!==f&&T(f)?f:{field:t.vgField(r,{}),op:"min"}}]);var h=d.bin;if(Dt(h)){var m=Ev(t,d.field,h);return Vl([new hp((function(){var e=t.getSignalName(m);return"[".concat(e,".start, ").concat(e,".stop]")}))])}return Vl([{data:t.requestDataName(Ql.Main),field:t.vgField(r,{})}])}if(d.timeUnit&&se(["time","utc"],e)&&Ha(r,d,Vp(t)?t.encoding[it(r)]:void 0,t.stack,t.markDef,t.config)){var g=t.requestDataName(Ql.Main);return Vl([{data:g,field:t.vgField(r)},{data:g,field:t.vgField(r,{suffix:"end"})}])}return Vl(f?[{data:De(f)?t.requestDataName(Ql.Main):t.requestDataName(Ql.Raw),field:t.vgField(r),sort:f}]:[{data:t.requestDataName(Ql.Main),field:t.vgField(r)}])}function xp(e,n){var t=e.op,r=e.field,i=e.order;return u(u({op:null!=t?t:n?"sum":za},r?{field:ze(r)}:{}),i?{order:i}:{})}function kp(e,n){var t,r=e.component.scales[n],i=e.specifiedScales[n].domain,a=null===(t=e.fieldDef(n))||void 0===t?void 0:t.bin,o=Ni(i)&&i,u=Ct(a)&&St(a.extent)&&a.extent;(o||u)&&r.set("selectionExtent",null!=o?o:u,!0)}function wp(e,n){var t=e.aggregate,r=e.type;return t?Y(t)&&!on[t]?{valid:!1,reason:Zt(t)}:"quantitative"===r&&"log"===n?{valid:!1,reason:er(e)}:{valid:!0}:{valid:!1,reason:Kt(e)}}function Ap(e,n,t,r){return e.explicit&&n.explicit&&gr(function(e,n,t,r){return"Conflicting ".concat(n.toString(),' property "').concat(e.toString(),'" (').concat(ue(t)," and ").concat(ue(r),"). Using the union of the two domains.")}(t,r,e.value,n.value)),{explicit:e.explicit,value:[].concat(b(e.value),b(n.value))}}function Dp(e){var n=he(e.map((function(e){if(qr(e)){e.sort;return v(e,["sort"])}return e})),le),t=he(e.map((function(e){if(qr(e)){var n=e.sort;return void 0===n||De(n)||("op"in n&&"count"===n.op&&delete n.field,"ascending"===n.order&&delete n.order),n}})).filter((function(e){return void 0!==e})),le);if(0!==n.length){if(1===n.length){var r=e[0];if(qr(r)&&t.length>0){var i=t[0];if(t.length>1)gr(rr),i=!0;else if(T(i)&&"field"in i){var a=i.field;r.field===a&&(i=!i.order||{order:i.order})}return u(u({},r),{},{sort:i})}return r}var o,l=he(t.map((function(e){return De(e)||!("op"in e)||Y(e.op)&&e.op in Ke?e:(gr(function(e){return"Dropping sort property ".concat(ue(e),' as unioned domains only support boolean or op "count", "min", and "max".')}(e)),!0)})),le);1===l.length?o=l[0]:l.length>1&&(gr(rr),o=!0);var c=he(e.map((function(e){return qr(e)?e.data:null})),(function(e){return e}));return 1===c.length&&null!==c[0]?u({data:c[0],fields:n.map((function(e){return e.field}))},o?{sort:o}:{}):u({fields:n},o?{sort:o}:{})}}function Fp(e){if(qr(e)&&Y(e.field))return e.field;if(function(e){return!M(e)&&"fields"in e&&!("data"in e)}(e)){var n,t,r=F(e.fields);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(qr(i)&&Y(i.field))if(n){if(n!==i.field)return gr("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),n}else n=i.field}}catch(e){r.e(e)}finally{r.f()}return gr("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),n}if(function(e){return!M(e)&&"fields"in e&&"data"in e}(e)){gr("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");var a=e.fields[0];return Y(a)?a:void 0}}function Cp(e,n){return Dp(e.component.scales[n].get("domains").map((function(n){return qr(n)&&(n.data=e.lookupDataSource(n.data)),n})))}function Sp(e){return Xp(e)||Jp(e)?e.children.reduce((function(e,n){return e.concat(Sp(n))}),Ep(e)):Ep(e)}function Ep(e){return ke(e.component.scales).reduce((function(n,t){var r=e.component.scales[t];if(r.merged)return n;var i,a=r.combine(),o=a.name,l=a.type,c=a.selectionExtent,s=(a.domains,a.range,a.reverse),f=v(a,["name","type","selectionExtent","domains","range","reverse"]),d=function(e,n,t,r){if(st(t)){if(Lr(e))return{step:{signal:n+"_step"}}}else if(T(e)&&qr(e))return u(u({},e),{},{data:r.lookupDataSource(e.data)});return e}(a.range,o,t,e);c&&(i=function(e,n){var t=n.selection;return{signal:bd(e.getSelectionComponent(t,Fe(t)),n)}}(e,c));var p=Cp(e,t);return n.push(u(u(u(u({name:o,type:l},p?{domain:p}:{}),i?{domainRaw:i}:{}),{},{range:d},void 0!==s?{reverse:s}:{}),f)),n}),[])}var Bp=function(e){l(r,e);var n=m(r);function r(e,i){var o;return t(this,r),a(p(o=n.call(this,{},{name:e})),"merged",!1),o.setWithExplicit("type",i),o}return i(r,[{key:"domainDefinitelyIncludesZero",value:function(){return!1!==this.get("zero")||fe(this.get("domains"),(function(e){return M(e)&&2===e.length&&e[0]<=0&&e[1]>=0}))}}]),r}(Hl),Op=["range","scheme"];function _p(e){return"x"===e?"width":"y"===e?"height":void 0}function zp(e,n){var t=e.fieldDef(n);if(t&&t.bin&&Dt(t.bin)){var r=Ev(e,t.field,t.bin),i=_p(n),a=e.getName(i);return new hp((function(){var n=e.getSignalName(r),t="(".concat(n,".stop - ").concat(n,".start) / ").concat(n,".step");return"".concat(e.getSignalName(a)," / (").concat(t,")")}))}}function jp(e,n){var t,r=n.specifiedScales[e],i=n.size,a=n.getScaleComponent(e).get("type"),o=F(Op);try{for(o.s();!(t=o.n()).done;){var u=t.value;if(void 0!==r[u]){var l=Li(a,u),c=qi(e,u);if(l)if(c)gr(c);else switch(u){case"range":var s=r.range;if(M(s)){if(st(e))return Gl(s.map((function(e){if("width"===e||"height"===e){var t=n.getName(e),r=n.getSignalName.bind(n);return hp.fromName(r,t)}return e})))}else if(T(s))return Gl({data:n.requestDataName(Ql.Main),field:s.field,sort:{op:"min",field:n.vgField(e)}});return Gl(s);case"scheme":return Gl(Pp(r[u]))}else gr(nr(a,u,e))}}}catch(e){o.e(e)}finally{o.f()}if(e===sn||e===fn){var f=e===sn?"width":"height",d=i[f];if(Yu(d)){if(_i(a))return Gl({step:d.step});gr(tr(f))}}var v=r.rangeMin,p=r.rangeMax,h=function(e,n){var t=n.size,r=n.config,i=n.mark,a=n.encoding,o=n.getSignalName.bind(n),u=Ao(a[e]).type,l=n.getScaleComponent(e).get("type"),c=n.specifiedScales[e],s=c.domain,f=c.domainMid;switch(e){case sn:case fn:if(se(["point","band"],l))if(e!==sn||t.width){if(e===fn&&!t.height){var d=Ku(r.view,"height");if(Yu(d))return d}}else{var v=Ku(r.view,"width");if(Yu(v))return v}var p=_p(e),h=n.getName(p);return e===fn&&zi(l)?[hp.fromName(o,h),0]:[0,hp.fromName(o,h)];case Cn:var m=Np(i,n.component.scales[e].get("zero"),r),g=function(e,n,t,r){var i={x:zp(t,"x"),y:zp(t,"y")};switch(e){case"bar":case"tick":if(void 0!==r.scale.maxBandSize)return r.scale.maxBandSize;var a=Tp(n,i,r.view);return V(a)?a-1:new hp((function(){return"".concat(a.signal," - 1")}));case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":if(r.scale.maxSize)return r.scale.maxSize;var o=Tp(n,i,r.view);return V(o)?Math.pow(Mp*o,2):new hp((function(){return"pow(".concat(Mp," * ").concat(o.signal,", 2)")}))}throw new Error(Jt("size",e))}(i,t,n,r);return Pi(l)?function(e,n,t){var r=function(){var r=Wo(n),i=Wo(e),a="(".concat(r," - ").concat(i,") / (").concat(t," - 1)");return"sequence(".concat(i,", ").concat(r," + ").concat(a,", ").concat(a,")")};return Tr(n)?new hp(r):{signal:r()}}(m,g,function(e,n,t,r){switch(e){case"quantile":return n.scale.quantileCount;case"quantize":return n.scale.quantizeCount;case"threshold":return void 0!==t&&M(t)?t.length+1:(gr(function(e){return"Domain for ".concat(e," is required for threshold scale.")}(r)),3)}}(l,r,s,e)):[m,g];case mn:return[0,2*Math.PI];case Sn:return[0,360];case pn:return[0,new hp((function(){var e=n.getSignalName("width"),t=n.getSignalName("height");return"min(".concat(e,",").concat(t,")/2")}))];case _n:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case zn:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Fn:return"symbol";case wn:case An:case Dn:return"ordinal"===l?"nominal"===u?"category":"ordinal":void 0!==f?"diverging":"rect"===i||"geoshape"===i?"heatmap":"ramp";case En:case Bn:case On:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error("Scale range undefined for channel ".concat(e))}(e,n);return(void 0!==v||void 0!==p)&&Li(a,"rangeMin")&&M(h)&&2===h.length?Gl([null!=v?v:h[0],null!=p?p:h[1]]):Vl(h)}function Pp(e){return function(e){return!Y(e)&&!!e.name}(e)?u({scheme:e.name},oe(e,["name"])):{scheme:e}}function Np(e,n,t){if(n)return Tr(n)?{signal:"".concat(n.signal," ? 0 : ").concat(Np(e,!1,t))}:0;switch(e){case"bar":case"tick":return t.scale.minBandSize;case"line":case"trail":case"rule":return t.scale.minStrokeWidth;case"text":return t.scale.minFontSize;case"point":case"square":case"circle":return t.scale.minSize}throw new Error(Jt("size",e))}var Mp=.95;function Tp(e,n,t){var r=Yu(e.width)?e.width.step:$u(t,"width"),i=Yu(e.height)?e.height.step:$u(t,"height");return n.x||n.y?new hp((function(){var e=[n.x?n.x.signal:r,n.y?n.y.signal:i];return"min(".concat(e.join(", "),")")})):Math.min(r,i)}function Lp(e,n){Vp(e)?function(e,n){var t,r=e.component.scales,i=e.config,a=e.encoding,o=e.markDef,u=e.specifiedScales,l=F(ke(r));try{for(l.s();!(t=l.n()).done;){var c=t.value,s=u[c],f=r[c],d=e.getScaleComponent(c),v=Ao(a[c]),p=s[n],h=d.get("type"),m=d.get("padding"),g=d.get("paddingInner"),y=Li(h,n),b=qi(c,n);if(void 0!==p&&(y?b&&gr(b):gr(nr(h,n,c))),y&&void 0===b)if(void 0!==p){var x=v.timeUnit,k=v.type;switch(n){case"domainMax":case"domainMin":yr(s[n])||"temporal"===k||x?f.set(n,{signal:_o(s[n],{type:k,timeUnit:x})},!0):f.set(n,s[n],!0);break;default:f.copyKeyFromObject(n,s)}}else{var w=n in qp?qp[n]({model:e,channel:c,fieldOrDatumDef:v,scaleType:h,scalePadding:m,scalePaddingInner:g,domain:s.domain,markDef:o,config:i}):i.scale[n];void 0!==w&&f.set(n,w,!1)}}}catch(e){l.e(e)}finally{l.f()}}(e,n):Wp(e,n)}var qp={bins:function(e){var n=e.model,t=e.fieldOrDatumDef;return Ja(t)?function(e,n){var t=n.bin;if(Dt(t)){var r=Ev(e,n.field,t);return new hp((function(){return e.getSignalName(r)}))}if(Ft(t)&&Ct(t)&&void 0!==t.step)return{step:t.step};return}(n,t):void 0},interpolate:function(e){return function(e,n){if(se([wn,An,Dn],e)&&"nominal"!==n)return"hcl";return}(e.channel,e.fieldOrDatumDef.type)},nice:function(e){return function(e,n,t){var r;if((null===(r=wo(t))||void 0===r?void 0:r.bin)||se([pi,hi],e))return;return n in lt||void 0}(e.scaleType,e.channel,e.fieldOrDatumDef)},padding:function(e){var n=e.channel,t=e.scaleType,r=e.fieldOrDatumDef,i=e.markDef,a=e.config;return function(e,n,t,r,i,a){if(e in lt){if(ji(n)){if(void 0!==t.continuousPadding)return t.continuousPadding;var o=i.type,u=i.orient;if("bar"===o&&(!Ja(r)||!r.bin&&!r.timeUnit)&&("vertical"===u&&"x"===e||"horizontal"===u&&"y"===e))return a.continuousBandSize}if(n===bi)return t.pointPadding}return}(n,t,a.scale,r,i,a.bar)},paddingInner:function(e){var n=e.scalePadding,t=e.channel,r=e.markDef,i=e.config;return function(e,n,t,r){if(void 0!==e)return;if(n in lt){var i=r.bandPaddingInner,a=r.barBandPaddingInner,o=r.rectBandPaddingInner;return Me(i,"bar"===t?a:o)}return}(n,t,r.type,i.scale)},paddingOuter:function(e){var n=e.scalePadding,t=e.channel,r=e.scaleType,i=e.markDef,a=e.scalePaddingInner,o=e.config;return function(e,n,t,r,i,a){if(void 0!==e)return;if(n in lt){if(t===xi)return Me(a.bandPaddingOuter,Tr(i)?{signal:"".concat(i.signal,"/2")}:i/2)}return}(n,t,r,i.type,a,o.scale)},reverse:function(e){var n=e.fieldOrDatumDef,t=e.scaleType,r=e.channel,i=e.config;return function(e,n,t,r){if("x"===t&&void 0!==r.xReverse)return zi(e)&&"descending"===n?Tr(r.xReverse)?{signal:"!".concat(r.xReverse.signal)}:!r.xReverse:r.xReverse;if(zi(e)&&"descending"===n)return!0;return}(t,Ja(n)?n.sort:void 0,r,i.scale)},zero:function(e){return function(e,n,t,r,i){if(t&&"unaggregated"!==t&&zi(i)){if(M(t)){var a=t[0],o=t[t.length-1];if(a<=0&&o>=0)return!0}return!1}if("size"===e&&"quantitative"===n.type&&!Pi(i))return!0;if((!Ja(n)||!n.bin)&&se([].concat(b(ct),b(dt)),e)){var u=r.orient;return!se(["bar","area","line","trail"],r.type)||!("horizontal"===u&&"y"===e||"vertical"===u&&"x"===e)}return!1}(e.channel,e.fieldOrDatumDef,e.domain,e.markDef,e.scaleType)}};function Rp(e){Vp(e)?function(e){var n,t=e.component.scales,r=F(gt);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=t[i];if(a){var o=jp(i,e);a.setWithExplicit("range",o)}}}catch(e){r.e(e)}finally{r.f()}}(e):Wp(e,"range")}function Wp(e,n){var t,r=e.component.scales,i=F(e.children);try{for(i.s();!(t=i.n()).done;){var a=t.value;"range"===n?Rp(a):Lp(a,n)}}catch(e){i.e(e)}finally{i.f()}var o,u=F(ke(r));try{for(u.s();!(o=u.n()).done;){var l,c=o.value,s=void 0,f=F(e.children);try{for(f.s();!(l=f.n()).done;){var d=l.value.component.scales[c];if(d)s=Xl(s,d.getWithExplicit(n),n,"scale",Yl((function(e,t){switch(n){case"range":return e.step&&t.step?e.step-t.step:0}return 0})))}}catch(e){f.e(e)}finally{f.f()}r[c].setWithExplicit(n,s)}}catch(e){u.e(e)}finally{u.f()}}function Up(e,n,t,r){var i,a,o=function(e,n,t){var r;switch(n.type){case"nominal":case"ordinal":if(Vn(e)||"discrete"===wt(e))return"shape"===e&&"ordinal"===n.type&&gr(Qt(e,"ordinal")),"ordinal";if(e in lt){if(se(["rect","bar","image","rule"],t))return"band"}else if("arc"===t&&e in ft)return"band";return void 0!==n.band||ro(n)&&(null===(r=n.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return Vn(e)?"time":"discrete"===wt(e)?(gr(Qt(e,"temporal")),"ordinal"):Ja(n)&&n.timeUnit&&Nr(n.timeUnit).utc?"utc":"time";case"quantitative":return Vn(e)?Ja(n)&&Dt(n.bin)?"bin-ordinal":"linear":"discrete"===wt(e)?(gr(Qt(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(It(n.type))}(n,t,r),u=e.type;return yt(n)?void 0!==u?function(e,n){if(!yt(e))return!1;switch(e){case sn:case fn:case mn:case pn:return ji(n)||se(["band","point"],n);case Cn:case _n:case En:case Bn:case On:case Sn:return ji(n)||Pi(n)||se(["band","point","ordinal"],n);case wn:case An:case Dn:return"band"!==n;case zn:return"ordinal"===n||Pi(n);case Fn:return"ordinal"===n}}(n,u)?Ja(t)&&(i=u,a=t.type,!(se([ii,oi],a)?void 0===i||_i(i):a===ai?se([pi,hi,void 0],i):a!==ri||se([si,fi,di,vi,mi,gi,yi,ci,void 0],i)))?(gr(function(e,n){return'FieldDef does not work with "'.concat(e,'" scale. We are using "').concat(n,'" scale instead.')}(u,o)),o):u:(gr(function(e,n,t){return'Channel "'.concat(e,'" does not work with "').concat(n,'" scale. We are using "').concat(t,'" scale instead.')}(n,u,o)),o):o:null}function Ip(e){Vp(e)?e.component.scales=function(e){var n=e.encoding,t=e.mark;return gt.reduce((function(r,i){var a=Ao(n[i]);if(a&&t===ta&&i===Fn&&a.type===ui)return r;var o=a&&a.scale;if(a&&null!==o&&!1!==o){var u,l=Up(o=null!==(u=o)&&void 0!==u?u:{},i,a,t);r[i]=new Bp(e.scaleName(i+"",!0),{value:l,explicit:o.type===l})}return r}),{})}(e):e.component.scales=function(e){var n,t=e.component.scales={},r={},i=e.component.resolve,a=F(e.children);try{for(a.s();!(n=a.n()).done;){var o=n.value;Ip(o);var u,l=F(ke(o.component.scales));try{for(l.s();!(u=l.n()).done;){var c,s=u.value;if(i.scale[s]=null!==(c=i.scale[s])&&void 0!==c?c:rv(s,e),"shared"===i.scale[s]){var f=r[s],d=o.component.scales[s].getWithExplicit("type");f?wi(f.value,d.value)?r[s]=Xl(f,d,"type","scale",Hp):(i.scale[s]="independent",delete r[s]):r[s]=d}}}catch(e){l.e(e)}finally{l.f()}}}catch(e){a.e(e)}finally{a.f()}var v,p=F(ke(r));try{for(p.s();!(v=p.n()).done;){var h=v.value,m=e.scaleName(h,!0),g=r[h];t[h]=new Bp(m,g);var y,b=F(e.children);try{for(b.s();!(y=b.n()).done;){var x=y.value,k=x.component.scales[h];k&&(x.renameScale(k.get("name"),m),k.merged=!0)}}catch(e){b.e(e)}finally{b.f()}}}catch(e){p.e(e)}finally{p.f()}return t}(e)}var Hp=Yl((function(e,n){return Di(e)-Di(n)}));var Gp=function(){function e(){t(this,e),a(this,"nameMap",void 0),this.nameMap={}}return i(e,[{key:"rename",value:function(e,n){this.nameMap[e]=n}},{key:"has",value:function(e){return void 0!==this.nameMap[e]}},{key:"get",value:function(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}]),e}();function Vp(e){return"unit"===(null==e?void 0:e.type)}function Yp(e){return"facet"===(null==e?void 0:e.type)}function Jp(e){return"concat"===(null==e?void 0:e.type)}function Xp(e){return"layer"===(null==e?void 0:e.type)}var Qp=function(){function e(n,r,i,o,l,c,s){var f,d,v=this;t(this,e),this.type=r,this.parent=i,this.config=l,a(this,"name",void 0),a(this,"size",void 0),a(this,"title",void 0),a(this,"description",void 0),a(this,"data",void 0),a(this,"transforms",void 0),a(this,"layout",void 0),a(this,"scaleNameMap",void 0),a(this,"projectionNameMap",void 0),a(this,"signalNameMap",void 0),a(this,"component",void 0),a(this,"view",void 0),a(this,"children",[]),a(this,"correctDataNames",(function(e){return e.from&&e.from.data&&(e.from.data=v.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=v.lookupDataSource(e.from.facet.data)),e})),this.parent=i,this.config=l,this.view=Wi(s),this.name=null!==(f=n.name)&&void 0!==f?f:o,this.title=No(n.title)?{text:n.title}:n.title?this.initTitle(n.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new Gp,this.projectionNameMap=i?i.projectionNameMap:new Gp,this.signalNameMap=i?i.signalNameMap:new Gp,this.data=n.data,this.description=n.description,this.transforms=(null!==(d=n.transform)&&void 0!==d?d:[]).map((function(e){return ac(e)?{filter:te(e.filter,ti)}:e})),this.layout="layer"===r||"unit"===r?{}:function(e,n,t){var r=t[n],i={},a=r.spacing,o=r.columns;void 0!==a&&(i.spacing=a),void 0!==o&&(Ra(e)&&!La(e.facet)||Uu(e))&&(i.columns=o),Iu(e)&&(i.columns=1);var u,l=F(Xu);try{for(l.s();!(u=l.n()).done;){var c=u.value;if(void 0!==e[c])if("spacing"===c){var s,f,d=e[c];i[c]=V(d)?d:{row:null!==(s=d.row)&&void 0!==s?s:a,column:null!==(f=d.column)&&void 0!==f?f:a}}else i[c]=e[c]}}catch(e){l.e(e)}finally{l.f()}return i}(n,r,l),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:Ra(n)||i&&i.component.data.isFaceted&&void 0===n.data},layoutSize:new Hl,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:u({scale:{},axis:{},legend:{}},c?ie(c):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}return i(e,[{key:"initTitle",value:function(e){var n,t=ke(e),r={text:To(e.text)},i=F(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r[a]=To(e[a])}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"parse",value:function(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}},{key:"parseScale",value:function(){!function(e){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ignoreRange;Ip(e),mp(e);var t,r=F(Ti);try{for(r.s();!(t=r.n()).done;){Lp(e,t.value)}}catch(e){r.e(e)}finally{r.f()}n||Rp(e)}(this)}},{key:"parseProjection",value:function(){Cv(this)}},{key:"renameTopLevelLayoutSizeSignal",value:function(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}},{key:"parseLegends",value:function(){gv(this)}},{key:"assembleGroupStyle",value:function(){var e,n;if("unit"===this.type||"layer"===this.type)return null!==(e=null===(n=this.view)||void 0===n?void 0:n.style)&&void 0!==e?e:"cell"}},{key:"assembleEncodeFromView",value:function(e){e.style;var n,t=v(e,["style"]),r={},i=F(ke(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,o=t[a];void 0!==o&&(r[a]=qo(o))}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"assembleGroupEncodeEntry",value:function(e){var n,t={};if((this.view&&(t=this.assembleEncodeFromView(this.view)),!e)&&(this.description&&(t.description=qo(this.description)),"unit"===this.type||"layer"===this.type))return u({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!==(n=t)&&void 0!==n?n:{});return xe(t)?void 0:t}},{key:"assembleLayout",value:function(){if(this.layout){var e=this.layout,n=e.spacing,t=v(e,["spacing"]),r=this.component,i=this.config,a=function(e,n){var t,r={},i=F(Jn);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=e[a];if(null==o?void 0:o.facetFieldDef){var u=Ld(["titleAnchor","titleOrient"],o.facetFieldDef.header,n,a),l=u.titleAnchor,c=Md(a,u.titleOrient),s=Xd(l,c);void 0!==s&&(r[c]=s)}}}catch(e){i.e(e)}finally{i.f()}return xe(r)?void 0:r}(r.layoutHeaders,i);return u(u(u({padding:n},this.assembleDefaultLayout()),t),a?{titleBand:a}:{})}}},{key:"assembleDefaultLayout",value:function(){return{}}},{key:"assembleHeaderMarks",value:function(){var e,n=this.component.layoutHeaders,t=[],r=F(Jn);try{for(r.s();!(e=r.n()).done;){var i=e.value;n[i].title&&t.push(Wd(this,i))}}catch(e){r.e(e)}finally{r.f()}var a,o=F(qd);try{for(o.s();!(a=o.n()).done;){var u=a.value;t=t.concat(Hd(this,u))}}catch(e){o.e(e)}finally{o.f()}return t}},{key:"assembleAxes",value:function(){return e=this.component.axes,n=this.config,t=e.x,r=void 0===t?[]:t,i=e.y,a=void 0===i?[]:i,[].concat(b(r.map((function(e){return Ad(e,"grid",n)}))),b(a.map((function(e){return Ad(e,"grid",n)}))),b(r.map((function(e){return Ad(e,"main",n)}))),b(a.map((function(e){return Ad(e,"main",n)})))).filter((function(e){return e}));var e,n,t,r,i,a}},{key:"assembleLegends",value:function(){return kv(this)}},{key:"assembleProjections",value:function(){return wv(this)}},{key:"assembleTitle",value:function(){var e,n=null!==(e=this.title)&&void 0!==e?e:{},t=n.encoding,r=v(n,["encoding"]),i=u(u(u({},Po(this.config.title).nonMark),r),t?{encode:{update:t}}:{});if(i.text){var a,o;if(se(["unit","layer"],this.type)){if(se(["middle",void 0],i.anchor))i.frame=null!==(a=i.frame)&&void 0!==a?a:"group"}else i.anchor=null!==(o=i.anchor)&&void 0!==o?o:"start";return xe(i)?void 0:i}}},{key:"assembleGroup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n={};(e=e.concat(this.assembleSignals())).length>0&&(n.signals=e);var t=this.assembleLayout();t&&(n.layout=t),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var r=!this.parent||Yp(this.parent)?Sp(this):[];r.length>0&&(n.scales=r);var i=this.assembleAxes();i.length>0&&(n.axes=i);var a=this.assembleLegends();return a.length>0&&(n.legends=a),n}},{key:"getName",value:function(e){return Fe((this.name?this.name+"_":"")+e)}},{key:"getDataName",value:function(e){return this.getName(Ql[e].toLowerCase())}},{key:"requestDataName",value:function(e){var n=this.getDataName(e),t=this.component.data.outputNodeRefCounts;return t[n]=(t[n]||0)+1,n}},{key:"getSizeSignalRef",value:function(e){if(Yp(this.parent)){var n=vt(nv(e)),t=this.component.scales[n];if(t&&!t.merged){var r=t.get("type"),i=t.get("range");if(_i(r)&&Lr(i)){var a=t.get("name"),o=Fp(Cp(this,n));return o?{signal:ev(a,t,lo({aggregate:"distinct",field:o},{expr:"datum"}))}:(gr(Pt(n)),null)}}}return{signal:this.signalNameMap.get(this.getName(e))}}},{key:"lookupDataSource",value:function(e){var n=this.component.data.outputNodes[e];return n?n.getSource():e}},{key:"getSignalName",value:function(e){return this.signalNameMap.get(e)}},{key:"renameSignal",value:function(e,n){this.signalNameMap.rename(e,n)}},{key:"renameScale",value:function(e,n){this.scaleNameMap.rename(e,n)}},{key:"renameProjection",value:function(e,n){this.projectionNameMap.rename(e,n)}},{key:"scaleName",value:function(e,n){return n?this.getName(e):Zn(e)&&yt(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}},{key:"projectionName",value:function(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}},{key:"getScaleComponent",value:function(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");var n=this.component.scales[e];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(e):void 0}},{key:"getSelectionComponent",value:function(e,n){var t=this.component.selection[e];if(!t&&this.parent&&(t=this.parent.getSelectionComponent(e,n)),!t)throw new Error('Cannot find a selection named "'.concat(n,'".'));return t}},{key:"hasAxisOrientSignalRef",value:function(){var e,n;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some((function(e){return e.hasOrientSignalRef()})))||(null===(n=this.component.axes.y)||void 0===n?void 0:n.some((function(e){return e.hasOrientSignalRef()})))}},{key:"width",get:function(){return this.getSizeSignalRef("width")}},{key:"height",get:function(){return this.getSizeSignalRef("height")}}]),e}(),$p=function(e){l(r,e);var n=m(r);function r(){return t(this,r),n.apply(this,arguments)}return i(r,[{key:"vgField",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=this.fieldDef(e);if(t)return lo(t,n)}},{key:"reduceFieldDef",value:function(e,n){return function(e,n,t,r){return e?ke(e).reduce((function(t,i){var a=e[i];return M(a)?a.reduce((function(e,t){return n.call(r,e,t,i)}),t):n.call(r,t,a,i)}),t):t}(this.getMapping(),(function(n,t,r){var i=wo(t);return i?e(n,i,r):n}),n)}},{key:"forEachFieldDef",value:function(e,n){au(this.getMapping(),(function(n,t){var r=wo(n);r&&e(r,t)}),n)}}]),r}(Qp),Kp=function(e){l(r,e);var n=m(r);function r(e,i){var a,o,u,l;t(this,r),(l=n.call(this,e)).transform=i,l.transform=ie(i);var c=null!==(a=l.transform.as)&&void 0!==a?a:[void 0,void 0];return l.transform.as=[null!==(o=c[0])&&void 0!==o?o:"value",null!==(u=c[1])&&void 0!==u?u:"density"],l}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.transform))}}]),i(r,[{key:"dependentFields",value:function(){var e;return new Set([this.transform.density].concat(b(null!==(e=this.transform.groupby)&&void 0!==e?e:[])))}},{key:"producedFields",value:function(){return new Set(this.transform.as)}},{key:"hash",value:function(){return"DensityTransform ".concat(le(this.transform))}},{key:"assemble",value:function(){var e=this.transform;return u({type:"kde",field:e.density},v(e,["density"]))}}]),r}(us),Zp=function(e){l(r,e);var n=m(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e)).filter=i,a}return i(r,[{key:"clone",value:function(){return new r(null,u({},this.filter))}}]),i(r,[{key:"dependentFields",value:function(){return new Set(ke(this.filter))}},{key:"producedFields",value:function(){return new Set}},{key:"hash",value:function(){return"FilterInvalid ".concat(le(this.filter))}},{key:"assemble",value:function(){var e=this,n=ke(this.filter).reduce((function(n,t){var r=e.filter[t],i=lo(r,{expr:"datum"});return null!==r&&("temporal"===r.type?n.push("(isDate(".concat(i,") || (isValid(").concat(i,") && isFinite(+").concat(i,")))")):"quantitative"===r.type&&(n.push("isValid(".concat(i,")")),n.push("isFinite(+".concat(i,")")))),n}),[]);return n.length>0?{type:"filter",expr:n.join(" && ")}:null}}],[{key:"make",value:function(e,n){var t=n.config,i=n.mark;if("filter"!==Io("invalid",n.markDef,t))return null;var a=n.reduceFieldDef((function(e,t,r){var a=yt(r)&&n.getScaleComponent(r);a&&(zi(a.get("type"))&&"count"!==t.aggregate&&!ra(i)&&(e[t.field]=t));return e}),{});return ke(a).length?new r(e,a):null}}]),r}(us),eh=function(e){l(r,e);var n=m(r);function r(e,i){var a;t(this,r),(a=n.call(this,e)).transform=i,a.transform=ie(i);var o=a.transform,u=o.flatten,l=o.as,c=void 0===l?[]:l;return a.transform.as=u.map((function(e,n){var t;return null!==(t=c[n])&&void 0!==t?t:e})),a}return i(r,[{key:"clone",value:function(){return new r(this.parent,ie(this.transform))}}]),i(r,[{key:"dependentFields",value:function(){return new Set(this.transform.flatten)}},{key:"producedFields",value:function(){return new Set(this.transform.as)}},{key:"hash",value:function(){return"FlattenTransform ".concat(le(this.transform))}},{key:"assemble",value:function(){var e=this.transform;return{type:"flatten",fields:e.flatten,as:e.as}}}]),r}(us),nh=function(e){l(r,e);var n=m(r);function r(e,i){var a,o,u,l;t(this,r),(l=n.call(this,e)).transform=i,l.transform=ie(i);var c=null!==(a=l.transform.as)&&void 0!==a?a:[void 0,void 0];return l.transform.as=[null!==(o=c[0])&&void 0!==o?o:"key",null!==(u=c[1])&&void 0!==u?u:"value"],l}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.transform))}}]),i(r,[{key:"dependentFields",value:function(){return new Set(this.transform.fold)}},{key:"producedFields",value:function(){return new Set(this.transform.as)}},{key:"hash",value:function(){return"FoldTransform ".concat(le(this.transform))}},{key:"assemble",value:function(){var e=this.transform;return{type:"fold",fields:e.fold,as:e.as}}}]),r}(us),th=function(e){l(r,e);var n=m(r);function r(e,i,a,o){var u;return t(this,r),(u=n.call(this,e)).fields=i,u.geojson=a,u.signal=o,u}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.fields),this.geojson,this.signal)}}],[{key:"parseAll",value:function(e,n){if(n.component.projection&&!n.component.projection.isFit)return e;var t,i=0,a=F([[bn,yn],[kn,xn]]);try{for(a.s();!(t=a.n()).done;){var o=t.value.map((function(e){var t=Ao(n.encoding[e]);return Ja(t)?t.field:Qa(t)?{expr:"".concat(t.datum)}:no(t)?{expr:"".concat(t.value)}:void 0}));(o[0]||o[1])&&(e=new r(e,o,null,n.getName("geojson_".concat(i++))))}}catch(e){a.e(e)}finally{a.f()}if(n.channelHasField(Fn)){var u=n.typedFieldDef(Fn);u.type===ui&&(e=new r(e,null,u.field,n.getName("geojson_".concat(i++))))}return e}}]),i(r,[{key:"dependentFields",value:function(){var e,n=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(Y);return new Set([].concat(b(this.geojson?[this.geojson]:[]),b(n)))}},{key:"producedFields",value:function(){return new Set}},{key:"hash",value:function(){return"GeoJSON ".concat(this.geojson," ").concat(this.signal," ").concat(le(this.fields))}},{key:"assemble",value:function(){return u(u(u({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{},{signal:this.signal})}}]),r}(us),rh=function(e){l(r,e);var n=m(r);function r(e,i,a,o){var u;return t(this,r),(u=n.call(this,e)).projection=i,u.fields=a,u.as=o,u}return i(r,[{key:"clone",value:function(){return new r(null,this.projection,ie(this.fields),ie(this.as))}}]),i(r,[{key:"dependentFields",value:function(){return new Set(this.fields.filter(Y))}},{key:"producedFields",value:function(){return new Set(this.as)}},{key:"hash",value:function(){return"Geopoint ".concat(this.projection," ").concat(le(this.fields)," ").concat(le(this.as))}},{key:"assemble",value:function(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}],[{key:"parseAll",value:function(e,n){if(!n.projectionName())return e;var t,i=F([[bn,yn],[kn,xn]]);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.map((function(e){var t=Ao(n.encoding[e]);return Ja(t)?t.field:Qa(t)?{expr:"".concat(t.datum)}:no(t)?{expr:"".concat(t.value)}:void 0})),u=a[0]===kn?"2":"";(o[0]||o[1])&&(e=new r(e,n.projectionName(),o,[n.getName("x"+u),n.getName("y"+u)]))}}catch(e){i.e(e)}finally{i.f()}return e}}]),r}(us),ih=function(e){l(r,e);var n=m(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e)).transform=i,a}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.transform))}}]),i(r,[{key:"dependentFields",value:function(){var e;return new Set([this.transform.impute,this.transform.key].concat(b(null!==(e=this.transform.groupby)&&void 0!==e?e:[])))}},{key:"producedFields",value:function(){return new Set([this.transform.impute])}},{key:"processSequence",value:function(e){var n=e.start,t=void 0===n?0:n,r=e.stop,i=e.step,a=[t,r].concat(b(i?[i]:[])).join(",");return{signal:"sequence(".concat(a,")")}}},{key:"hash",value:function(){return"Impute ".concat(le(this.transform))}},{key:"assemble",value:function(){var e,n=this.transform,t=n.impute,r=n.key,i=n.keyvals,a=n.method,o=n.groupby,l=n.value,c=n.frame,s=void 0===c?[null,null]:c,f=u(u(u({type:"impute",field:t,key:r},i?{keyvals:(e=i,void 0!==(null==e?void 0:e.stop)?this.processSequence(i):i)}:{}),{},{method:"value"},o?{groupby:o}:{}),{},{value:a&&"value"!==a?null:l});return a&&"value"!==a?[f,u({type:"window",as:["imputed_".concat(t,"_value")],ops:[a],fields:[t],frame:s,ignorePeers:!1},o?{groupby:o}:{}),{type:"formula",expr:"datum.".concat(t," === null ? datum.imputed_").concat(t,"_value : datum.").concat(t),as:t}]:[f]}}],[{key:"makeFromTransform",value:function(e,n){return new r(e,n)}},{key:"makeFromEncoding",value:function(e,n){var t=n.encoding,i=t.x,a=t.y;if(Ja(i)&&Ja(a)){var o=i.impute?i:a.impute?a:void 0;if(void 0===o)return;var l=i.impute?a:a.impute?i:void 0,c=o.impute,s=c.method,f=c.value,d=c.frame,v=c.keyvals,p=ou(n.mark,t);return new r(e,u(u(u(u(u({impute:o.field,key:l.field},s?{method:s}:{}),void 0!==f?{value:f}:{}),d?{frame:d}:{}),void 0!==v?{keyvals:v}:{}),p.length?{groupby:p}:{}))}return null}}]),r}(us),ah=function(e){l(r,e);var n=m(r);function r(e,i){var a,o,u,l;t(this,r),(l=n.call(this,e)).transform=i,l.transform=ie(i);var c=null!==(a=l.transform.as)&&void 0!==a?a:[void 0,void 0];return l.transform.as=[null!==(o=c[0])&&void 0!==o?o:i.on,null!==(u=c[1])&&void 0!==u?u:i.loess],l}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.transform))}}]),i(r,[{key:"dependentFields",value:function(){var e;return new Set([this.transform.loess,this.transform.on].concat(b(null!==(e=this.transform.groupby)&&void 0!==e?e:[])))}},{key:"producedFields",value:function(){return new Set(this.transform.as)}},{key:"hash",value:function(){return"LoessTransform ".concat(le(this.transform))}},{key:"assemble",value:function(){var e=this.transform,n=e.loess;return u({type:"loess",x:e.on,y:n},v(e,["loess","on"]))}}]),r}(us),oh=function(e){l(r,e);var n=m(r);function r(e,i,a){var o;return t(this,r),(o=n.call(this,e)).transform=i,o.secondary=a,o}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.transform),this.secondary)}}]),i(r,[{key:"dependentFields",value:function(){return new Set([this.transform.lookup])}},{key:"producedFields",value:function(){return new Set(this.transform.as?U(this.transform.as):this.transform.from.fields)}},{key:"hash",value:function(){return"Lookup ".concat(le({transform:this.transform,secondary:this.secondary}))}},{key:"assemble",value:function(){var e;if(this.transform.from.fields)e=u({values:this.transform.from.fields},this.transform.as?{as:U(this.transform.as)}:{});else{var n=this.transform.as;Y(n)||(gr('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),n="_lookup"),e={as:[n]}}return u(u({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}],[{key:"make",value:function(e,n,t,i){var a=n.component.data.sources,o=t.from,l=null;if(function(e){return"data"in e}(o)){var c=wh(o.data,a);c||(c=new Uv(o.data),a.push(c));var s=n.getName("lookup_".concat(i));l=new ls(c,s,Ql.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[s]=l}else if(function(e){return"selection"in e}(o)){var f=o.selection;if(t=u({as:f},t),!(l=n.getSelectionComponent(Fe(f),f).materialized))throw new Error('Cannot define and lookup the "'.concat(f,'" selection in the same view. ')+"Try moving the lookup into a second, layered view?")}return new r(e,t,l.getSource())}}]),r}(us),uh=function(e){l(r,e);var n=m(r);function r(e,i){var a,o,u,l;t(this,r),(l=n.call(this,e)).transform=i,l.transform=ie(i);var c=null!==(a=l.transform.as)&&void 0!==a?a:[void 0,void 0];return l.transform.as=[null!==(o=c[0])&&void 0!==o?o:"prob",null!==(u=c[1])&&void 0!==u?u:"value"],l}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.transform))}}]),i(r,[{key:"dependentFields",value:function(){var e;return new Set([this.transform.quantile].concat(b(null!==(e=this.transform.groupby)&&void 0!==e?e:[])))}},{key:"producedFields",value:function(){return new Set(this.transform.as)}},{key:"hash",value:function(){return"QuantileTransform ".concat(le(this.transform))}},{key:"assemble",value:function(){var e=this.transform;return u({type:"quantile",field:e.quantile},v(e,["quantile"]))}}]),r}(us),lh=function(e){l(r,e);var n=m(r);function r(e,i){var a,o,u,l;t(this,r),(l=n.call(this,e)).transform=i,l.transform=ie(i);var c=null!==(a=l.transform.as)&&void 0!==a?a:[void 0,void 0];return l.transform.as=[null!==(o=c[0])&&void 0!==o?o:i.on,null!==(u=c[1])&&void 0!==u?u:i.regression],l}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.transform))}}]),i(r,[{key:"dependentFields",value:function(){var e;return new Set([this.transform.regression,this.transform.on].concat(b(null!==(e=this.transform.groupby)&&void 0!==e?e:[])))}},{key:"producedFields",value:function(){return new Set(this.transform.as)}},{key:"hash",value:function(){return"RegressionTransform ".concat(le(this.transform))}},{key:"assemble",value:function(){var e=this.transform,n=e.regression;return u({type:"regression",x:e.on,y:n},v(e,["regression","on"]))}}]),r}(us),ch=function(e){l(r,e);var n=m(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e)).transform=i,a}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.transform))}}]),i(r,[{key:"addDimensions",value:function(e){var n;this.transform.groupby=he((null!==(n=this.transform.groupby)&&void 0!==n?n:[]).concat(e),(function(e){return e}))}},{key:"producedFields",value:function(){}},{key:"dependentFields",value:function(){var e;return new Set([this.transform.pivot,this.transform.value].concat(b(null!==(e=this.transform.groupby)&&void 0!==e?e:[])))}},{key:"hash",value:function(){return"PivotTransform ".concat(le(this.transform))}},{key:"assemble",value:function(){var e=this.transform,n=e.pivot,t=e.value,r=e.groupby,i=e.limit,a=e.op;return u(u(u({type:"pivot",field:n,value:t},void 0!==i?{limit:i}:{}),void 0!==a?{op:a}:{}),void 0!==r?{groupby:r}:{})}}]),r}(us),sh=function(e){l(r,e);var n=m(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e)).transform=i,a}return i(r,[{key:"clone",value:function(){return new r(null,ie(this.transform))}}]),i(r,[{key:"dependentFields",value:function(){return new Set}},{key:"producedFields",value:function(){return new Set}},{key:"hash",value:function(){return"SampleTransform ".concat(le(this.transform))}},{key:"assemble",value:function(){return{type:"sample",size:this.transform.sample}}}]),r}(us);function fh(e){var n=0;return function t(r,i){var a,o,l;if(r instanceof Uv&&(r.isGenerator||Kl(r.data)||(e.push(i),i={name:null,source:i.name,transform:[]})),r instanceof Lv&&(r.parent instanceof Uv&&!i.source?(i.format=u(u({},null!==(a=i.format)&&void 0!==a?a:{}),{},{parse:r.assembleFormatParse()}),(o=i.transform).push.apply(o,b(r.assembleTransforms(!0)))):(l=i.transform).push.apply(l,b(r.assembleTransforms()))),r instanceof jv){i.name||(i.name="data_".concat(n++)),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;var c,s=F(r.assemble());try{for(s.s();!(c=s.n()).done;){var f=c.value;e.push(f)}}catch(e){s.e(e)}finally{s.f()}}else{var d;if((r instanceof Rv||r instanceof Wv||r instanceof Zp||r instanceof gd||r instanceof Pd||r instanceof rh||r instanceof th||r instanceof zv||r instanceof oh||r instanceof up||r instanceof ap||r instanceof nh||r instanceof eh||r instanceof Kp||r instanceof ah||r instanceof uh||r instanceof lh||r instanceof qv||r instanceof sh||r instanceof ch)&&i.transform.push(r.assemble()),r instanceof Ov||r instanceof cs||r instanceof ih||r instanceof op)(d=i.transform).push.apply(d,b(r.assemble()));if(r instanceof ls)if(i.source&&0===i.transform.length)r.setSource(i.source);else if(r.parent instanceof ls)r.setSource(i.name);else{if(i.name||(i.name="data_".concat(n++)),r.setSource(i.name),1===r.numChildren())e.push(i),i={name:null,source:i.name,transform:[]}}switch(r.numChildren()){case 0:r instanceof ls&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:t(r.children[0],i);break;default:i.name||(i.name="data_".concat(n++));var v=i.name;!i.source||i.transform.length>0?e.push(i):v=i.source;var p,h=F(r.children);try{for(h.s();!(p=h.n()).done;){t(p.value,{name:null,source:v,transform:[]})}}catch(e){h.e(e)}finally{h.f()}}}}}function dh(e,n){var t,r=[],i=fh(r),a=0,o=F(e.sources);try{for(o.s();!(t=o.n()).done;){var u=t.value;u.hasName()||(u.dataName="source_".concat(a++));var l=u.assemble();i(u,l)}}catch(e){o.e(e)}finally{o.f()}for(var c=0,s=r;c<s.length;c++){var f=s[c];0===f.transform.length&&delete f.transform}var d,v=0,p=F(r.entries());try{for(p.s();!(d=p.n()).done;){var h,m=y(d.value,2),g=m[0],b=m[1];0!==(null!==(h=b.transform)&&void 0!==h?h:[]).length||b.source||r.splice(v++,0,r.splice(g,1)[0])}}catch(e){p.e(e)}finally{p.f()}for(var x=0,k=r;x<k.length;x++){var w,A,D=F(null!==(w=k[x].transform)&&void 0!==w?w:[]);try{for(D.s();!(A=D.n()).done;){var C=A.value;"lookup"===C.type&&(C.from=e.outputNodes[C.from].getSource())}}catch(e){D.e(e)}finally{D.f()}}for(var S=0,E=r;S<E.length;S++){var B=E[S];B.name in n&&(B.values=n[B.name])}return r}function vh(e){return"top"===e||"left"===e||Tr(e)?"header":"footer"}function ph(e,n){var t=e.facet,r=e.config,i=e.child,o=e.component;if(e.channelHasField(n)){var u,l=t[n],c=Td("title",null,r,n),s=go(l,r,{allowDisabling:!0,includeDefault:void 0===c||!!c});i.component.layoutHeaders[n].title&&(s=M(s)?s.join(", "):s,s+=" / "+i.component.layoutHeaders[n].title,i.component.layoutHeaders[n].title=null);var f=Td("labelOrient",l,r,n),d=Me((null!==(u=l.header)&&void 0!==u?u:{}).labels,r.header.labels,!0),v=se(["bottom","right"],f)?"footer":"header";o.layoutHeaders[n]=a({title:s,facetFieldDef:l},v,"facet"===n?[]:[hh(e,n,d)])}}function hh(e,n,t){var r="row"===n?"height":"width";return{labels:t,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function mh(e,n){var t=e.child;if(t.component.axes[n]){var r=e.component,i=r.layoutHeaders,a=r.resolve;if(a.axis[n]=iv(a,n),"shared"===a.axis[n]){var o,u="x"===n?"column":"row",l=i[u],c=F(t.component.axes[n]);try{for(c.s();!(o=c.n()).done;){var s,f=o.value,d=vh(f.get("orient"));l[d]=null!==(s=l[d])&&void 0!==s?s:[hh(e,u,!1)];var v=Ad(f,"main",e.config,{header:!0});v&&l[d][0].axes.push(v),f.mainExtracted=!0}}catch(e){c.e(e)}finally{c.f()}}}}function gh(e){var n,t=F(e.children);try{for(t.s();!(n=t.n()).done;){n.value.parseLayoutSize()}}catch(e){t.e(e)}finally{t.f()}}function yh(e,n){var t,r,i=nv(n),a=vt(i),o=e.component.resolve,u=e.component.layoutSize,l=F(e.children);try{for(l.s();!(r=l.n()).done;){var c=r.value.component.layoutSize.getWithExplicit(i),s=o.scale[a];if("independent"===s&&"step"===c.value){t=void 0;break}if(t){if("independent"===s&&t.value!==c.value){t=void 0;break}t=Xl(t,c,i,"")}else t=c}}catch(e){l.e(e)}finally{l.f()}if(t){var f,d=F(e.children);try{for(d.s();!(f=d.n()).done;){var v=f.value;e.renameSignal(v.getName(i),e.getName(n)),v.component.layoutSize.set(i,"merged",!1)}}catch(e){d.e(e)}finally{d.f()}u.setWithExplicit(n,t)}else u.setWithExplicit(n,{explicit:!1,value:void 0})}function bh(e,n){var t="width"===n?"x":"y",r=e.config,i=e.getScaleComponent(t);if(i){var a=i.get("type"),o=i.get("range");if(_i(a)){var u=Ku(r.view,n);return Lr(o)||Yu(u)?"step":u}return Qu(r.view,n)}if(e.hasProjection||"arc"===e.mark)return Qu(r.view,n);var l=Ku(r.view,n);return Yu(l)?l.step:l}function xh(e,n,t){return lo(n,u({suffix:"by_".concat(lo(e))},null!=t?t:{}))}var kh=function(e){l(r,e);var n=m(r);function r(e,i,o,u){var l;return t(this,r),a(p(l=n.call(this,e,"facet",i,o,u,e.resolve)),"facet",void 0),a(p(l),"child",void 0),a(p(l),"children",void 0),l.child=Qh(e.spec,p(l),l.getName("child"),void 0,u),l.children=[l.child],l.facet=l.initFacet(e.facet),l}return i(r,[{key:"initFacet",value:function(e){if(!La(e))return{facet:this.initFacetFieldDef(e,"facet")};var n,t={},r=F(ke(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!se([un,ln],i)){gr(Jt(i,"facet"));break}var a=e[i];if(void 0===a.field){gr(Yt(a,i));break}t[i]=this.initFacetFieldDef(a,i)}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"initFacetFieldDef",value:function(e,n){var t=e.header,r=Co(v(e,["header"]),n);return t&&(r.header=Wi(t)),r}},{key:"channelHasField",value:function(e){return!!this.facet[e]}},{key:"fieldDef",value:function(e){return this.facet[e]}},{key:"parseData",value:function(){this.component.data=Ah(this),this.child.parseData()}},{key:"parseLayoutSize",value:function(){gh(this)}},{key:"parseSelections",value:function(){this.child.parseSelections(),this.component.selection=this.child.component.selection}},{key:"parseMarkGroup",value:function(){this.child.parseMarkGroup()}},{key:"parseAxesAndHeaders",value:function(){this.child.parseAxesAndHeaders(),function(e){var n,t=F(Jn);try{for(t.s();!(n=t.n()).done;)ph(e,n.value)}catch(e){t.e(e)}finally{t.f()}mh(e,"x"),mh(e,"y")}(this)}},{key:"assembleSelectionTopLevelSignals",value:function(e){return this.child.assembleSelectionTopLevelSignals(e)}},{key:"assembleSignals",value:function(){return this.child.assembleSignals(),[]}},{key:"assembleSelectionData",value:function(e){return this.child.assembleSelectionData(e)}},{key:"getHeaderLayoutMixins",value:function(){var e,n={},t=F(Jn);try{for(t.s();!(e=t.n()).done;){var r,i=e.value,a=F(Rd);try{for(a.s();!(r=a.n()).done;){var o=r.value,u=this.component.layoutHeaders[i],l=u[o],c=u.facetFieldDef;if(c){var s=Td("titleOrient",c.header,this.config,i);if(se(["right","bottom"],s)){var f,d=Md(i,s);n.titleAnchor=null!==(f=n.titleAnchor)&&void 0!==f?f:{},n.titleAnchor[d]="end"}}if(null==l?void 0:l[0]){var v,p,h="row"===i?"height":"width",m="header"===o?"headerBand":"footerBand";if("facet"!==i&&!this.child.component.layoutSize.get(h))n[m]=null!==(v=n[m])&&void 0!==v?v:{},n[m][i]=.5;if(u.title)n.offset=null!==(p=n.offset)&&void 0!==p?p:{},n.offset["row"===i?"rowTitle":"columnTitle"]=10}}}catch(e){a.e(e)}finally{a.f()}}}catch(e){t.e(e)}finally{t.f()}return n}},{key:"assembleDefaultLayout",value:function(){var e=this.facet,n=e.column,t=e.row,r=n?this.columnDistinctSignal():t?1:void 0,i="all";return(t||"independent"!==this.component.resolve.scale.x)&&(n||"independent"!==this.component.resolve.scale.y)||(i="none"),u(u(u({},this.getHeaderLayoutMixins()),r?{columns:r}:{}),{},{bounds:"full",align:i})}},{key:"assembleLayoutSignals",value:function(){return this.child.assembleLayoutSignals()}},{key:"columnDistinctSignal",value:function(){if(!(this.parent&&this.parent instanceof r)){var e=this.getName("column_domain");return{signal:"length(data('".concat(e,"'))")}}}},{key:"assembleGroup",value:function(e){return this.parent&&this.parent instanceof r?u(u({},this.channelHasField("column")?{encode:{update:{columns:{field:lo(this.facet.column,{prefix:"distinct"})}}}}:{}),g(c(r.prototype),"assembleGroup",this).call(this,e)):g(c(r.prototype),"assembleGroup",this).call(this,e)}},{key:"getCardinalityAggregateForChild",value:function(){var e=[],n=[],t=[];if(this.child instanceof r){if(this.child.channelHasField("column")){var i=lo(this.child.facet.column);e.push(i),n.push("distinct"),t.push("distinct_".concat(i))}}else{var a,o=F(ct);try{for(o.s();!(a=o.n()).done;){var u=a.value,l=this.child.component.scales[u];if(l&&!l.merged){var c=l.get("type"),s=l.get("range");if(_i(c)&&Lr(s)){var f=Fp(Cp(this.child,u));f?(e.push(f),n.push("distinct"),t.push("distinct_".concat(f))):gr(Pt(u))}}}}catch(e){o.e(e)}finally{o.f()}}return{fields:e,ops:n,as:t}}},{key:"assembleFacet",value:function(){var e,n=this.component.data.facetRoot,t=n.name,r=n.data,i=this.facet,a=i.row,o=i.column,l=this.getCardinalityAggregateForChild(),c=l.fields,s=l.ops,f=l.as,d=[],v=F(Jn);try{for(v.s();!(e=v.n()).done;){var p=e.value,h=this.facet[p];if(h){d.push(lo(h));var m=h.bin,g=h.sort;if(Dt(m)&&d.push(lo(h,{binSuffix:"end"})),Ma(g)){var y=g.field,b=g.op,x=void 0===b?za:b,k=xh(h,g);a&&o?(c.push(k),s.push("max"),f.push(k)):(c.push(y),s.push(x),f.push(k))}else if(M(g)){var w=Nd(h,p);c.push(w),s.push("max"),f.push(w)}}}}catch(e){v.e(e)}finally{v.f()}var A=!!a&&!!o;return u({name:t,data:r,groupby:d},A||c.length>0?{aggregate:u(u({},A?{cross:A}:{}),c.length?{fields:c,ops:s,as:f}:{})}:{})}},{key:"facetSortFields",value:function(e){var n=this.facet[e];return n?Ma(n.sort)?[xh(n,n.sort,{expr:"datum"})]:M(n.sort)?[Nd(n,e,{expr:"datum"})]:[lo(n,{expr:"datum"})]:[]}},{key:"facetSortOrder",value:function(e){var n=this.facet[e];if(n){var t=n.sort;return[(Ma(t)?t.order:!M(t)&&t)||"ascending"]}return[]}},{key:"assembleLabelTitle",value:function(){var e=this.facet,n=this.config;if(e.facet)return Vd(e.facet,"facet",n);var t,r={row:["top","bottom"],column:["left","right"]},i=F(qd);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(e[a]){var o,u=Td("labelOrient",null===(o=e[a])||void 0===o?void 0:o.header,n,a);if(se(r[a],u))return Vd(e[a],a,n)}}}catch(e){i.e(e)}finally{i.f()}}},{key:"assembleMarks",value:function(){var e=this,n=this.child,t=function(e){var n,t=[],r=fh(t),i=F(e.children);try{for(i.s();!(n=i.n()).done;)r(n.value,{source:e.name,name:null,transform:[]})}catch(e){i.e(e)}finally{i.f()}return t}(this.component.data.facetRoot),r=n.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||n.assembleTitle(),a=n.assembleGroupStyle();return[u(u(u(u(u({name:this.getName("cell"),type:"group"},i?{title:i}:{}),a?{style:a}:{}),{},{from:{facet:this.assembleFacet()},sort:{field:Jn.map((function(n){return e.facetSortFields(n)})).flat(),order:Jn.map((function(n){return e.facetSortOrder(n)})).flat()}},t.length>0?{data:t}:{}),r?{encode:{update:r}}:{}),n.assembleGroup(function(e,n){if(e.component.selection&&ke(e.component.selection).length){var t=J(e.getName("cell"));n.unshift({name:"facet",value:{},on:[{events:Bc("mousemove","scope"),update:"isTuple(facet) ? facet : group(".concat(t,").datum")}]})}return zs(n)}(this,[])))]}},{key:"getMapping",value:function(){return this.facet}}]),r}($p);function wh(e,n){var t,r=F(n);try{for(r.s();!(t=r.n()).done;){var i,a,o,u,l=t.value,c=l.data;if(!e.name||!l.hasName()||e.name===l.dataName){var s=null===(i=e.format)||void 0===i?void 0:i.mesh,f=null===(a=c.format)||void 0===a?void 0:a.feature;if(!s||!f){var d=null===(o=e.format)||void 0===o?void 0:o.feature;if(!d&&!f||d===f){var v=null===(u=c.format)||void 0===u?void 0:u.mesh;if(!s&&!v||s===v)if(Zl(e)&&Zl(c)){if(re(e.values,c.values))return l}else if(Kl(e)&&Kl(c)){if(e.url===c.url)return l}else if(ec(e)&&e.name===l.dataName)return l}}}}}catch(e){r.e(e)}finally{r.f()}return null}function Ah(e){var n,t,r,i=function(e,n){if(e.data||!e.parent){if(null===e.data){var t=new Uv({values:[]});return n.push(t),t}var r=wh(e.data,n);if(r)return nc(e.data)||(r.data.format=ve({},e.data.format,r.data.format)),!r.hasName()&&e.data.name&&(r.dataName=e.data.name),r;var i=new Uv(e.data);return n.push(i),i}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources),o=e.component.data,l=o.outputNodes,c=o.outputNodeRefCounts,s=e.parent?e.parent.component.data.ancestorParse.clone():new $l,f=e.data;nc(f)?(tc(f)?i=new Wv(i,f.sequence):ic(f)&&(i=new Rv(i,f.graticule)),s.parseNothing=!0):null===(null==f||null===(n=f.format)||void 0===n?void 0:n.parse)&&(s.parseNothing=!0),i=null!==(t=Lv.makeExplicit(i,e,s))&&void 0!==t?t:i,i=new qv(i);var d,v=e.parent&&Xp(e.parent);(Vp(e)||Yp(e))&&(v&&(i=null!==(d=Ov.makeFromEncoding(i,e))&&void 0!==d?d:i));e.transforms.length>0&&(i=function(e,n,t){var r,i=0,o=F(n.transforms);try{for(o.s();!(r=o.n()).done;){var u=r.value,l=void 0,c=void 0;if(mc(u))c=e=new Pd(e,u),l="derived";else if(ac(u)){var s,f=Mv(u);c=e=null!==(s=Lv.makeWithAncestors(e,{},f,t))&&void 0!==s?s:e,e=new gd(e,n,u.filter)}else if(gc(u))c=e=Ov.makeFromTransform(e,u,n),l="number";else if(bc(u))l="date",void 0===t.getWithExplicit(u.field).value&&(e=new Lv(e,a({},u.field,l)),t.set(u.field,l,!1)),c=e=cs.makeFromTransform(e,u);else if(xc(u))c=e=zv.makeFromTransform(e,u),l="number",Js(n)&&(e=new qv(e));else if(oc(u))c=e=oh.make(e,n,u,i++),l="derived";else if(vc(u))c=e=new up(e,u),l="number";else if(pc(u))c=e=new ap(e,u),l="number";else if(kc(u))c=e=op.makeFromTransform(e,u),l="derived";else if(wc(u))c=e=new nh(e,u),l="derived";else if(hc(u))c=e=new eh(e,u),l="derived";else if(uc(u))c=e=new ch(e,u),l="derived";else if(dc(u))e=new sh(e,u);else if(yc(u))c=e=ih.makeFromTransform(e,u),l="derived";else if(lc(u))c=e=new Kp(e,u),l="derived";else if(cc(u))c=e=new uh(e,u),l="derived";else if(sc(u))c=e=new lh(e,u),l="derived";else{if(!fc(u)){gr("Ignoring an invalid transform: ".concat(ue(u),"."));continue}c=e=new ah(e,u),l="derived"}if(c&&void 0!==l){var d,v,p=F(null!==(d=c.producedFields())&&void 0!==d?d:[]);try{for(p.s();!(v=p.n()).done;){var h=v.value;t.set(h,l,!1)}}catch(e){p.e(e)}finally{p.f()}}}}catch(e){o.e(e)}finally{o.f()}return e}(i,e,s));var p=function(e){var n={};if(Vp(e)&&e.component.selection){var t,r=F(ke(e.component.selection));try{for(r.s();!(t=r.n()).done;){var i,a=t.value,o=F(e.component.selection[a].project.items);try{for(o.s();!(i=o.n()).done;){var u=i.value;!u.channel&&Ne(u.field)>1&&(n[u.field]="flatten")}}catch(e){o.e(e)}finally{o.f()}}}catch(e){r.e(e)}finally{r.f()}}return n}(e),h=Tv(e);if(i=null!==(r=Lv.makeWithAncestors(i,{},u(u({},p),h),s))&&void 0!==r?r:i,Vp(e)&&(i=th.parseAll(i,e),i=rh.parseAll(i,e)),Vp(e)||Yp(e)){var m,g;if(!v)i=null!==(g=Ov.makeFromEncoding(i,e))&&void 0!==g?g:i;i=null!==(m=cs.makeFromEncoding(i,e))&&void 0!==m?m:i,i=Pd.parseAllForSortIndex(i,e)}var y,b=e.getDataName(Ql.Raw),x=new ls(i,b,Ql.Raw,c);if(l[b]=x,i=x,Vp(e)){var k,w,A=zv.makeFromEncoding(i,e);A&&(i=A,Js(e)&&(i=new qv(i))),i=null!==(k=ih.makeFromEncoding(i,e))&&void 0!==k?k:i,i=null!==(w=op.makeFromEncoding(i,e))&&void 0!==w?w:i}Vp(e)&&(i=null!==(y=Zp.make(i,e))&&void 0!==y?y:i);var D=e.getDataName(Ql.Main),C=new ls(i,D,Ql.Main,c);l[D]=C,i=C,Vp(e)&&function(e,n){Gs(e,(function(t){var r=t.name,i=e.getName("lookup_".concat(r));e.component.data.outputNodes[i]=t.materialized=new ls(new gd(n,e,{selection:r}),i,Ql.Lookup,e.component.data.outputNodeRefCounts)}))}(e,C);var S=null;if(Yp(e)){var E,B=e.getName("facet");i=null!==(E=function(e,n){var t=n.row,r=n.column;if(t&&r){for(var i=null,a=0,o=[t,r];a<o.length;a++){var u=o[a];if(Ma(u.sort)){var l=u.sort,c=l.field,s=l.op;e=i=new ap(e,{joinaggregate:[{op:void 0===s?za:s,field:c,as:xh(u,u.sort,{forAs:!0})}],groupby:[lo(u)]})}}return i}return null}(i,e.facet))&&void 0!==E?E:i,S=new jv(i,e,B,C.getSource()),l[B]=S}return u(u({},e.component.data),{},{outputNodes:l,outputNodeRefCounts:c,raw:x,main:C,facetRoot:S,ancestorParse:s})}var Dh=function(e){l(r,e);var n=m(r);function r(e,i,o,u){var l,c,s,f,d;return t(this,r),a(p(d=n.call(this,e,"concat",i,o,u,e.resolve)),"children",void 0),"shared"!==(null===(l=e.resolve)||void 0===l||null===(c=l.axis)||void 0===c?void 0:c.x)&&"shared"!==(null===(s=e.resolve)||void 0===s||null===(f=s.axis)||void 0===f?void 0:f.y)||gr("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),d.children=d.getChildren(e).map((function(e,n){return Qh(e,p(d),d.getName("concat_"+n),void 0,u)})),d}return i(r,[{key:"parseData",value:function(){this.component.data=Ah(this);var e,n=F(this.children);try{for(n.s();!(e=n.n()).done;){e.value.parseData()}}catch(e){n.e(e)}finally{n.f()}}},{key:"parseSelections",value:function(){this.component.selection={};var e,n=F(this.children);try{for(n.s();!(e=n.n()).done;){var t=e.value;t.parseSelections();var r,i=F(ke(t.component.selection));try{for(i.s();!(r=i.n()).done;){var a=r.value;this.component.selection[a]=t.component.selection[a]}}catch(e){i.e(e)}finally{i.f()}}}catch(e){n.e(e)}finally{n.f()}}},{key:"parseMarkGroup",value:function(){var e,n=F(this.children);try{for(n.s();!(e=n.n()).done;){e.value.parseMarkGroup()}}catch(e){n.e(e)}finally{n.f()}}},{key:"parseAxesAndHeaders",value:function(){var e,n=F(this.children);try{for(n.s();!(e=n.n()).done;){e.value.parseAxesAndHeaders()}}catch(e){n.e(e)}finally{n.f()}}},{key:"getChildren",value:function(e){return Iu(e)?e.vconcat:Hu(e)?e.hconcat:e.concat}},{key:"parseLayoutSize",value:function(){!function(e){gh(e);var n=1===e.layout.columns?"width":"childWidth",t=void 0===e.layout.columns?"height":"childHeight";yh(e,n),yh(e,t)}(this)}},{key:"parseAxisGroup",value:function(){return null}},{key:"assembleSelectionTopLevelSignals",value:function(e){return this.children.reduce((function(e,n){return n.assembleSelectionTopLevelSignals(e)}),e)}},{key:"assembleSignals",value:function(){return this.children.forEach((function(e){return e.assembleSignals()})),[]}},{key:"assembleLayoutSignals",value:function(){var e,n=$d(this),t=F(this.children);try{for(t.s();!(e=t.n()).done;){var r=e.value;n.push.apply(n,b(r.assembleLayoutSignals()))}}catch(e){t.e(e)}finally{t.f()}return n}},{key:"assembleSelectionData",value:function(e){return this.children.reduce((function(e,n){return n.assembleSelectionData(e)}),e)}},{key:"assembleMarks",value:function(){return this.children.map((function(e){var n=e.assembleTitle(),t=e.assembleGroupStyle(),r=e.assembleGroupEncodeEntry(!1);return u(u(u(u({type:"group",name:e.getName("group")},n?{title:n}:{}),t?{style:t}:{}),r?{encode:{update:r}}:{}),e.assembleGroup())}))}},{key:"assembleDefaultLayout",value:function(){var e=this.layout.columns;return u(u({},null!=e?{columns:e}:{}),{},{bounds:"full",align:"each"})}}]),r}(Qp);var Fh=u(u({disable:1,gridScale:1,scale:1},Ye),{},{labelExpr:1,encode:1}),Ch=ke(Fh),Sh=function(e){l(r,e);var n=m(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t(this,r),(e=n.call(this)).explicit=i,e.implicit=a,e.mainExtracted=o,e}return i(r,[{key:"clone",value:function(){return new r(ie(this.explicit),ie(this.implicit),this.mainExtracted)}},{key:"hasAxisPart",value:function(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!(!1===(n=this.get(e))||null===n));var n}},{key:"hasOrientSignalRef",value:function(){return Tr(this.explicit.orient)}}]),r}(Hl);var Eh={bottom:"top",top:"bottom",left:"right",right:"left"};function Bh(e,n){if(!e)return n.map((function(e){return e.clone()}));if(e.length===n.length){for(var t=e.length,r=0;r<t;r++){var i=e[r],a=n[r];if(!!i!=!!a)return;if(i&&a){var o=i.getWithExplicit("orient"),u=a.getWithExplicit("orient");if(o.explicit&&u.explicit&&o.value!==u.value)return;e[r]=Oh(i,a)}}return e}}function Oh(e,n){var t,r=F(Ch);try{var i=function(){var r=t.value,i=Xl(e.getWithExplicit(r),n.getWithExplicit(r),r,"axis",(function(e,n){switch(r){case"title":return Qo(e,n);case"gridScale":return{explicit:e.explicit,value:Me(e.value,n.value)}}return Jl(e,n,r,"axis")}));e.setWithExplicit(r,i)};for(r.s();!(t=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}return e}function _h(e,n,t,r,i){if("disable"===n)return void 0!==t;switch(t=t||{},n){case"titleAngle":case"labelAngle":return e===(Tr(t.labelAngle)?t.labelAngle:We(t.labelAngle));case"values":return!!t.values;case"encode":return!!t.encoding||!!t.labelAngle;case"title":if(e===jd(r,i))return!0}return e===t[n]}var zh=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function jh(e,n){var t,r,i,a,o,l=n.axis(e),c=new Sh,s=Ao(n.encoding[e]),f=n.mark,d=n.config,v=(null===(t=l)||void 0===t?void 0:t.orient)||(null===(r=d["x"===e?"axisX":"axisY"])||void 0===r?void 0:r.orient)||(null===(i=d.axis)||void 0===i?void 0:i.orient)||function(e){return"x"===e?"bottom":"left"}(e),p=n.getScaleComponent(e).get("type"),h=Cd(e,p,v,n.config),m=void 0!==l?!l:Ed("disable",d.style,null===(a=l)||void 0===a?void 0:a.style,h).configValue;if(c.set("disable",m,void 0!==l),m)return c;var g,y=function(e,n,t,r,i){var a=null==n?void 0:n.labelAngle;if(void 0!==a)return Tr(a)?a:We(a);var o=Ed("labelAngle",r,null==n?void 0:n.style,i).configValue;return void 0!==o?We(o):t!==sn||!se([oi,ii],e.type)||Ja(e)&&e.timeUnit?void 0:270}(s,l=l||{},e,d.style,h),b={fieldOrDatumDef:s,axis:l,channel:e,model:n,scaleType:p,orient:v,labelAngle:y,mark:f,config:d},x=F(Ch);try{for(x.s();!(g=x.n()).done;){var k=g.value,w=k in Bd?Bd[k](b):Xe(k)?l[k]:void 0,A=void 0!==w,D=_h(w,k,l,n,e);if(A&&D)c.set(k,w,D);else{var C=Xe(k)&&"values"!==k?Ed(k,d.style,l.style,h):{},S=C.configValue,E=void 0===S?void 0:S,B=C.configFrom,O=void 0===B?void 0:B,_=void 0!==E;A&&!_?c.set(k,w,D):("vgAxisConfig"!==O||zh.has(k)&&_||He(E)||Tr(E))&&c.set(k,E,!1)}}}catch(e){x.e(e)}finally{x.f()}var z=null!==(o=l.encoding)&&void 0!==o?o:{},j=Ge.reduce((function(t,r){var i;if(!c.hasAxisPart(r))return t;var a=tv(null!==(i=z[r])&&void 0!==i?i:{},n),o="labels"===r?function(e,n,t){var r,i=e.encoding,a=e.config,o=null!==(r=Ao(i[n]))&&void 0!==r?r:Ao(i[it(n)]),l=e.axis(n)||{},c=l.format,s=l.formatType;return ka(s)?u({text:Fa({fieldOrDatumDef:o,field:"datum.value",format:c,formatType:s,config:a})},t):t}(n,e,a):a;return void 0===o||xe(o)||(t[r]={update:o}),t}),{});return xe(j)||c.set("encode",j,!!l.encoding||void 0!==l.labelAngle),c}function Ph(e){var n,t=e.encoding,r=e.size,i=F(ct);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=at(a);Yu(r[o])&&$a(t[a])&&(delete r[o],gr(tr(o)))}}catch(e){i.e(e)}finally{i.f()}return r}function Nh(e,n,t){var r,i,a=Wi(e),o=Io("orient",a,t);if(a.orient=function(e,n,t){switch(e){case Ji:case ea:case na:case $i:case Xi:case Vi:return}var r=n.x,i=n.y,a=n.x2,o=n.y2;switch(e){case Gi:if(Ja(r)&&(Ft(r.bin)||Ja(i)&&i.aggregate&&!r.aggregate))return"vertical";if(Ja(i)&&(Ft(i.bin)||Ja(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||a){if(t)return t;if(!a&&(Ja(r)&&r.type===ri&&!Dt(r.bin)||Ka(r)))return"horizontal";if(!o&&(Ja(i)&&i.type===ri&&!Dt(i.bin)||Ka(i)))return"vertical"}case Qi:if(a&&(!Ja(r)||!Ft(r.bin))&&o&&(!Ja(i)||!Ft(i.bin)))return;case Hi:if(o)return Ja(i)&&Ft(i.bin)?"horizontal":"vertical";if(a)return Ja(r)&&Ft(r.bin)?"vertical":"horizontal";if(e===Qi){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case Yi:case Ki:var u=$a(r),l=$a(i);if(u&&!l)return"tick"!==e?"horizontal":"vertical";if(!u&&l)return"tick"!==e?"vertical":"horizontal";if(u&&l){var c=r,s=i,f=c.type===ai,d=s.type===ai;return f&&!d?"tick"!==e?"vertical":"horizontal":!f&&d?"tick"!==e?"horizontal":"vertical":!c.aggregate&&s.aggregate?"tick"!==e?"vertical":"horizontal":c.aggregate&&!s.aggregate?"tick"!==e?"horizontal":"vertical":t||"vertical"}return t||void 0}return"vertical"}(a.type,n,o),void 0!==o&&o!==a.orient&&gr((r=a.orient,i=o,'Specified orient "'.concat(r,'" overridden with "').concat(i,'".'))),"bar"===a.type&&a.orient){var u=Io("cornerRadiusEnd",a,t);if(void 0!==u){var l,c=F("horizontal"===a.orient&&n.x2||"vertical"===a.orient&&n.y2?["cornerRadius"]:sa[a.orient]);try{for(c.s();!(l=c.n()).done;){a[l.value]=u}}catch(e){c.e(e)}finally{c.f()}void 0!==a.cornerRadiusEnd&&delete a.cornerRadiusEnd}}return void 0===Io("opacity",a,t)&&(a.opacity=function(e,n){if(se([Ji,Ki,ea,na],e)&&!eu(n))return.7;return}(a.type,n)),void 0===Io("cursor",a,t)&&(a.cursor=function(e,n,t){if(n.href||e.href||Io("href",e,t))return"pointer";return e.cursor}(a,n,t)),a}function Mh(e,n,t){if(t.graticule)return!1;var r=Ho("filled",e,n),i=e.type;return Me(r,i!==Ji&&i!==Yi&&i!==Qi)}function Th(e,n){e.config;return u(u(u(u(u(u({},ns(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Ic("x",e,{defaultPos:"mid"})),Ic("y",e,{defaultPos:"mid"})),Rc("size",e)),Rc("angle",e)),function(e,n,t){if(t)return{shape:{value:t}};return Rc("shape",e)}(e,0,n))}function Lh(e){var n,t=e.config,r=e.markDef,i=r.orient,a="horizontal"===i?"width":"height",o=e.getScaleComponent("horizontal"===i?"x":"y"),u=null!==(n=Io("size",r,t,{vgChannel:a}))&&void 0!==n?n:t.tick.bandSize;if(void 0!==u)return u;var l=o?o.get("range"):void 0;return l&&Lr(l)&&V(l.step)?3*l.step/4:3*$u(t.view,a)/4}var qh={arc:{vgMark:"arc",encodeEntry:function(e){return u(u(u(u(u({},ns(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Ic("x",e,{defaultPos:"mid"})),Ic("y",e,{defaultPos:"mid"})),$c(e,"radius","arc")),$c(e,"theta","arc"))}},area:{vgMark:"area",encodeEntry:function(e){return u(u(u(u({},ns(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),Jc("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),Jc("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),rs(e))}},bar:{vgMark:"rect",encodeEntry:function(e){return u(u(u({},ns(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),$c(e,"x","bar")),$c(e,"y","bar"))}},circle:{vgMark:"symbol",encodeEntry:function(e){return Th(e,"circle")}},geoshape:{vgMark:"shape",encodeEntry:function(e){return u({},ns(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}))},postEncodingTransform:function(e){var n=e.encoding.shape;return[u({type:"geoshape",projection:e.projectionName()},n&&Ja(n)&&n.type===ui?{field:lo(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:function(e){return u(u(u(u({},ns(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),$c(e,"x","image")),$c(e,"y","image")),Pc(e,"url"))}},line:{vgMark:"line",encodeEntry:function(e){return u(u(u(u(u({},ns(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Ic("x",e,{defaultPos:"mid"})),Ic("y",e,{defaultPos:"mid"})),Rc("size",e,{vgChannel:"strokeWidth"})),rs(e))}},point:{vgMark:"symbol",encodeEntry:function(e){return Th(e)}},rect:{vgMark:"rect",encodeEntry:function(e){return u(u(u({},ns(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),$c(e,"x","rect")),$c(e,"y","rect"))}},rule:{vgMark:"rule",encodeEntry:function(e){var n=e.markDef.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?u(u(u(u({},ns(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Jc("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),Jc("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),Rc("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:function(e){return Th(e,"square")}},text:{vgMark:"text",encodeEntry:function(e){var n=e.config;e.encoding;return u(u(u(u(u(u(u(u(u(u({},ns(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),Ic("x",e,{defaultPos:"mid"})),Ic("y",e,{defaultPos:"mid"})),Pc(e)),Rc("size",e,{vgChannel:"fontSize"})),Rc("angle",e)),is("align",function(e,n,t){if(void 0===Io("align",e,t))return"center";return}(e.markDef,0,n))),is("baseline",function(e,n,t){if(void 0===Io("baseline",e,t))return"middle";return}(e.markDef,0,n))),Ic("radius",e,{defaultPos:null,isMidPoint:!0})),Ic("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:function(e){var n=e.config,t=e.markDef,r=t.orient,i="horizontal"===r?"width":"height",o="horizontal"===r?"height":"width";return u(u(u(u(u({},ns(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ic("x",e,{defaultPos:"mid",vgChannel:"xc"})),Ic("y",e,{defaultPos:"mid",vgChannel:"yc"})),Rc("size",e,{defaultValue:Lh(e),vgChannel:i})),{},a({},o,qo(Io("thickness",t,n))))}},trail:{vgMark:"trail",encodeEntry:function(e){return u(u(u(u(u({},ns(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Ic("x",e,{defaultPos:"mid"})),Ic("y",e,{defaultPos:"mid"})),Rc("size",e)),rs(e))}}};function Rh(e){if(se([Yi,Hi,Zi],e.mark)){var n=ou(e.mark,e.encoding);if(n.length>0)return function(e,n){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:Wh+e.requestDataName(Ql.Main),data:e.requestDataName(Ql.Main),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:Hh(e,{fromPrefix:Wh})}]}(e,n)}else if(se([Gi],e.mark)){var t=Ur.some((function(n){return Io(n,e.markDef,e.config)}));if(e.stack&&!e.fieldDef("size")&&t)return function(e){var n,t,r=y(Hh(e,{fromPrefix:Uh}),1)[0],i=e.scaleName(e.stack.fieldChannel),o=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.vgField(e.stack.fieldChannel,n)},l=function(e,n){var t=[o({prefix:"min",suffix:"start",expr:n}),o({prefix:"max",suffix:"start",expr:n}),o({prefix:"min",suffix:"end",expr:n}),o({prefix:"max",suffix:"end",expr:n})];return"".concat(e,"(").concat(t.map((function(e){return"scale('".concat(i,"',").concat(e,")")})).join(","),")")};"x"===e.stack.fieldChannel?(n=u(u({},ae(r.encode.update,["y","yc","y2","height"].concat(b(Ur)))),{},{x:{signal:l("min","datum")},x2:{signal:l("max","datum")},clip:{value:!0}}),t={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},r.encode.update=u(u({},oe(r.encode.update,["y","yc","y2"])),{},{height:{field:{group:"height"}}})):(n=u(u({},ae(r.encode.update,["x","xc","x2","width"])),{},{y:{signal:l("min","datum")},y2:{signal:l("max","datum")},clip:{value:!0}}),t={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},r.encode.update=u(u({},oe(r.encode.update,["x","xc","x2"])),{},{width:{field:{group:"width"}}}));var c,s=F(Ur);try{for(s.s();!(c=s.n()).done;){var f=c.value,d=Ho(f,e.markDef,e.config);r.encode.update[f]?(n[f]=r.encode.update[f],delete r.encode.update[f]):d&&(n[f]=qo(d)),d&&(r.encode.update[f]={value:0})}}catch(e){s.e(e)}finally{s.f()}var v=e.fieldDef(e.stack.groupbyChannel),p=lo(v)?[lo(v)]:[];((null==v?void 0:v.bin)||(null==v?void 0:v.timeUnit))&&p.push(lo(v,{binSuffix:"end"}));(n=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((function(n,t){if(r.encode.update[t])return u(u({},n),{},a({},t,r.encode.update[t]));var i=Ho(t,e.markDef,e.config);return void 0!==i?u(u({},n),{},a({},t,qo(i))):n}),n)).stroke&&(n.strokeForeground={value:!0},n.strokeOffset={value:0});return[{type:"group",from:{facet:{data:e.requestDataName(Ql.Main),name:Uh+e.requestDataName(Ql.Main),groupby:p,aggregate:{fields:[o({suffix:"start"}),o({suffix:"start"}),o({suffix:"end"}),o({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:n},marks:[{type:"group",encode:{update:t},marks:[r]}]}]}(e)}return Hh(e)}var Wh="faceted_path_";var Uh="stack_group_";function Ih(e){var n=e.encoding,t=e.stack,r=e.mark,i=e.markDef,a=e.config,o=n.order;if(!(!M(o)&&no(o)&&ce(o.value)||!o&&ce(Io("order",i,a)))){if((M(o)||Ja(o))&&!t)return Yo(o,{expr:"datum"});if(ra(r)){var u="horizontal"===i.orient?"y":"x",l=n[u];if(Ja(l)){var c=l.sort;return M(c)?{field:lo(l,{prefix:u,suffix:"sort_index",expr:"datum"})}:Ma(c)?{field:lo({aggregate:eu(e.encoding)?c.op:void 0,field:c.field},{expr:"datum"})}:Na(c)?{field:lo(e.fieldDef(c.encoding),{expr:"datum"}),order:c.order}:null===c?void 0:{field:lo(l,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}else;}}function Hh(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromPrefix:""},t=e.mark,r=e.markDef,i=e.encoding,a=e.config,o=Me(r.clip,Gh(e),Vh(e)),l=Uo(r),c=i.key,s=Ih(e),f=Yh(e),d=Io("aria",r,a),v=qh[t].postEncodingTransform?qh[t].postEncodingTransform(e):null;return[u(u(u(u(u(u(u({name:e.getName("marks"),type:qh[t].vgMark},o?{clip:!0}:{}),l?{style:l}:{}),c?{key:c.field}:{}),s?{sort:s}:{}),f||{}),!1===d?{aria:d}:{}),{},{from:{data:n.fromPrefix+e.requestDataName(Ql.Main)},encode:{update:qh[t].encodeEntry(e)}},v?{transform:v}:{})]}function Gh(e){var n=e.getScaleComponent("x"),t=e.getScaleComponent("y");return!!(n&&n.get("selectionExtent")||t&&t.get("selectionExtent"))||void 0}function Vh(e){var n=e.component.projection;return!(!n||n.isFit)||void 0}function Yh(e){if(!e.component.selection)return null;for(var n=ke(e.component.selection).length,t=n,r=e.parent;r&&0===t;)t=ke(r.component.selection).length,r=r.parent;return t?{interactive:n>0||!!e.encoding.tooltip}:null}var Jh=function(e){l(r,e);var n=m(r);function r(e,i,o){var l,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4?arguments[4]:void 0;t(this,r),a(p(l=n.call(this,e,"unit",i,o,s,void 0,Ju(e)?e.view:void 0)),"markDef",void 0),a(p(l),"encoding",void 0),a(p(l),"specifiedScales",{}),a(p(l),"stack",void 0),a(p(l),"specifiedAxes",{}),a(p(l),"specifiedLegends",{}),a(p(l),"specifiedProjection",{}),a(p(l),"selection",{}),a(p(l),"children",[]);var f=oa(e.mark)?u({},e.mark):{type:e.mark},d=f.type;void 0===f.filled&&(f.filled=Mh(f,s,{graticule:e.data&&ic(e.data)}));var v=l.encoding=tu(e.encoding||{},d,f.filled,s);return l.markDef=Nh(f,v,s),l.size=Ph({encoding:v,size:Ju(e)?u(u(u({},c),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):c}),l.stack=Dl(d,v),l.specifiedScales=l.initScales(d,v),l.specifiedAxes=l.initAxes(v),l.specifiedLegends=l.initLegends(v),l.specifiedProjection=e.projection,l.selection=e.selection,l}return i(r,[{key:"scaleDomain",value:function(e){var n=this.specifiedScales[e];return n?n.domain:void 0}},{key:"axis",value:function(e){return this.specifiedAxes[e]}},{key:"legend",value:function(e){return this.specifiedLegends[e]}},{key:"initScales",value:function(e,n){var t=this;return gt.reduce((function(e,r){var i,a=Ao(n[r]);a&&(e[r]=t.initScale(null!==(i=a.scale)&&void 0!==i?i:{}));return e}),{})}},{key:"initScale",value:function(e){var n=e.domain,t=e.range,r=Wi(e);return M(n)&&(r.domain=n.map(To)),M(t)&&(r.range=t.map(To)),r}},{key:"initAxes",value:function(e){var n=this;return ct.reduce((function(t,r){var i=e[r];if(Za(i)||r===sn&&Za(e.x2)||r===fn&&Za(e.y2)){var a=Za(i)?i.axis:void 0;t[r]=a?n.initAxis(u({},a)):a}return t}),{})}},{key:"initAxis",value:function(e){var n,t={},r=F(ke(e));try{for(r.s();!(n=r.n()).done;){var i=n.value,a=e[i];t[i]=He(a)?Mo(a):To(a)}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"initLegends",value:function(e){return ht.reduce((function(n,t){var r=Ao(e[t]);if(r&&function(e){switch(e){case wn:case An:case Dn:case Cn:case Fn:case En:case _n:case zn:return!0;case Bn:case On:case Sn:return!1}}(t)){var i=r.legend;n[t]=i?Wi(i):i}return n}),{})}},{key:"parseData",value:function(){this.component.data=Ah(this)}},{key:"parseLayoutSize",value:function(){!function(e){var n,t=e.size,r=e.component,i=F(ct);try{for(i.s();!(n=i.n()).done;){var a=at(n.value);if(t[a]){var o=t[a];r.layoutSize.set(a,Yu(o)?"step":o,!0)}else{var u=bh(e,a);r.layoutSize.set(a,u,!1)}}}catch(e){i.e(e)}finally{i.f()}}(this)}},{key:"parseSelections",value:function(){this.component.selection=function(e,n){var t,r={},i=e.config.selection,a=F(ke(null!=n?n:{}));try{var o=function(){var a=t.value,o=ie(n[a]),l=i[o.type],c=(l.fields,l.encodings,v(l,["fields","encodings"]));for(var s in c){var f;"encodings"===s&&o.fields||"fields"===s&&o.encodings||("mark"===s&&(o[s]=u(u({},c[s]),o[s])),(void 0===o[s]||!0===o[s])&&(o[s]=null!==(f=c[s])&&void 0!==f?f:o[s]))}var d=Fe(a),p=r[d]=u(u({},o),{},{name:d,events:Y(o.on)?Bc(o.on,"scope"):ie(o.on)});Bs(p,(function(t){t.has(p)&&t.parse&&t.parse(e,p,o,n[a])}))};for(a.s();!(t=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}return r}(this,this.selection)}},{key:"parseMarkGroup",value:function(){this.component.mark=Rh(this)}},{key:"parseAxesAndHeaders",value:function(){var e;this.component.axes=(e=this,ct.reduce((function(n,t){return e.component.scales[t]&&(n[t]=[jh(t,e)]),n}),{}))}},{key:"assembleSelectionTopLevelSignals",value:function(e){return function(e,n){var t=!1;return Gs(e,(function(r,i){var a=r.name,o=J(a+Rs);if(0===n.filter((function(e){return e.name===a})).length){var u="global"===r.resolve?"union":r.resolve,l="multi"===r.type?", true)":")";n.push({name:r.name,update:"".concat(Is,"(").concat(o,", ").concat(J(u)).concat(l)})}t=!0,i.topLevelSignals&&(n=i.topLevelSignals(e,r,n)),Bs(r,(function(t){t.topLevelSignals&&(n=t.topLevelSignals(e,r,n))}))})),t&&0===n.filter((function(e){return"unit"===e.name})).length&&n.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),zs(n)}(this,e)}},{key:"assembleSignals",value:function(){return[].concat(b(Dd(this)),b((n=[],Gs(e=this,(function(t,r){var i,a=t.name,o=r.modifyExpr(e,t);(i=n).push.apply(i,b(r.signals(e,t))),Bs(t,(function(r){r.signals&&(n=r.signals(e,t,n)),r.modifyExpr&&(o=r.modifyExpr(e,t,o))})),n.push({name:a+Us,on:[{events:{signal:t.name+Ws},update:"modify(".concat(J(t.name+Rs),", ").concat(o,")")}]})})),zs(n))));var e,n}},{key:"assembleSelectionData",value:function(e){return function(e,n){var t=b(n);return Gs(e,(function(n){var r={name:n.name+Rs};if(n.init){var i=n.project.items.map((function(e){return e.signals,v(e,["signals"])})),a=n.init.map((function(e){return Os(e,!1)}));r.values="interval"===n.type?[{unit:Ys(e,{escape:!1}),fields:i,values:a}]:a.map((function(n){return{unit:Ys(e,{escape:!1}),fields:i,values:n}}))}t.filter((function(e){return e.name===n.name+Rs})).length||t.push(r)})),t}(this,e)}},{key:"assembleLayout",value:function(){return null}},{key:"assembleLayoutSignals",value:function(){return $d(this)}},{key:"assembleMarks",value:function(){var e,n=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&Xp(this.parent)||(n=_s(this,n)),n.map(this.correctDataNames)}},{key:"getMapping",value:function(){return this.encoding}},{key:"channelHasField",value:function(e){return Zo(this.encoding,e)}},{key:"fieldDef",value:function(e){return wo(this.encoding[e])}},{key:"typedFieldDef",value:function(e){var n=this.fieldDef(e);return eo(n)?n:null}},{key:"hasProjection",get:function(){var e=this.encoding,n=this.mark===ta,t=e&&Hn.some((function(n){return Za(e[n])}));return n||t}},{key:"mark",get:function(){return this.markDef.type}}]),r}($p),Xh=function(e){l(r,e);var n=m(r);function r(e,i,o,l,c){var s;t(this,r),a(p(s=n.call(this,e,"layer",i,o,c,e.resolve,e.view)),"children",void 0);var f=u(u(u({},l),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});return s.children=e.layer.map((function(e,n){if(ml(e))return new r(e,p(s),s.getName("layer_"+n),f,c);if($o(e))return new Jh(e,p(s),s.getName("layer_"+n),f,c);throw new Error(Bt(e))})),s}return i(r,[{key:"parseData",value:function(){this.component.data=Ah(this);var e,n=F(this.children);try{for(n.s();!(e=n.n()).done;){e.value.parseData()}}catch(e){n.e(e)}finally{n.f()}}},{key:"parseLayoutSize",value:function(){var e;gh(e=this),yh(e,"width"),yh(e,"height")}},{key:"parseSelections",value:function(){this.component.selection={};var e,n=F(this.children);try{for(n.s();!(e=n.n()).done;){var t=e.value;t.parseSelections();var r,i=F(ke(t.component.selection));try{for(i.s();!(r=i.n()).done;){var a=r.value;this.component.selection[a]=t.component.selection[a]}}catch(e){i.e(e)}finally{i.f()}}}catch(e){n.e(e)}finally{n.f()}}},{key:"parseMarkGroup",value:function(){var e,n=F(this.children);try{for(n.s();!(e=n.n()).done;){e.value.parseMarkGroup()}}catch(e){n.e(e)}finally{n.f()}}},{key:"parseAxesAndHeaders",value:function(){!function(e){var n,t=e.component,r=t.axes,i=t.resolve,a={top:0,bottom:0,right:0,left:0},o=F(e.children);try{for(o.s();!(n=o.n()).done;){var u=n.value;u.parseAxesAndHeaders();var l,c=F(ke(u.component.axes));try{for(c.s();!(l=c.n()).done;){var s=l.value;i.axis[s]=iv(e.component.resolve,s),"shared"===i.axis[s]&&(r[s]=Bh(r[s],u.component.axes[s]),r[s]||(i.axis[s]="independent",delete r[s]))}}catch(e){c.e(e)}finally{c.f()}}}catch(e){o.e(e)}finally{o.f()}var f,d=F(ct);try{for(d.s();!(f=d.n()).done;){var v,p=f.value,h=F(e.children);try{for(h.s();!(v=h.n()).done;){var m=v.value;if(m.component.axes[p]){if("independent"===i.axis[p]){var g;r[p]=(null!==(g=r[p])&&void 0!==g?g:[]).concat(m.component.axes[p]);var y,b=F(m.component.axes[p]);try{for(b.s();!(y=b.n()).done;){var x=y.value,k=x.getWithExplicit("orient"),w=k.value,A=k.explicit;if(!Tr(w)){if(a[w]>0&&!A){var D=Eh[w];a[w]>a[D]&&x.set("orient",D,!1)}a[w]++}}}catch(e){b.e(e)}finally{b.f()}}delete m.component.axes[p]}}}catch(e){h.e(e)}finally{h.f()}if("independent"===i.axis[p]&&r[p]&&r[p].length>1){var C,S=F(r[p]);try{for(S.s();!(C=S.n()).done;){var E=C.value;E.get("grid")&&!E.explicit.grid&&(E.implicit.grid=!1)}}catch(e){S.e(e)}finally{S.f()}}}}catch(e){d.e(e)}finally{d.f()}}(this)}},{key:"assembleSelectionTopLevelSignals",value:function(e){return this.children.reduce((function(e,n){return n.assembleSelectionTopLevelSignals(e)}),e)}},{key:"assembleSignals",value:function(){return this.children.reduce((function(e,n){return e.concat(n.assembleSignals())}),Dd(this))}},{key:"assembleLayoutSignals",value:function(){return this.children.reduce((function(e,n){return e.concat(n.assembleLayoutSignals())}),$d(this))}},{key:"assembleSelectionData",value:function(e){return this.children.reduce((function(e,n){return n.assembleSelectionData(e)}),e)}},{key:"assembleTitle",value:function(){var e=g(c(r.prototype),"assembleTitle",this).call(this);if(e)return e;var n,t=F(this.children);try{for(t.s();!(n=t.n()).done;){if(e=n.value.assembleTitle())return e}}catch(e){t.e(e)}finally{t.f()}}},{key:"assembleLayout",value:function(){return null}},{key:"assembleMarks",value:function(){return function(e,n){var t,r=F(e.children);try{for(r.s();!(t=r.n()).done;){var i=t.value;Vp(i)&&(n=_s(i,n))}}catch(e){r.e(e)}finally{r.f()}return n}(this,this.children.flatMap((function(e){return e.assembleMarks()})))}},{key:"assembleLegends",value:function(){return this.children.reduce((function(e,n){return e.concat(n.assembleLegends())}),kv(this))}}]),r}(Qp);function Qh(e,n,t,r,i){if(Ra(e))return new kh(e,n,t,i);if(ml(e))return new Xh(e,n,t,r,i);if($o(e))return new Jh(e,n,t,r,i);if(function(e){return Iu(e)||Hu(e)||Uu(e)}(e))return new Dh(e,n,t,i);throw new Error(Bt(e))}function $h(e,n,t,r){var i,a=r.component.layoutSize.get("width"),o=r.component.layoutSize.get("height");if(void 0===n?(n={type:"pad"},r.hasAxisOrientSignalRef()&&(n.resize=!0)):Y(n)&&(n={type:n}),a&&o&&("fit"===(i=n.type)||"fit-x"===i||"fit-y"===i))if("step"===a&&"step"===o)gr(jt()),n.type="pad";else if("step"===a||"step"===o){var l="step"===a?"width":"height";gr(jt(vt(l)));var c="width"===l?"height":"width";n.type=function(e){return e?"fit-".concat(vt(e)):"fit"}(c)}return u(u(u({},1===ke(n).length&&n.type?"pad"===n.type?{}:{autosize:n.type}:{autosize:n}),Vu(t,!1)),Vu(e,!0))}function Kh(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=e.config?pl(e.config):void 0,a=[].concat(e.assembleSelectionData([]),dh(e.component.data,t)),o=e.assembleProjections(),l=e.assembleTitle(),c=e.assembleGroupStyle(),s=e.assembleGroupEncodeEntry(!0),f=e.assembleLayoutSignals();f=f.filter((function(e){return"width"!==e.name&&"height"!==e.name||void 0===e.value||(n[e.name]=+e.value,!1)}));var d=n.params,p=v(n,["params"]);return u(u(u(u(u(u(u(u(u({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),p),l?{title:l}:{}),c?{style:c}:{}),s?{encode:{update:s}}:{}),{},{data:a},o.length>0?{projections:o}:{}),e.assembleGroup([].concat(b(f),b(e.assembleSelectionTopLevelSignals([])),b(Tu(d))))),i?{config:i}:{}),r?{usermeta:r}:{})}e.accessPathDepth=Ne,e.accessPathWithDatum=Be,e.compile=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.logger&&hr(n.logger),n.fieldTitle&&ho(n.fieldTitle);try{var t=sl(q(n.config,e.config)),r=Wl(e,t),i=Qh(r,null,"",void 0,t);i.parse(),pp(i.component.data,i);var a=Kh(i,$h(e,r.autosize,t,i),e.datasets,e.usermeta);return{spec:a,normalized:r}}finally{n.logger&&mr(),n.fieldTitle&&mo()}},e.contains=se,e.deepEqual=re,e.deleteNestedProperty=Se,e.duplicate=ie,e.entries=Ae,e.every=de,e.fieldIntersection=be,e.flatAccessWithDatum=Oe,e.getFirstDefined=Me,e.hasIntersection=ge,e.hash=le,e.internalField=qe,e.isBoolean=De,e.isEmpty=xe,e.isEqual=function(e,n){var t=ke(e),r=ke(n);if(t.length!==r.length)return!1;var i,a=F(t);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(e[o]!==n[o])return!1}}catch(e){a.e(e)}finally{a.f()}return!0},e.isInternalField=Re,e.isNullOrFalse=ce,e.isNumeric=Ue,e.keys=ke,e.logicalExpr=Ce,e.mergeDeep=ve,e.normalize=Wl,e.normalizeAngle=We,e.omit=oe,e.pick=ae,e.prefixGenerator=ye,e.removePathFromField=Pe,e.replaceAll=je,e.replacePathInField=ze,e.resetIdCounter=function(){Te=42},e.setEqual=me,e.some=fe,e.stringify=ue,e.titleCase=Ee,e.unique=he,e.uniqueId=Le,e.vals=we,e.varName=Fe,e.version="4.17.0",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=vega-lite.min.js.map
